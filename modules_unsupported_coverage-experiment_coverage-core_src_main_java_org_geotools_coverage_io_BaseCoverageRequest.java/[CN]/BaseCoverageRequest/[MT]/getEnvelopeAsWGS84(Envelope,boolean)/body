{
  Envelope requestedWGS84;
  final MathTransform transformToWGS84;
  final CoordinateReferenceSystem crs=envelope.getCoordinateReferenceSystem();
  if (!CRS.equalsIgnoreMetadata(crs,DefaultGeographicCRS.WGS84)) {
    transformToWGS84=CRS.findMathTransform(crs,DefaultGeographicCRS.WGS84,true);
  }
 else {
    transformToWGS84=IdentityTransform.create(2);
  }
  if (!transformToWGS84.isIdentity()) {
    GeneralEnvelope env=CRS.transform(transformToWGS84,envelope);
    if (get2D) {
      requestedWGS84=new Envelope2D(env);
      ((Envelope2D)requestedWGS84).setCoordinateReferenceSystem(DefaultGeographicCRS.WGS84);
    }
 else {
      requestedWGS84=env;
      ((GeneralEnvelope)requestedWGS84).setCoordinateReferenceSystem(DefaultGeographicCRS.WGS84);
    }
  }
 else {
    if (get2D)     return new Envelope2D(envelope);
 else     return new GeneralEnvelope(envelope);
  }
  return requestedWGS84;
}
