{
  if (metadata instanceof HDF4TeraScanImageMetadata) {
    Node root=metadata.getAsTree(HDF4TeraScanImageMetadata.nativeMetadataFormatName);
    if (root != null) {
      Node mainNode=root.getFirstChild();
      if (mainNode != null) {
        final NamedNodeMap attributes=mainNode.getAttributes();
        if (attributes != null) {
          final int numAttributes=attributes.getLength();
          for (int i=0; i < numAttributes; i++) {
            final Node node=attributes.item(i);
            if (node != null) {
              attributesMap.put(node.getNodeName(),node.getNodeValue());
            }
          }
        }
      }
    }
  }
  if (streamMetadata instanceof HDF4TeraScanStreamMetadata) {
    Node root=streamMetadata.getAsTree(HDF4TeraScanStreamMetadata.nativeMetadataFormatName);
    if (root != null) {
      Node mainNode=root.getFirstChild();
      if (mainNode != null) {
        NamedNodeMap attributes=mainNode.getAttributes();
        if (attributes != null) {
          final int numAttributes=attributes.getLength();
          for (int i=0; i < numAttributes; i++) {
            final Node node=attributes.item(i);
            if (node != null) {
              attributesMap.put(node.getNodeName(),node.getNodeValue());
            }
          }
        }
        mainNode=mainNode.getNextSibling();
        if (mainNode != null) {
          attributes=mainNode.getAttributes();
          if (attributes != null) {
            final int numAttributes=attributes.getLength();
            for (int i=0; i < numAttributes; i++) {
              final Node node=attributes.item(i);
              if (node != null) {
                attributesMap.put(node.getNodeName(),node.getNodeValue());
              }
            }
          }
        }
      }
    }
  }
}
