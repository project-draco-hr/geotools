{
  Expression param1=parameters.get(0);
  CoordinateReferenceSystem crs=null;
  DirectPosition geom;
  if (param1.equals(SRS_NAME)) {
    if (parameters.size() < 3 || parameters.size() > 4) {
      throw new IllegalArgumentException("Wrong number of parameters toDirectPosition function: " + parameters.toString() + ". Usage: toDirectPosition('SRS_NAME'(optional), srsName(optional), point 1, point 2(optional))");
    }
    String srsName=parameters.get(1).evaluate(object,String.class);
    try {
      crs=CRS.decode((String)srsName);
    }
 catch (    NoSuchAuthorityCodeException e) {
      throw new IllegalArgumentException("Invalid or unsupported SRS name detected for toDirectPosition function: " + srsName + ". Cause: "+ e.getMessage());
    }
catch (    FactoryException e) {
      throw new RuntimeException("Unable to decode SRS name. Cause: " + e.getMessage());
    }
    if (parameters.size() == 3) {
      geom=new DirectPosition1D(crs);
    }
 else {
      geom=new DirectPosition2D(crs);
      geom.setOrdinate(1,parameters.get(3).evaluate(object,Double.class));
    }
    geom.setOrdinate(0,parameters.get(2).evaluate(object,Double.class));
  }
 else {
    if (parameters.size() > 2) {
      throw new IllegalArgumentException("Too many parameters for toDirectPosition function: " + parameters.toString() + ". Usage: toDirectPosition('SRS_NAME'(optional), srsName(optional), point 1, point 2(optional))");
    }
    if (parameters.size() == 1) {
      geom=new DirectPosition1D();
    }
 else {
      geom=new DirectPosition2D();
      geom.setOrdinate(1,parameters.get(1).evaluate(object,Double.class));
    }
    geom.setOrdinate(0,param1.evaluate(object,Double.class));
  }
  return (T)geom;
}
