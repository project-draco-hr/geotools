{
  GranuleCatalog catalog=null;
  Utilities.ensureNonNull("datastoreProperties",datastoreProperties);
  Properties properties=createGranuleCatalogProperties(datastoreProperties);
  final String SPIClass=properties.getProperty("SPI");
  try {
    final DataStoreFactorySpi spi=(DataStoreFactorySpi)Class.forName(SPIClass).newInstance();
    final Map<String,Serializable> params=Utils.createDataStoreParamsFromPropertiesFile(properties,spi);
    params.put("ParentLocation",DataUtilities.fileToURL(parent).toExternalForm());
    catalog=GranuleCatalogFactory.createGranuleCatalog(params,false,create,spi);
  }
 catch (  ClassNotFoundException e) {
    final IOException ioe=new IOException();
    throw (IOException)ioe.initCause(e);
  }
catch (  InstantiationException e) {
    final IOException ioe=new IOException();
    throw (IOException)ioe.initCause(e);
  }
catch (  IllegalAccessException e) {
    final IOException ioe=new IOException();
    throw (IOException)ioe.initCause(e);
  }
  return catalog;
}
