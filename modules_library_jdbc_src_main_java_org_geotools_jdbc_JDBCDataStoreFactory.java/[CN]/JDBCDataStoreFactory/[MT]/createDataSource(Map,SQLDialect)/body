{
  BasicDataSource dataSource=createDataSource(params);
  if (dialect instanceof PreparedStatementSQLDialect) {
    dataSource.setPoolPreparedStatements(true);
    Map<String,Serializable> testMap=new HashMap<String,Serializable>();
    setupParameters(testMap);
    if (testMap.containsKey(MAX_OPEN_PREPARED_STATEMENTS.key)) {
      Integer maxPreparedStatements=(Integer)MAX_OPEN_PREPARED_STATEMENTS.lookUp(params);
      if (maxPreparedStatements != null && maxPreparedStatements > 0)       dataSource.setMaxOpenPreparedStatements(maxPreparedStatements);
      if (maxPreparedStatements != null && maxPreparedStatements < 0)       dataSource.setPoolPreparedStatements(false);
    }
  }
  return new DBCPDataSource(dataSource);
}
