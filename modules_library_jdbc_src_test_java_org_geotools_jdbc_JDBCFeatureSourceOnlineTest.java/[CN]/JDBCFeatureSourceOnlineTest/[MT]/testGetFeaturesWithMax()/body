{
  Query q=new Query(featureSource.getSchema().getTypeName());
  q.setMaxFeatures(2);
  SimpleFeatureCollection features=featureSource.getFeatures(q);
  assertEquals(2,features.size());
  SimpleFeatureIterator it=features.features();
  try {
    int count=0;
    ReferencedEnvelope env=new ReferencedEnvelope(features.getSchema().getCoordinateReferenceSystem());
    while (it.hasNext()) {
      SimpleFeature f=it.next();
      env.expandToInclude(ReferencedEnvelope.reference(f.getBounds()));
      count++;
    }
    assertEquals(2,count);
    it.close();
    it=null;
    assertTrue(areReferencedEnvelopesEuqal(env,features.getBounds()));
  }
  finally {
    if (it != null)     it.close();
  }
}
