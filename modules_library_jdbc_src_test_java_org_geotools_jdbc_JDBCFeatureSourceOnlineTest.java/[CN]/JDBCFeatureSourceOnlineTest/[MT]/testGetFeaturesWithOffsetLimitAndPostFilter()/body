{
  Query q=new Query(featureSource.getSchema().getTypeName());
  FilterFactory ff=dataStore.getFilterFactory();
  PropertyIsEqualTo filter=ff.equal(ff.literal("one"),ff.function("strToLowerCase",ff.property(aname("stringProperty"))),true);
  q.setFilter(filter);
  q.setStartIndex(0);
  q.setMaxFeatures(1);
  SimpleFeatureCollection features=featureSource.getFeatures(q);
  assertEquals(1,features.size());
  SimpleFeatureIterator it=features.features();
  try {
    assertTrue(it.hasNext());
    SimpleFeature f=it.next();
    ReferencedEnvelope fe=ReferencedEnvelope.reference(f.getBounds());
    assertEquals(1,((Number)f.getAttribute(aname("intProperty"))).intValue());
    assertFalse(it.hasNext());
    it.close();
    it=null;
    assertTrue(areReferencedEnvelopesEuqal(fe,features.getBounds()));
  }
  finally {
    if (it != null)     it.close();
  }
}
