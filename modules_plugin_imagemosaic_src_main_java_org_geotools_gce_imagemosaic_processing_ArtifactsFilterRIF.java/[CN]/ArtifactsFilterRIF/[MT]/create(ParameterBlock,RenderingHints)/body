{
  final RenderedImage dataImage=paramBlock.getRenderedSource(0);
  ImageLayout layout=RIFUtil.getImageLayoutHint(renderingHints);
  if (layout == null) {
    layout=new ImageLayout();
  }
  final int threshold=(Integer)paramBlock.getObjectParameter(ArtifactsFilterDescriptor.THRESHOLD_ARG);
  final int filterSize=(Integer)paramBlock.getObjectParameter(ArtifactsFilterDescriptor.FILTERSIZE_ARG);
  final double[] bgValues=(double[])paramBlock.getObjectParameter(ArtifactsFilterDescriptor.BACKGROUND_ARG);
  SampleModel sm=layout.getSampleModel(null);
  if (sm == null) {
    final SampleModel dataSampleModel=dataImage.getSampleModel();
    final int dataType=dataSampleModel.getDataType();
    sm=RasterFactory.createComponentSampleModel(dataSampleModel,dataType,dataImage.getWidth(),dataImage.getHeight(),dataSampleModel.getNumBands());
    layout.setSampleModel(sm);
    if (layout.getColorModel(null) != null) {
      final ColorModel cm=ImageUtil.getCompatibleColorModel(sm,renderingHints);
      layout.setColorModel(cm);
    }
  }
  final ROI roi=(ROI)paramBlock.getObjectParameter(ArtifactsFilterDescriptor.ROI_ARG);
  return new ArtifactsFilterOpImage(dataImage,layout,renderingHints,roi,bgValues,threshold,filterSize);
}
