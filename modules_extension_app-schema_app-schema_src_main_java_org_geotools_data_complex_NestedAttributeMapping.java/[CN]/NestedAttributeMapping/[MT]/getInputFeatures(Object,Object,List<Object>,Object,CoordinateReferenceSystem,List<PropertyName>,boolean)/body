{
  if (isSameSource()) {
    throw new UnsupportedOperationException("Link field is missing from feature chaining mapping!");
  }
  if (source == null || !(nestedFeatureType instanceof AttributeExpressionImpl)) {
    Object featureTypeName=getNestedFeatureType(feature);
    if (featureTypeName == null || !(featureTypeName instanceof Name)) {
      return Collections.EMPTY_LIST;
    }
    FeatureTypeMapping featureTypeMapping=AppSchemaDataAccessRegistry.getMappingByName((Name)featureTypeName);
    if (featureTypeMapping == null) {
      LOGGER.info("FeatureTypeMapping for '" + featureTypeName + "' not found when evaluating filter!");
      return Collections.EMPTY_LIST;
    }
    nestedIdExpression=featureTypeMapping.getFeatureIdExpression();
    source=featureTypeMapping.getSource();
    if (source == null) {
      LOGGER.info("Feature source for '" + featureTypeName + "' not found when evaluating filter");
      return Collections.EMPTY_LIST;
    }
    List<AttributeMapping> mappings=featureTypeMapping.getAttributeMappingsIgnoreIndex(this.nestedTargetXPath);
    if (mappings.size() < 1) {
      throw new IllegalArgumentException("Mapping is missing for: '" + this.nestedTargetXPath + "'!");
    }
    nestedSourceExpression=mappings.get(0).getSourceExpression();
  }
  return getFilteredFeatures(foreignKeyValue);
}
