{
  SimpleFeature f=null;
  FeatureWriter<SimpleFeatureType,SimpleFeature> writer=null;
  String author=(String)t.getProperty(VersioningDataStore.AUTHOR);
  String message=(String)t.getProperty(VersioningDataStore.MESSAGE);
  Statement st=null;
  try {
    st=getConnection().createStatement();
    st.execute("LOCK TABLE " + VersionedPostgisDataStore.TBL_CHANGESETS + " IN EXCLUSIVE MODE");
    writer=wrapped.getFeatureWriterAppend(VersionedPostgisDataStore.TBL_CHANGESETS,t);
    f=writer.next();
    f.setAttribute("author",author);
    f.setAttribute("message",message);
    f.setAttribute("date",new Date());
    f.setDefaultGeometry(toLatLonRectange(bbox));
    writer.write();
  }
 catch (  IllegalAttributeException e) {
    throw new IOException("Could not set an attribute in changesets, " + "most probably the table schema has been tampered with.");
  }
catch (  SQLException e) {
    throw new DataSourceException("Could not set a lock on the table changesets",e);
  }
 finally {
    if (st != null)     JDBCUtils.close(st);
    if (writer != null)     writer.close();
  }
  return ((Long)f.getAttribute("revision")).longValue();
}
