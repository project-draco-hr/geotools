{
  if (granulesNumber == 0) {
    LOGGER.log(Level.FINE,"Unable to load any granuleDescriptor");
    return null;
  }
  LOGGER.fine("Producing the final mosaic, step 1, loop through granule collectors");
  final List<MosaicElement> mosaicInputs=new ArrayList<RasterLayerResponse.MosaicElement>();
  GranuleCollector first=null;
  final int size=granuleCollectors.size();
  for (  GranuleCollector collector : granuleCollectors) {
    if (LOGGER.isLoggable(Level.FINE)) {
      LOGGER.fine("Using collector with filter:" + collector.granuleFilter.toString());
    }
    final MosaicElement preparedMosaic=new Mosaicker(collector.collectGranules(),MergeBehavior.FLAT).createMosaic();
    mosaicInputs.add(preparedMosaic);
    if (first == null) {
      first=collector;
    }
  }
  LOGGER.fine("Producing the final mosaic, step 2, final mosaicking");
  if (size == 1) {
    return mosaicInputs.get(0).source;
  }
  return new Mosaicker(new MosaicInputs(first.doInputTransparency,first.hasAlpha,mosaicInputs,first.sourceThreshold),mergeBehavior).createMosaic().source;
}
