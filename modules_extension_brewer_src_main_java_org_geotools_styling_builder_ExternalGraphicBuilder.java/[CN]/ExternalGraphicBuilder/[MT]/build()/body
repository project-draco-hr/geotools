{
  if (unset) {
    return null;
  }
  ExternalGraphic externalGraphic;
  Collection<ColorReplacement> set=new HashSet<ColorReplacement>();
  for (  ColorReplacementBuilder replacement : replacements) {
    set.add(replacement.build());
  }
  if (inline != null) {
    externalGraphic=sf.externalGraphic(inline,set);
  }
 else   if (resource != null) {
    externalGraphic=sf.externalGraphic(resource,format,set);
  }
 else {
    externalGraphic=sf.createExternalGraphic(location,format);
  }
  if (parent == null)   reset();
  return externalGraphic;
}
