{
  ShapefileReader shp=openShapeReader(new GeometryFactory());
  DbaseFileReader dbf=openDbfReader();
  CoordinateReferenceSystem crs=null;
  PrjFileReader prj=null;
  try {
    prj=openPrjReader();
    if (prj != null) {
      crs=prj.getCoodinateSystem();
    }
  }
 catch (  FactoryException fe) {
    crs=null;
  }
  AttributeTypeBuilder build=new AttributeTypeBuilder();
  List<AttributeDescriptor> attributes=new ArrayList<AttributeDescriptor>();
  try {
    Class<?> geometryClass=JTSUtilities.findBestGeometryClass(shp.getHeader().getShapeType());
    build.setName(Classes.getShortName(geometryClass));
    build.setNillable(true);
    build.setCRS(crs);
    build.setBinding(geometryClass);
    GeometryType geometryType=build.buildGeometryType();
    attributes.add(build.buildDescriptor(BasicFeatureTypes.GEOMETRY_ATTRIBUTE_NAME,geometryType));
    Set<String> usedNames=new HashSet<String>();
    usedNames.add(BasicFeatureTypes.GEOMETRY_ATTRIBUTE_NAME);
    if (dbf != null) {
      DbaseFileHeader header=dbf.getHeader();
      for (int i=0, ii=header.getNumFields(); i < ii; i++) {
        Class attributeClass=header.getFieldClass(i);
        String name=header.getFieldName(i);
        if (usedNames.contains(name)) {
          String origional=name;
          int count=1;
          name=name + count;
          while (usedNames.contains(name)) {
            count++;
            name=origional + count;
          }
        }
        usedNames.add(name);
        int length=header.getFieldLength(i);
        build.setNillable(true);
        build.setLength(length);
        build.setBinding(attributeClass);
        attributes.add(build.buildDescriptor(name));
      }
    }
    return attributes;
  }
  finally {
    try {
      if (prj != null) {
        prj.close();
      }
    }
 catch (    IOException ioe) {
    }
    try {
      if (dbf != null) {
        dbf.close();
      }
    }
 catch (    IOException ioe) {
    }
    try {
      if (shp != null) {
        shp.close();
      }
    }
 catch (    IOException ioe) {
    }
  }
}
