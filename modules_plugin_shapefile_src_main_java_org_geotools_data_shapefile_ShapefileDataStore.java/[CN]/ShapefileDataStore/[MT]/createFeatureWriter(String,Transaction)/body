{
  typeCheck(typeName);
  FeatureReader<SimpleFeatureType,SimpleFeature> featureReader;
  ShapefileAttributeReader attReader=getAttributesReader(true,null);
  try {
    SimpleFeatureType schema=getSchema();
    if (schema == null) {
      throw new IOException("To create a shapefile, you must first call createSchema()");
    }
    featureReader=createFeatureReader(typeName,attReader,schema);
  }
 catch (  Exception e) {
    featureReader=new EmptyFeatureReader<SimpleFeatureType,SimpleFeature>(schema);
  }
  return new ShapefileFeatureWriter(typeName,shpFiles,attReader,featureReader,dbfCharset,dbfTimeZone);
}
