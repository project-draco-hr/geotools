{
  FeatureIterator<? extends Feature> i=collection.features();
  try {
    CoordinateReferenceSystem crs=collection.getSchema().getCoordinateReferenceSystem();
    ReferencedEnvelope bounds=new ReferencedEnvelope(crs);
    while (i.hasNext()) {
      BoundingBox geomBounds=((SimpleFeature)i.next()).getBounds();
      if (!geomBounds.isEmpty()) {
        bounds.include(geomBounds);
      }
    }
    return bounds;
  }
  finally {
    if (i != null) {
      i.close();
    }
  }
}
