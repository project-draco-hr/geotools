{
  if (!EventQueue.isDispatchThread()) {
    throw new IllegalStateException("Constructor should only be called on the event dispatch thread");
  }
  dialog=new JDialog();
  dialog.setModalityType(ModalityType.APPLICATION_MODAL);
  dialog.setResizable(false);
  dialog.setTitle(title == null ? "Choose Projection" : title);
  final int WIDTH=400;
  final String MARGIN="10";
  JPanel panel=new JPanel(new MigLayout(new LC().insetsAll(MARGIN)));
  if (authority == null) {
    authority=DEFAULT_AUTHORITY;
  }
  model=new CRSListModel(authority);
  panel.add(new JLabel("Enter sub-string to filter list"),"wrap");
  final JTextField filterFld=new JTextField();
  filterFld.getDocument().addDocumentListener(new DocumentListener(){
    @Override public void insertUpdate(    DocumentEvent e){
      model.setFilter(filterFld.getText());
    }
    @Override public void removeUpdate(    DocumentEvent e){
      model.setFilter(filterFld.getText());
    }
    @Override public void changedUpdate(    DocumentEvent e){
      model.setFilter(filterFld.getText());
    }
  }
);
  panel.add(filterFld,String.format("w %d!, wrap",WIDTH));
  final JList listBox=new JList(model);
  listBox.addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    MouseEvent e){
      if (e.getClickCount() == 2) {
        selectCRS(listBox.getSelectedIndex());
      }
    }
  }
);
  JScrollPane listPane=new JScrollPane(listBox);
  listBox.setBorder(BorderFactory.createEtchedBorder());
  listBox.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
  int initialIndex=model.findCode(initialCode);
  if (initialIndex >= 0) {
    listBox.setSelectedIndex(initialIndex);
    Point p=listBox.indexToLocation(initialIndex);
    JViewport port=listPane.getViewport();
    port.setViewPosition(p);
  }
  panel.add(listPane,String.format("w %d!, h %d!, wrap",WIDTH,WIDTH / 2));
  Action okAction=new AbstractAction("OK"){
    @Override public void actionPerformed(    ActionEvent ae){
      if (model.getSize() > 0) {
        if (model.getSize() == 1) {
          selectCRS(0);
        }
 else {
          int index=listBox.getSelectedIndex();
          if (index >= 0) {
            selectCRS(index);
          }
        }
      }
    }
  }
;
  JButton okBtn=new JButton(okAction);
  filterFld.setAction(okAction);
  panel.add(okBtn,"align center, split 2");
  JButton cancelBtn=new JButton("Cancel");
  cancelBtn.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent ae){
      crs=null;
      closeDialog();
    }
  }
);
  panel.add(cancelBtn);
  dialog.add(panel);
  dialog.pack();
}
