{
  if (tx != null && this.tx != null) {
    throw new IllegalStateException("New transaction set without " + "closing old transaction first.");
  }
  if (tx == null) {
    if (cx != null) {
      if (!external) {
        dataStore.closeSafe(cx);
      }
    }
 else {
      dataStore.getLogger().warning("Transaction is attempting to " + "close an already closed connection");
    }
    cx=null;
  }
  this.tx=tx;
}
