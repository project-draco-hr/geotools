{
  if (metadata != null && imageIndex >= 0 && imageIndex < metadata.length) {
    final GeographicMetadata parser=metadata[imageIndex];
    if (parser != null) {
      return parser;
    }
  }
  final IIOMetadata candidate;
  final boolean oldIgnore=ignoreMetadata;
  try {
    ignoreMetadata=false;
    candidate=getImageMetadata(imageIndex);
  }
  finally {
    ignoreMetadata=oldIgnore;
  }
  if (candidate == null) {
    return null;
  }
  final GeographicMetadata parser;
  if (candidate instanceof GeographicMetadata) {
    parser=(GeographicMetadata)candidate;
  }
 else {
    parser=new GeographicMetadata(this);
    parser.mergeTree(candidate);
  }
  if (metadata == null) {
    metadata=new GeographicMetadata[Math.max(imageIndex + 1,4)];
  }
  if (imageIndex >= metadata.length) {
    metadata=XArray.resize(metadata,Math.max(imageIndex + 1,metadata.length * 2));
  }
  metadata[imageIndex]=parser;
  return parser;
}
