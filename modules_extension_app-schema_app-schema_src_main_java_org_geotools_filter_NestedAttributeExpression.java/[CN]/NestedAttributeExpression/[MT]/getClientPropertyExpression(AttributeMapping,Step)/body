{
  if (lastStep.isXmlAttribute()) {
    Map<Name,Expression> clientProperties=mapping.getClientProperties();
    QName lastStepQName=lastStep.getName();
    Name lastStepName;
    if (lastStepQName.getPrefix() != null && lastStepQName.getPrefix().length() > 0 && (lastStepQName.getNamespaceURI() == null || lastStepQName.getNamespaceURI().length() == 0)) {
      String prefix=lastStepQName.getPrefix();
      String uri=namespaceSupport.getURI(prefix);
      lastStepName=Types.typeName(uri,lastStepQName.getLocalPart());
    }
 else {
      lastStepName=Types.toTypeName(lastStepQName);
    }
    if (clientProperties.containsKey(lastStepName)) {
      return (Expression)clientProperties.get(lastStepName);
    }
  }
  return null;
}
