{
  Object fTypeName=nestedMapping.getNestedFeatureType(root);
  if (fTypeName == null || !(fTypeName instanceof Name)) {
    return null;
  }
  boolean hasSimpleFeatures=AppSchemaDataAccessRegistry.hasName((Name)fTypeName);
  Object val=getValue(nestedMapping.getSourceExpression(),root);
  if (val == null) {
    return null;
  }
  if (hasSimpleFeatures) {
    return nestedMapping.getInputFeatures(val,fMapping);
  }
 else {
    return nestedMapping.getFeatures(val,null,root,0,null);
  }
}
