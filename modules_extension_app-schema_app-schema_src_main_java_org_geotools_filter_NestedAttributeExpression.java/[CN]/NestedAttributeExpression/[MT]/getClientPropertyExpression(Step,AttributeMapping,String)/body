{
  if (nextRootStep.isXmlAttribute()) {
    Map<Name,Expression> clientProperties=mapping.getClientProperties();
    QName lastStepName=nextRootStep.getName();
    Name lastStep;
    if (lastStepName.getPrefix() != null && lastStepName.getPrefix().length() > 0 && (lastStepName.getNamespaceURI() == null || lastStepName.getNamespaceURI().length() == 0)) {
      String prefix=lastStepName.getPrefix();
      String uri=namespaceSupport.getURI(prefix);
      lastStep=Types.typeName(uri,lastStepName.getLocalPart());
    }
 else {
      lastStep=Types.toTypeName(lastStepName);
    }
    if (lastStep.getLocalPart().equals("id")) {
      if (mapping.getIdentifierExpression() == Expression.NIL) {
        return CommonFactoryFinder.getFilterFactory(null).property("@id");
      }
 else {
        return mapping.getIdentifierExpression();
      }
    }
 else     if (clientProperties.containsKey(lastStep)) {
      return (Expression)clientProperties.get(lastStep);
    }
  }
  return null;
}
