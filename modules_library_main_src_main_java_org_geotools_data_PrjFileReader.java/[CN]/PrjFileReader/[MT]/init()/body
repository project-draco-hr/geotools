{
  if (channel instanceof FileChannel && USE_MEMORY_MAPPED_BUFFERS) {
    FileChannel fc=(FileChannel)channel;
    buffer=fc.map(FileChannel.MapMode.READ_ONLY,0,fc.size());
    buffer.position((int)fc.position());
  }
 else {
    int size=8 * 1024;
    buffer=ByteBuffer.allocateDirect(size);
    fill(buffer,channel);
    buffer.flip();
  }
  buffer.order(ByteOrder.LITTLE_ENDIAN);
  charBuffer=CharBuffer.allocate(8 * 1024);
  Charset chars=Charset.forName("ISO-8859-1");
  decoder=chars.newDecoder();
}
