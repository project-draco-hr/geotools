{
  ImageLayout layout=(ImageLayout)hints.get(JAI.KEY_IMAGE_LAYOUT);
  if (layout != null) {
    layout=(ImageLayout)layout.clone();
  }
 else {
    layout=new ImageLayout(sourceImage);
    layout.unsetTileLayout();
  }
  if ((layout.getValidMask() & (ImageLayout.TILE_WIDTH_MASK | ImageLayout.TILE_HEIGHT_MASK | ImageLayout.TILE_GRID_X_OFFSET_MASK| ImageLayout.TILE_GRID_Y_OFFSET_MASK)) == 0) {
    layout.setTileGridXOffset(layout.getMinX(sourceImage));
    layout.setTileGridYOffset(layout.getMinY(sourceImage));
    final int width=layout.getWidth(sourceImage);
    final int height=layout.getHeight(sourceImage);
    if (layout.getTileWidth(sourceImage) > width)     layout.setTileWidth(width);
    if (layout.getTileHeight(sourceImage) > height)     layout.setTileHeight(height);
  }
  return layout;
}
