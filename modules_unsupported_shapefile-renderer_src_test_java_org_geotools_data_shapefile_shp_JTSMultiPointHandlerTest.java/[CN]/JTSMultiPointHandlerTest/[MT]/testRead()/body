{
  URL url=TestData.url("shapes/MultiPointTest.shp");
  ShapefileDataStore ds=(ShapefileDataStore)new ShapefileDataStoreFactory().createDataStore(url);
  Envelope env=ds.getFeatureSource().getBounds();
  CoordinateReferenceSystem crs=DefaultGeographicCRS.WGS84;
  MathTransform mt=CRS.findMathTransform(crs,DefaultGeographicCRS.WGS84);
  Rectangle rectangle=new Rectangle(300,0,300,300);
  AffineTransform transform=RendererUtilities.worldToScreenTransform(env,rectangle);
  GeneralMatrix matrix=new GeneralMatrix(transform);
  MathTransform at=ReferencingFactoryFinder.getMathTransformFactory(null).createAffineTransform(matrix);
  mt=ReferencingFactoryFinder.getMathTransformFactory(null).createConcatenatedTransform(mt,at);
  ShapefileReader reader=new ShapefileReader(ShapefileRendererUtil.getShpFiles(ds),false,false);
  reader.setHandler(new org.geotools.renderer.shape.shapehandler.jts.MultiPointHandler(reader.getHeader().getShapeType(),env,rectangle,mt,false));
  ds.getSchema();
  Object shape=reader.nextRecord().shape();
  assertNotNull(shape);
  assertTrue(shape instanceof Geometry);
  Coordinate[] coords=((Geometry)shape).getCoordinates();
  for (int i=0; i < coords.length; i++) {
    Coordinate coordinate=coords[i];
    assertNotNull(coordinate);
  }
  int i=0;
  while (reader.hasNext()) {
    i++;
    shape=reader.nextRecord().shape();
    assertNotNull(shape);
    assertTrue(shape instanceof Geometry);
  }
  assertEquals(ds.getFeatureSource().getCount(Query.ALL) - 1,i);
}
