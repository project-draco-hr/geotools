{
  boolean hasToBeRegistered=false;
  XSDTypeDefinition typeDefinition;
  if (elemDecl.isElementDeclarationReference()) {
    elemDecl=elemDecl.getResolvedElementDeclaration();
  }
  typeDefinition=elemDecl.getAnonymousTypeDefinition();
  if (typeDefinition == null) {
    hasToBeRegistered=true;
    typeDefinition=elemDecl.getTypeDefinition();
  }
  if (typeDefinition == null) {
    throw new NoSuchElementException("The element declaration " + elemDecl.getTargetNamespace() + "#"+ elemDecl.getName()+ " has a null type definition, can't continue, fix it on the schema");
  }
  AttributeType type;
  if (hasToBeRegistered) {
    String targetNamespace=typeDefinition.getTargetNamespace();
    String name=typeDefinition.getName();
    Name typeName=Types.typeName(targetNamespace,name);
    type=getAttributeType(typeName,crs,attMappings);
    if (type == null) {
      type=createType(typeName,typeDefinition,crs,attMappings,false);
    }
  }
 else {
    String name=elemDecl.getName();
    String targetNamespace=elemDecl.getTargetNamespace();
    Name overrideName=Types.typeName(targetNamespace,name);
    type=createType(overrideName,typeDefinition,crs,attMappings,true);
  }
  return type;
}
