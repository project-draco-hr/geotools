{
  if (layers == null || layers.isEmpty())   return;
  GetMapRequest mapRequest=wms.createGetMapRequest();
  CRSEnvelope bounds=null;
  for (Iterator i=layers.iterator(); i.hasNext(); ) {
    Layer layer=(Layer)i.next();
    String namedStyle=getNamedStyle(layer);
    mapRequest.addLayer(layer,namedStyle);
    CRSEnvelope box=layer.getLatLonBoundingBox();
    box.setEPSGCode("EPSG:4326");
    if (box != null) {
      if (bounds != null) {
        bounds.setMinX(Math.min(bounds.getMinX(),box.getMinX()));
        bounds.setMaxX(Math.max(bounds.getMaxX(),box.getMaxX()));
        bounds.setMinY(Math.min(bounds.getMinY(),box.getMinY()));
        bounds.setMaxY(Math.max(bounds.getMaxY(),box.getMaxY()));
      }
 else {
        bounds=box;
      }
    }
  }
  if (bounds == null) {
    bounds=new CRSEnvelope();
    bounds.setEPSGCode("EPSG:4326");
  }
  mapRequest.setFormat(getImageFormat(wms));
  mapRequest.setSRS(bounds.getEPSGCode());
  mapRequest.setBBox(bounds);
  mapRequest.setDimensions(panel.getWidth(),panel.getHeight());
  URL url=mapRequest.getFinalURL();
  ImageIcon load=new ImageIcon(url);
  image=load.getImage();
  panel.repaint();
}
