{
  GetMapRequest mapRequest=wms.createGetMapRequest();
  String style=getNamedStyle(layer);
  mapRequest.addLayer(layer,style);
  mapRequest.setFormat(getImageFormat(wms));
  CRSEnvelope box=getCRSEnvelope(layer,null);
  if (box == null) {
    box=layer.getLatLonBoundingBox();
    box.setEPSGCode("EPSG:4326");
  }
  mapRequest.setSRS(box.getEPSGCode());
  mapRequest.setBBox(box);
  mapRequest.setDimensions(panel.getWidth(),panel.getHeight());
  URL url=mapRequest.getFinalURL();
  ImageIcon load=new ImageIcon(url);
  image=load.getImage();
  panel.repaint();
}
