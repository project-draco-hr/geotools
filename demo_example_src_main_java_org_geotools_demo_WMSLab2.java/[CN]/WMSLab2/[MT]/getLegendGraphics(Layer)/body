{
  Icon icon=null;
  WMSCapabilities capabilities=wms.getCapabilities();
  WMSRequest request=capabilities.getRequest();
  OperationType description=request.getGetLegendGraphic();
  if (description == null)   return null;
  GetLegendGraphicRequest legendGraphicsRequest=wms.createGetLegendGraphicRequest();
  legendGraphicsRequest.setLayer(layer.getName());
  legendGraphicsRequest.setStyle(getNamedStyle(layer));
  legendGraphicsRequest.setFormat((String)description.getFormats().iterator().next());
  URL url=legendGraphicsRequest.getFinalURL();
  return new ImageIcon(url);
}
