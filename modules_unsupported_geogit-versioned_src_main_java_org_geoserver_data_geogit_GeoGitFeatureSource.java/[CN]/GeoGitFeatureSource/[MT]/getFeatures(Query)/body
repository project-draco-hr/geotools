{
  Filter filter=query.getFilter();
  if (filter == null) {
    filter=Filter.INCLUDE;
  }
  if (Filter.EXCLUDE.equals(filter)) {
    return new EmptyFeatureCollection(type);
  }
  final Query query2=reprojectFilter(query);
  filter=query2.getFilter();
  final ObjectDatabase lookupDatabase=dataStore.getRepository().getIndex().getDatabase();
  final RevTree typeTree=getCurrentVersion();
  GeoGitSimpleFeatureCollection featureCollection;
  featureCollection=new GeoGitSimpleFeatureCollection(type,filter,lookupDatabase,typeTree);
  final int maxFeatures=query2.getMaxFeatures();
  if (maxFeatures > 0 && maxFeatures != Query.DEFAULT_MAX) {
    featureCollection.setMaxFeatures(maxFeatures);
  }
  return featureCollection;
}
