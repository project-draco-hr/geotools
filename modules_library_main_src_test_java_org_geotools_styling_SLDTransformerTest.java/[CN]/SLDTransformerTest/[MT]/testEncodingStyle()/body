{
  RasterSymbolizer defaultRasterSymbolizer=sf.createRasterSymbolizer();
  String xmlFragment=transformer.transform(defaultRasterSymbolizer);
  assertNotNull(xmlFragment);
  StyleFactory styleFactory=CommonFactoryFinder.getStyleFactory(GeoTools.getDefaultHints());
  StyleBuilder styleBuilder=new StyleBuilder(styleFactory);
  RasterSymbolizer rasterSymbolizer=styleFactory.createRasterSymbolizer();
  rasterSymbolizer.setOpacity(CommonFactoryFinder.getFilterFactory(GeoTools.getDefaultHints()).literal(0.25));
  ChannelSelectionImpl csi=new ChannelSelectionImpl();
  SelectedChannelTypeImpl redChannel=new SelectedChannelTypeImpl();
  redChannel.setChannelName("1");
  ContrastEnhancementImpl rcei=new ContrastEnhancementImpl();
  rcei.setHistogram();
  redChannel.setContrastEnhancement(rcei);
  SelectedChannelTypeImpl greenChannel=new SelectedChannelTypeImpl();
  greenChannel.setChannelName("4");
  ContrastEnhancementImpl gcei=new ContrastEnhancementImpl();
  gcei.setGammaValue(ff.literal(2.5));
  greenChannel.setContrastEnhancement(gcei);
  SelectedChannelTypeImpl blueChannel=new SelectedChannelTypeImpl();
  blueChannel.setChannelName("2");
  ContrastEnhancementImpl bcei=new ContrastEnhancementImpl();
  bcei.setNormalize();
  blueChannel.setContrastEnhancement(bcei);
  csi.setRGBChannels(redChannel,greenChannel,blueChannel);
  rasterSymbolizer.setChannelSelection(csi);
  Style style=styleBuilder.createStyle(rasterSymbolizer);
  style.setName("simpleStyle");
  NamedLayer layer=styleFactory.createNamedLayer();
  layer.addStyle(style);
  StyledLayerDescriptor sld=styleFactory.createStyledLayerDescriptor();
  sld.addStyledLayer(layer);
  xmlFragment=transformer.transform(sld);
  assertNotNull(xmlFragment);
  SLDParser parser=new SLDParser(sf);
  parser.setInput(new StringReader(xmlFragment));
  Style[] stuff=parser.readXML();
  Style out=stuff[0];
  assertNotNull(out);
  assertEquals(0.25,SLD.rasterOpacity(out),0d);
}
