{
  FeatureIterator<F> fi=null;
  try {
    fi=features();
    ReferencedEnvelope bounds=null;
    while (fi.hasNext()) {
      F feature=fi.next();
      ReferencedEnvelope featureEnvelope=null;
      if (feature != null && feature.getBounds() != null) {
        featureEnvelope=ReferencedEnvelope.reference(feature.getBounds());
      }
      if (featureEnvelope != null) {
        if (bounds == null) {
          bounds=new ReferencedEnvelope(featureEnvelope);
        }
 else {
          bounds.expandToInclude(featureEnvelope);
        }
      }
    }
    return bounds;
  }
  finally {
    if (fi != null) {
      fi.close();
    }
  }
}
