{
  TreeSet<Integer> indexes=new TreeSet<>(new ZIndexComparator());
  for (  CssRule rule : rules) {
    Set<Integer> ruleIndexes=rule.getZIndexes();
    indexes.addAll(ruleIndexes);
  }
  List<List<CssRule>> result=new ArrayList<>();
  int symbolizerPropertyCount=0;
  for (  Integer index : indexes) {
    List<CssRule> rulesByIndex=new ArrayList<>();
    for (    CssRule rule : rules) {
      CssRule subRule=rule.getSubRuleByZIndex(index);
      if (subRule != null) {
        if (subRule.hasSymbolizerProperty()) {
          symbolizerPropertyCount++;
        }
        rulesByIndex.add(subRule);
      }
    }
    if (symbolizerPropertyCount > 0) {
      result.add(rulesByIndex);
    }
  }
  return result;
}
