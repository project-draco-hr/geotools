{
  TypeNameExtractor extractor=new TypeNameExtractor();
  for (  CssRule rule : rules) {
    rule.getSelector().accept(extractor);
  }
  Map<String,List<CssRule>> result=new LinkedHashMap<>();
  Set<TypeName> typeNames=extractor.getTypeNames();
  if (typeNames.size() == 1 && typeNames.contains(TypeName.DEFAULT)) {
    result.put(TypeName.DEFAULT.name,rules);
  }
  for (  TypeName tn : typeNames) {
    List<CssRule> typeNameRules=new ArrayList<>();
    for (    CssRule rule : rules) {
      TypeNameSimplifier simplifier=new TypeNameSimplifier(tn);
      Selector simplified=(Selector)rule.getSelector().accept(simplifier);
      if (simplified != Selector.REJECT) {
        typeNameRules.add(new CssRule(simplified,rule.getProperties(),rule.getComment()));
      }
    }
    result.put(tn.name,typeNameRules);
  }
  return result;
}
