{
  EFeatureDataStore eStore;
  Map<String,Serializable> params;
  try {
    dTime();
    params=eParams.createParams(eResourceURI.toString(),null);
    eStore=eStoreFactory.createDataStore(params);
    Hints hints=new Hints();
    hints.put(EFeatureHints.EFEATURE_SINGLETON_FEATURES,false);
    hints.put(EFeatureHints.EFEATURE_VALUES_DETACHED,false);
    for (    String eType : new String[]{"efeature.EFeatureData","efeature.EFeatureCompatibleData"}) {
      Query query=new Query(eType,Filter.INCLUDE);
      query.setHints(hints);
      EFeatureReader eReader=eStore.getFeatureReader(query);
      EFeatureHints eHints=eReader.eHints();
      eHints.eSetValuesDetached(eDetached);
      query.getHints().put(EFeatureHints.EFEATURE_SINGLETON_FEATURES,false);
      ESimpleFeature f1=eReader.next();
      ESimpleFeature f2=eReader.next();
      assertNotSame("Features are same instances [" + eType + ",detached:="+ eDetached+ ",singleton:=false]",f1,f2);
      assertNotSame("EObjects are same instances [" + eType + ",detached:="+ eDetached+ ",singleton:=false]",f1.eObject(),f2.eObject());
      assertNotSame("EFeatures are same instances [" + eType + ",detached:="+ eDetached+ ",singleton:=false]",f1.eFeature(),f2.eFeature());
      eHints.eSetSingletonFeatures(true);
      f1=eReader.next();
      f2=eReader.next();
      assertSame("Features are not same instances [" + eType + ",detached:="+ eDetached+ ",singleton:=true]",f1,f2);
      assertSame("EObjects are not same instances [" + eType + ",detached:="+ eDetached+ ",singleton:=true]",f1.eObject(),f2.eObject());
      assertSame("EFeatures are not same instances [" + eType + ",detached:="+ eDetached+ ",singleton:=true]",f1.eFeature(),f2.eFeature());
      eHints.eSetSingletonFeatures(false);
      f1=eReader.next();
      f2=eReader.next();
      assertNotSame("Features are same instances [transitive," + eType + ",detached:="+ eDetached+ ",singleton:=false]",f1,f2);
      assertNotSame("EObjects are same instances [transitive," + eType + ",detached:="+ eDetached+ ",singleton:=false]",f1.eObject(),f2.eObject());
      assertNotSame("EFeatures are same instances [transitive," + eType + ",detached:="+ eDetached+ ",singleton:=false]",f1.eFeature(),f2.eFeature());
      eStore.dispose();
    }
  }
 catch (  Exception e) {
    LOGGER.log(Level.SEVERE,e.getMessage(),e);
    fail(e);
  }
}
