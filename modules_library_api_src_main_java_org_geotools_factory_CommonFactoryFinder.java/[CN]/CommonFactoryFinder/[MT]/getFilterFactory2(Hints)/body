{
  hints=mergeSystemHints(hints);
  final Object h=hints.get(Hints.FILTER_FACTORY);
  if (!(h instanceof Class ? FilterFactory2.class.isAssignableFrom((Class<?>)h) : h instanceof FilterFactory2)) {
    hints=new Hints(hints);
    hints.put(Hints.FILTER_FACTORY,FilterFactory2.class);
  }
  return (FilterFactory2)getFilterFactory(hints);
}
