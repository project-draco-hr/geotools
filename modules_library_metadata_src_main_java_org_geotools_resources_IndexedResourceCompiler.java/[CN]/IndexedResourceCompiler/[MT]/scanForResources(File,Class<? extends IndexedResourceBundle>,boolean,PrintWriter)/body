{
  final String fullname=bundleClass.getName();
  final int packageEnd=fullname.lastIndexOf('.');
  final String packageName=fullname.substring(0,packageEnd);
  final String classname=fullname.substring(packageEnd + 1);
  final String packageDir=packageName.replace('.','/');
  final File srcDir=new File(sourceDirectory,"java/" + packageDir);
  final File utfDir=new File(sourceDirectory,"resources/" + packageDir);
  if (!srcDir.isDirectory()) {
    out.print('"');
    out.print(srcDir.getPath());
    out.println("\" is not a directory.");
    return;
  }
  if (!utfDir.isDirectory()) {
    out.print('"');
    out.print(utfDir.getPath());
    out.println("\" is not a directory.");
    return;
  }
  IndexedResourceCompiler compiler=null;
  final File[] content=srcDir.listFiles();
  File defaultLanguage=null;
  for (int i=0; i < content.length; i++) {
    final File file=content[i];
    final String filename=file.getName();
    if (filename.startsWith(classname) && filename.endsWith(PROPERTIES_EXT)) {
      if (compiler == null) {
        compiler=new IndexedResourceCompiler(sourceDirectory,bundleClass,renumber,out);
      }
      compiler.processPropertyFile(file);
      final String noExt=filename.substring(0,filename.length() - PROPERTIES_EXT.length());
      final File utfFile=new File(utfDir,noExt + RESOURCES_EXT);
      compiler.writeUTFFile(utfFile);
      if (noExt.equals(classname)) {
        defaultLanguage=file;
      }
    }
  }
  if (compiler != null) {
    if (defaultLanguage != null) {
      compiler.resources.clear();
      compiler.resources.putAll(loadPropertyFile(defaultLanguage));
    }
    compiler.writeJavaSource(bundleClass);
  }
}
