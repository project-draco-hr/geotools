{
  if (closed) {
    throw new IOException("FeatureWriter has been closed");
  }
  if (current == null) {
    throw new IOException("No feature available to write");
  }
  LOGGER.fine("write called, live is " + live + " and cur is "+ current);
  if (live != null) {
    if (live.equals(current)) {
      live=null;
      current=null;
    }
 else {
      try {
        doUpdate(live,current);
        ReferencedEnvelope bounds=new ReferencedEnvelope();
        bounds.include(live.getBounds());
        bounds.include(current.getBounds());
        queryData.fireFeaturesChanged(bounds,false);
      }
 catch (      SQLException sqlException) {
        queryData.close(sqlException);
        throw new DataSourceException("Error updating row",sqlException);
      }
      live=null;
      current=null;
    }
  }
 else {
    LOGGER.fine("doing insert in jdbc featurewriter");
    try {
      doInsert((MutableFIDFeature)current);
      queryData.fireFeaturesAdded(ReferencedEnvelope.reference(current.getBounds()),false);
    }
 catch (    SQLException e) {
      throw new DataSourceException("Row adding failed.",e);
    }
    current=null;
  }
}
