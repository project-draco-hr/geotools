{
  this.layers.add(layer);
  if (srsName == null) {
    for (    String srs : layer.getBoundingBoxes().keySet()) {
      try {
        CRS.decode(srs);
        srsName=srs;
        break;
      }
 catch (      Exception e) {
      }
    }
    if (srsName == null) {
      if (layer.getSrs().contains("EPSG:4326")) {
        srsName="EPSG:4326";
      }
 else {
        srsName=layer.getSrs().iterator().next();
      }
    }
    validSRS=layer.getSrs();
  }
 else {
    Set<String> intersection=new HashSet<String>(validSRS);
    intersection.retainAll(layer.getSrs());
    if (!intersection.contains(srsName)) {
      if (intersection.size() == 0) {
        throw new IllegalArgumentException("The layer being appended does " + "not have any SRS in common with the ones already " + "included in the WMS request, cannot be merged");
      }
 else       if (intersection.contains("EPSG:4326")) {
        srsName="EPSG:4326";
      }
 else {
        srsName=intersection.iterator().next();
      }
      this.validSRS=intersection;
    }
  }
  CoordinateReferenceSystem crs=null;
  try {
    crs=CRS.decode(srsName);
  }
 catch (  Exception e) {
    LOGGER.log(Level.FINE,"Bounds unavailable for layer" + layer);
  }
  this.crs=crs;
  updateBounds();
}
