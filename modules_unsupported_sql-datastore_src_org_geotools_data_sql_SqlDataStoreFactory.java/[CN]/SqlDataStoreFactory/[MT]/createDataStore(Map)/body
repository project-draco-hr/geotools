{
  if (!canProcess(params)) {
    throw new DataSourceException("can't process " + params);
  }
  Map surrogateParams=ViewRegisteringFactoryHelper.cleanUpSurrogateParams(params);
  DataStore surrogate=DataStoreFinder.getDataStore(surrogateParams);
  if (surrogate == null) {
    throw new DataSourceException("Can't locate surrogate datastore: " + surrogateParams);
  }
  if (!(surrogate instanceof SqlDataStore)) {
    throw new DataSourceException("Surrogate datastore is not a SqlDataStore: " + surrogate.getClass());
  }
  SqlDataStore sqlDs=(SqlDataStore)surrogate;
  ViewRegisteringFactoryHelper.registerSqlViews(sqlDs,params);
  return sqlDs;
}
