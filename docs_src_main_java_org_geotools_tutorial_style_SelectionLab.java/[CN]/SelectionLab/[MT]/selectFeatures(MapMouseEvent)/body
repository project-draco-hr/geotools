{
  System.out.println("Mouse click at: " + ev.getMapPosition());
  Point screenPos=ev.getPoint();
  Rectangle screenRect=new Rectangle(screenPos.x - 2,screenPos.y - 2,5,5);
  AffineTransform screenToWorld=mapFrame.getMapPane().getScreenToWorldTransform();
  Rectangle2D worldRect=screenToWorld.createTransformedShape(screenRect).getBounds2D();
  ReferencedEnvelope bbox=new ReferencedEnvelope(worldRect,mapFrame.getMapContent().getCoordinateReferenceSystem());
  Filter filter=ff.intersects(ff.property(geometryAttributeName),ff.literal(bbox));
  try {
    SimpleFeatureCollection selectedFeatures=featureSource.getFeatures(filter);
    SimpleFeatureIterator iter=selectedFeatures.features();
    Set<FeatureId> IDs=new HashSet<FeatureId>();
    try {
      while (iter.hasNext()) {
        SimpleFeature feature=iter.next();
        IDs.add(feature.getIdentifier());
        System.out.println("   " + feature.getIdentifier());
      }
    }
  finally {
      iter.close();
    }
    if (IDs.isEmpty()) {
      System.out.println("   no feature selected");
    }
    displaySelectedFeatures(IDs);
  }
 catch (  Exception ex) {
    ex.printStackTrace();
    return;
  }
}
