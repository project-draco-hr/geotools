{
  if (envelope == null || gridToWorldTransform == null) {
    boolean isEnvelope=envelope == null;
    boolean isG2W=gridToWorldTransform == null;
    boolean twoErrors=isEnvelope && isG2W;
    final StringBuilder errorMessage=new StringBuilder();
    errorMessage.append("Specified ").append(isEnvelope ? "envelope" : "").append(twoErrors ? ", " : "").append(isG2W ? "grid to world transformation " : "").append("is null");
    throw new IllegalArgumentException(errorMessage.toString());
  }
  final MathTransform worldToGridTransform=gridToWorldTransform.inverse();
  final GeneralEnvelope rasterArea=CRS.transform(worldToGridTransform,envelope);
  final Rectangle2D ordinates=rasterArea.toRectangle2D();
  return ordinates.getBounds();
}
