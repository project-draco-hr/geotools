{
  clearAbortRequest();
  final UnidataSlice2DIndex slice2DIndex=getSlice2DIndex(imageIndex);
  final String variableName=slice2DIndex.getVariableName();
  final UnidataVariableAdapter wrapper=getCoverageDescriptor(new NameImpl(variableName));
  final int strideX, strideY;
  final int[] dstBands;
  if (param != null) {
    strideX=param.getSourceXSubsampling();
    strideY=param.getSourceYSubsampling();
    dstBands=param.getDestinationBands();
  }
 else {
    strideX=1;
    strideY=1;
    dstBands=null;
  }
  final int width=wrapper.getWidth();
  final int height=wrapper.getHeight();
  final Rectangle srcRegion=new Rectangle();
  final Rectangle destRegion=new Rectangle();
  computeRegions(param,width,height,null,srcRegion,destRegion);
  flipVertically(param,height,srcRegion);
  int destWidth=destRegion.x + destRegion.width;
  int destHeight=destRegion.y + destRegion.height;
  final List<Range> ranges=new LinkedList<Range>();
  try {
    int first=slice2DIndex.getTIndex();
    int length=1;
    int stride=1;
    if (first != -1) {
      ranges.add(new Range(first,first + length - 1,stride));
    }
    first=slice2DIndex.getZIndex();
    if (first != -1) {
      ranges.add(new Range(first,first + length - 1,stride));
    }
    first=srcRegion.y;
    length=srcRegion.height;
    stride=strideY;
    ranges.add(new Range(first,first + length - 1,stride));
    first=srcRegion.x;
    length=srcRegion.width;
    stride=strideX;
    ranges.add(new Range(first,first + length - 1,stride));
  }
 catch (  InvalidRangeException e) {
    throw netcdfFailure(e);
  }
  final Section section=new Section(ranges);
  final SampleModel sampleModel=wrapper.getSampleModel().createCompatibleSampleModel(destWidth,destHeight);
  final ColorModel colorModel=ImageIOUtilities.createColorModel(sampleModel);
  final WritableRaster raster=Raster.createWritableRaster(sampleModel,new Point(0,0));
  final BufferedImage image=new BufferedImage(colorModel,raster,colorModel.isAlphaPremultiplied(),null);
  processImageStarted(imageIndex);
  final int numDstBands=1;
  final float toPercent=100f / numDstBands;
  final int type=raster.getSampleModel().getDataType();
  final int xmin=destRegion.x;
  final int ymin=destRegion.y;
  final int xmax=destRegion.width + xmin;
  final int ymax=destRegion.height + ymin;
  for (int zi=0; zi < numDstBands; zi++) {
    final int dstBand=(dstBands == null) ? zi : dstBands[zi];
    final Array array;
    try {
      array=wrapper.variableDS.read(section);
    }
 catch (    InvalidRangeException e) {
      throw netcdfFailure(e);
    }
    final IndexIterator it=array.getIndexIterator();
    for (int y=ymax; --y >= ymin; ) {
      for (int x=xmin; x < xmax; x++) {
switch (type) {
case DataBuffer.TYPE_DOUBLE:
{
            raster.setSample(x,y,dstBand,it.getDoubleNext());
            break;
          }
case DataBuffer.TYPE_FLOAT:
{
          raster.setSample(x,y,dstBand,it.getFloatNext());
          break;
        }
case DataBuffer.TYPE_BYTE:
{
        byte b=it.getByteNext();
        raster.setSample(x,y,dstBand,b);
        break;
      }
default :
{
      raster.setSample(x,y,dstBand,it.getIntNext());
      break;
    }
}
}
}
if (abortRequested()) {
processReadAborted();
return image;
}
processImageProgress(zi * toPercent);
}
processImageComplete();
return image;
}
