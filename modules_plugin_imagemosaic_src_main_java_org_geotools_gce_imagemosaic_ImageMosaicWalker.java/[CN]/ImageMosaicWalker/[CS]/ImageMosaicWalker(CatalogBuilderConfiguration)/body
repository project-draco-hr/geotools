{
  Utilities.ensureNonNull("runConfiguration",configuration);
  Indexer defaultIndexer=configuration.getIndexer();
  ParametersType params=null;
  String rootMosaicDir=null;
  if (defaultIndexer != null) {
    params=defaultIndexer.getParameters();
    rootMosaicDir=IndexerUtils.getParam(params,Prop.ROOT_MOSAIC_DIR);
  }
  Utilities.ensureNonNull("root location",rootMosaicDir);
  parent=new File(rootMosaicDir);
  indexerFile=new File(parent,Utils.INDEXER_XML);
  Indexer indexer=null;
  Hints hints=configuration.getHints();
  String ancillaryFile=null;
  if (Utils.checkFileReadable(indexerFile)) {
    try {
      indexer=(Indexer)Utils.UNMARSHALLER.unmarshal(indexerFile);
      if (indexer != null) {
        copyDefaultParams(params,indexer);
      }
    }
 catch (    JAXBException e) {
      LOGGER.log(Level.WARNING,e.getMessage(),e);
    }
  }
 else {
    indexerFile=new File(parent,Utils.INDEXER_PROPERTIES);
    if (Utils.checkFileReadable(indexerFile)) {
      final Properties props=Utils.loadPropertiesFromURL(DataUtilities.fileToURL(indexerFile));
      indexer=createIndexer(props,params);
      if (props.containsKey(Prop.INDEXING_DIRECTORIES)) {
        IndexerUtils.setParam(params.getParameter(),props,Prop.INDEXING_DIRECTORIES);
      }
      if (props.containsKey(Prop.AUXILIARY_FILE)) {
        ancillaryFile=props.getProperty(Prop.AUXILIARY_FILE);
      }
    }
  }
  if (indexer != null) {
    configuration.setIndexer(indexer);
    String param=IndexerUtils.getParameter(Utils.Prop.AUXILIARY_FILE,indexer);
    if (param != null) {
      ancillaryFile=param;
    }
  }
  updateConfigurationHints(configuration,hints,ancillaryFile,IndexerUtils.getParam(params,Prop.ROOT_MOSAIC_DIR));
  configuration.check();
  this.runConfiguration=new CatalogBuilderConfiguration(configuration);
}
