{
  Iterator<GranuleDescriptor> it=null;
  final Collection<GranuleDescriptor> features=new ArrayList<GranuleDescriptor>();
  try {
    wrappedCatalogue.getGranuleDescriptors(new Query(typeName),new GranuleCatalogVisitor(){
      @Override public void visit(      GranuleDescriptor granule,      Object o){
        features.add(granule);
      }
    }
);
    if (features == null)     throw new NullPointerException("The provided SimpleFeatureCollection is null, it's impossible to create an index!");
    if (LOGGER.isLoggable(Level.FINE))     LOGGER.fine("Index Loaded");
    it=features.iterator();
    STRtree tree=new STRtree();
    long size=0;
    while (it.hasNext()) {
      final GranuleDescriptor granule=it.next();
      final ReferencedEnvelope env=ReferencedEnvelope.reference(granule.getGranuleBBOX());
      final Geometry g=(Geometry)FeatureUtilities.getPolygon(new Rectangle2D.Double(env.getMinX(),env.getMinY(),env.getWidth(),env.getHeight()),0);
      tree.insert(g.getEnvelopeInternal(),granule);
    }
    tree.build();
    index=tree;
  }
 catch (  Throwable e) {
    throw new IllegalArgumentException(e);
  }
}
