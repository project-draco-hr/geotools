{
  int count=0;
  Query namedQuery=namedQuery(query);
  FeatureSource mappedSource=mapping.getSource();
  if (!(mappedSource instanceof JDBCFeatureSource || mappedSource instanceof JDBCFeatureStore)) {
    count=store.getCount(namedQuery);
  }
  if (count >= 0) {
    return count;
  }
 else {
    int featureCount=0;
    FeatureIterator<Feature> features=null;
    try {
      for (features=getFeatures(namedQuery).features(); features.hasNext(); features.next()) {
        featureCount++;
      }
    }
  finally {
      if (features != null) {
        features.close();
      }
    }
    return featureCount;
  }
}
