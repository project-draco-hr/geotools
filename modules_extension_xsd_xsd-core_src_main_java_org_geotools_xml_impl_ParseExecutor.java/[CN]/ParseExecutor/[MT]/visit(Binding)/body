{
  if (!(binding instanceof InstanceBinding)) {
    Class bindingClass=binding.getClass();
    QName bindingTarget=binding.getTarget();
    binding=(Binding)context.getComponentInstanceOfType(binding.getClass());
    if (binding == null) {
      binding=parser.getBindingLoader().loadBinding(bindingTarget,context);
      if (binding == null) {
        binding=parser.getBindingLoader().loadBinding(bindingTarget,bindingClass,context);
      }
      if (binding.getClass() != bindingClass) {
        throw new IllegalStateException("Reloaded binding resulted in different type");
      }
    }
  }
  try {
    if (result == null) {
      XSDTypeDefinition type=null;
      if (Schemas.nameMatches(instance.getDeclaration(),binding.getTarget())) {
        type=instance.getTypeDefinition();
      }
 else {
        type=Schemas.getBaseTypeDefinition(instance.getTypeDefinition(),binding.getTarget());
      }
      if (value == null) {
        value=preParse(instance);
        if ((type != null) && (type instanceof XSDSimpleTypeDefinition || ((XSDComplexTypeDefinition)type).isMixed())) {
          result=value;
        }
 else         if ((value != null) && value instanceof String) {
          value=((String)value).trim();
          if ("".equals(value)) {
            result=null;
          }
 else {
            result=value;
          }
        }
 else {
          result=value;
        }
      }
    }
    if (binding instanceof SimpleBinding) {
      result=((SimpleBinding)binding).parse(instance,result);
    }
 else {
      result=((ComplexBinding)binding).parse((ElementInstance)instance,node,result);
    }
    if (result != null) {
      value=result;
    }
  }
 catch (  Throwable t) {
    String msg="Parsing failed for " + instance.getName() + ": "+ t.toString();
    throw new RuntimeException(msg,t);
  }
}
