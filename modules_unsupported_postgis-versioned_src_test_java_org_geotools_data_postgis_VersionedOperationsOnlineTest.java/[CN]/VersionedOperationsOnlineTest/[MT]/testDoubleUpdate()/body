{
  VersionedPostgisDataStore ds=getDataStore();
  ds.setVersioned("tree",true,"udig","I like to doubly update things in the same transaction :-)");
  Filter filter=ff.id(Collections.singleton(ff.featureId("tree.1")));
  Transaction t=createTransaction("gimbo","double update");
  SimpleFeatureStore store=(SimpleFeatureStore)ds.getFeatureSource("tree");
  SimpleFeatureType treeSchema=ds.getSchema("tree");
  store.setTransaction(t);
  assertEquals(1,store.getFeatures(filter).size());
  store.modifyFeatures(treeSchema.getDescriptor("name"),"update1",filter);
  store.modifyFeatures(treeSchema.getDescriptor("name"),"update2",filter);
  t.commit();
  SimpleFeatureCollection fc=store.getFeatures(filter);
  SimpleFeatureIterator fi=fc.features();
  assertTrue(fi.hasNext());
  SimpleFeature f=fi.next();
  assertEquals("update2",f.getAttribute("name"));
  assertFalse(fi.hasNext());
  fi.close();
  t.close();
}
