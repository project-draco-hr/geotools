{
  Transaction t=new DefaultTransaction();
  SimpleFeatureType type=data.getSchema(getRoadTypeName());
  FeatureReader<SimpleFeatureType,SimpleFeature> reader;
  reader=data.getFeatureReader(new Query(getRoadTypeName(),Filter.EXCLUDE),t);
  assertEquals(type,reader.getFeatureType());
  assertEquals(0,count(reader));
  reader=data.getFeatureReader(new Query(getRoadTypeName()),t);
  assertTrue(reader instanceof DiffFeatureReader);
  assertEquals(type,reader.getFeatureType());
  assertEquals(roadFeatures.length,count(reader));
  reader=data.getFeatureReader(new Query(getRoadTypeName(),rd1Filter),t);
  assertEquals(type,reader.getFeatureType());
  assertEquals(1,count(reader));
  SimpleFeatureStore store=(SimpleFeatureStore)data.getFeatureSource(getRoadTypeName());
  store.setTransaction(t);
  store.removeFeatures(rd1Filter);
  reader=data.getFeatureReader(new Query(getRoadTypeName(),Filter.EXCLUDE),t);
  assertEquals(0,count(reader));
  reader=data.getFeatureReader(new Query(getRoadTypeName()),t);
  assertEquals(roadFeatures.length - 1,count(reader));
  reader=data.getFeatureReader(new Query(getRoadTypeName(),rd1Filter),t);
  assertEquals(0,count(reader));
  t.rollback();
  reader=data.getFeatureReader(new Query(getRoadTypeName(),Filter.EXCLUDE),t);
  assertEquals(0,count(reader));
  reader=data.getFeatureReader(new Query(getRoadTypeName()),t);
  assertEquals(roadFeatures.length,count(reader));
  reader=data.getFeatureReader(new Query(getRoadTypeName(),rd1Filter),t);
  assertEquals(1,count(reader));
}
