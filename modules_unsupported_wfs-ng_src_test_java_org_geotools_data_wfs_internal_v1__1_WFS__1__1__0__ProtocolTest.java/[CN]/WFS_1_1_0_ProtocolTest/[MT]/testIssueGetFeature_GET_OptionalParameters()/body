{
  final InputStream responseContent=TestData.openStream(this,GEOS_ARCHSITES_11.DATA);
  final TestHttpResponse httpResponse;
  final String defaultWfs11OutputFormat="text/xml; subtype=gml/3.1.1";
  httpResponse=new TestHttpResponse(defaultWfs11OutputFormat,"UTF-16",responseContent);
  TestHTTPClient mockHttp=new TestHTTPClient(httpResponse);
  StrictWFS_1_1_Strategy strategy=createTestProtocol(GEOS_ARCHSITES_11.CAPABILITIES,mockHttp,new StrictWFS_1_1_Strategy());
  Query query=new Query(GEOS_ARCHSITES_11.FEATURETYPENAME);
  query.setMaxFeatures(1000);
  query.setPropertyNames(new String[]{"cat","the_geom"});
  query.setCoordinateSystem(CRS.decode("EPSG:23030"));
  FilterFactory2 ff=CommonFactoryFinder.getFilterFactory2(null);
  Filter filter=ff.id(Collections.singleton(ff.featureId("archsites.1")));
  query.setFilter(filter);
  WFSResponse response;
  strategy=spy(createTestProtocol(GEOS_ARCHSITES_11.CAPABILITIES,new GeoServerPre200Strategy()));
  doReturn(TestData.url(this,GEOS_ARCHSITES_11.SCHEMA)).when(strategy).buildDescribeFeatureTypeParametersForGET(GEOS_ARCHSITES_11.FEATURETYPENAME);
  GetFeatureRequest getFeature=new GetFeatureQueryAdapter(query,defaultWfs11OutputFormat,"EPSG:26713",ResultType.RESULTS);
  response=strategy.issueGetFeatureGET(getFeature);
  assertNotNull(response);
  Map<String,String> kvp=URIs.parseQueryString(mockHttp.targetUrl.getQuery());
  assertEquals("1000",kvp.get("MAXFEATURES"));
  String propertyName=kvp.get("PROPERTYNAME");
  assertEquals("cat,the_geom",propertyName);
  String srsName=kvp.get("SRSNAME");
  assertEquals("EPSG:26713",srsName);
  assertEquals("archsites.1",kvp.get("FEATUREID"));
  assertNull("FEATUREID and FILTER are mutually exclusive",kvp.get("FILTER"));
  filter=ff.equals(ff.property("cat"),ff.literal(1));
  query.setFilter(filter);
  getFeature=new GetFeatureQueryAdapter(query,defaultWfs11OutputFormat,"EPSG:23030",ResultType.RESULTS);
  response=strategy.issueGetFeatureGET(getFeature);
  kvp=URIs.parseQueryString(mockHttp.targetUrl.getQuery());
  assertNull("FEATUREID and FILTER are mutually exclusive",kvp.get("FEATUREID"));
  String encodedFilter=kvp.get("FILTER");
  assertNotNull(encodedFilter);
  Parser filterParser=new Parser(new OGCConfiguration());
  Filter parsed=(Filter)filterParser.parse(new StringReader(encodedFilter));
  assertTrue(parsed instanceof PropertyIsEqualTo);
}
