{
  Mongo mongo=null;
  try {
    mongo=new Mongo(config.getHost(),config.getPort());
    DB db=mongo.getDB(config.getDB());
    Set<String> colls=db.getCollectionNames();
    for (    String s : colls) {
      DBCollection dbc=db.getCollection(s);
      log.info("getLayers; collection=" + dbc);
      List geoList=dbc.distinct("geometry.type");
      List propList=null;
      try {
        propList=dbc.distinct("properties");
      }
 catch (      IllegalArgumentException ex) {
        propList=new BasicBSONList();
        propList.add("ex nihilo");
      }
catch (      MongoException ex) {
        propList=new BasicBSONList();
        propList.add("ex nihilo");
      }
      if (geoList != null && propList != null && propList.size() > 0) {
        boolean hasValidGeo=false;
        for (        GeometryType type : GeometryType.values()) {
          if (geoList.contains(type.toString())) {
            hasValidGeo=true;
            break;
          }
        }
        if (hasValidGeo) {
          layers.add(new MongoLayer(dbc,config));
        }
      }
    }
  }
 catch (  Throwable t) {
    log.severe("getLayers error; " + t.getLocalizedMessage());
  }
  if (mongo != null) {
    mongo.close();
  }
}
