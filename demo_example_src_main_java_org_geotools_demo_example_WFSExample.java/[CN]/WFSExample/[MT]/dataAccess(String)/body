{
  Map connectionParameters=new HashMap();
  connectionParameters.put("WFSDataStoreFactory:GET_CAPABILITIES_URL",getCapabilities);
  DataStore data=DataStoreFinder.getDataStore(connectionParameters);
  String typeNames[]=data.getTypeNames();
  String typeName=typeNames[0];
  SimpleFeatureType schema=data.getSchema(typeName);
  System.out.println("Schema Attributes:" + schema.getAttributeCount());
  SimpleFeatureSource source=data.getFeatureSource(typeName);
  System.out.println("Metadata Bounds:" + source.getBounds());
  String geomName=schema.getGeometryDescriptor().getLocalName();
  Envelope bbox=new Envelope(-100.0,-70,25,40);
  FilterFactory2 ff=CommonFactoryFinder.getFilterFactory2(GeoTools.getDefaultHints());
  Object polygon=JTS.toGeometry(bbox);
  Intersects filter=ff.intersects(ff.property(geomName),ff.literal(polygon));
  Query query=new DefaultQuery(typeName,filter,new String[]{geomName});
  SimpleFeatureCollection features=source.getFeatures(query);
  ReferencedEnvelope bounds=new ReferencedEnvelope();
  Iterator<SimpleFeature> iterator=features.iterator();
  try {
    while (iterator.hasNext()) {
      Feature feature=(Feature)iterator.next();
      bounds.include(feature.getBounds());
    }
    System.out.println("Calculated Bounds:" + bounds);
  }
  finally {
    features.close(iterator);
  }
}
