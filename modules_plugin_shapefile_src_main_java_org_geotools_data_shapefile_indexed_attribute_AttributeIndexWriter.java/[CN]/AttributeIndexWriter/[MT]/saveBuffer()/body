{
  RandomAccessFile raf=null;
  try {
    if (buffer.size() == 0) {
      return;
    }
    try {
      Collections.sort(buffer);
    }
 catch (    OutOfMemoryError err) {
      throw new IOException(err.getMessage() + ". Try to lower memory load parameter.");
    }
    File file=File.createTempFile("attind",null);
    tempFiles[curFile++]=file;
    Iterator it=buffer.iterator();
    raf=new RandomAccessFile(file,"rw");
    currentChannel=raf.getChannel();
    currentChannel.lock();
    allocateBuffers();
    writeBuffer.position(0);
    while (it.hasNext()) {
      write((IndexRecord)it.next());
    }
  }
  finally {
    close();
    if (raf != null) {
      raf.close();
    }
  }
}
