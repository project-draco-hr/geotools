{
  Data data;
  Filter filter=query.getFilter();
  if (filter != Filter.INCLUDE) {
    SimplifyingFilterVisitor visitor=new SimplifyingFilterVisitor();
    Filter simplified=(Filter)filter.accept(visitor,null);
    query.setFilter(simplified);
  }
  if (store.preferredProtocol == HttpMethod.POST) {
    data=createFeatureReaderPOST(query,transaction);
    if (data.reader == null)     data=createFeatureReaderGET(query,transaction);
  }
 else {
    data=createFeatureReaderGET(query,transaction);
    if (data.reader == null)     data=createFeatureReaderPOST(query,transaction);
  }
  if (data.reader == null && data.saxException != null)   throw (IOException)new IOException(data.saxException.toString()).initCause(data.saxException);
  if (data.reader == null && data.ioException != null)   throw data.ioException;
  return data.reader;
}
