{
  final Element element=currentElement();
  String asText=null;
  if (value != null) {
    final Class<?> type=value.getClass();
    if (isFormattable(type)) {
      asText=value.toString();
    }
 else     if (isFormattable(type.getComponentType())) {
      asText=formatSequence(value);
    }
  }
  if (element instanceof IIOMetadataNode) {
    ((IIOMetadataNode)element).setUserObject(value);
  }
 else   if (value != null && asText == null) {
    throw new UnsupportedImplementationException(Errors.format(ErrorKeys.ILLEGAL_CLASS_$2,Classes.getClass(element),IIOMetadataNode.class));
  }
  element.setNodeValue(asText);
}
