{
  Quadtree tree=new Quadtree();
synchronized (diff) {
    Iterator<Entry<String,SimpleFeature>> i=diff.added.entrySet().iterator();
    while (i.hasNext()) {
      Entry<String,SimpleFeature> e=i.next();
      SimpleFeature f=(SimpleFeature)e.getValue();
      if (!diff.modifiedFeatures.containsKey(f.getID())) {
        tree.insert(ReferencedEnvelope.reference(f.getBounds()),f);
      }
    }
    Iterator<Entry<String,SimpleFeature>> j=diff.getModified().entrySet().iterator();
    while (j.hasNext()) {
      Entry<String,SimpleFeature> e=j.next();
      SimpleFeature f=(SimpleFeature)e.getValue();
      tree.insert(ReferencedEnvelope.reference(f.getBounds()),f);
    }
  }
  return tree;
}
