{
  Quadtree tree=new Quadtree();
synchronized (diff) {
    Iterator i=diff.added.entrySet().iterator();
    while (i.hasNext()) {
      Entry e=(Map.Entry)i.next();
      SimpleFeature f=(SimpleFeature)e.getValue();
      if (!diff.modifiedFeatures.containsKey(f.getID())) {
        tree.insert(ReferencedEnvelope.reference(f.getBounds()),f);
      }
    }
    Iterator j=diff.modified2.entrySet().iterator();
    while (j.hasNext()) {
      Entry e=(Map.Entry)j.next();
      SimpleFeature f=(SimpleFeature)e.getValue();
      tree.insert(ReferencedEnvelope.reference(f.getBounds()),f);
    }
  }
  return tree;
}
