{
synchronized (mutex) {
    SimpleFeature old;
    if (addedFeatures.containsKey(fid)) {
      old=(SimpleFeature)addedFeatures.get(fid);
      addedFeatures.put(fid,f);
    }
 else {
      old=(SimpleFeature)modifiedFeatures.get(fid);
      modifiedFeatures.put(fid,f);
    }
    if (old != null) {
      spatialIndex.remove(ReferencedEnvelope.reference(old.getBounds()),old);
    }
    addToSpatialIndex(f);
  }
}
