{
  final double value=iterator.getSampleDouble();
  final PiecewiseTransform1DElement transformElement;
  if (useLast) {
    if (last != null && last.contains(value))     transformElement=last;
 else {
      last=transformElement=(PiecewiseTransform1DElement)piecewise.findDomainElement(value);
    }
  }
 else   transformElement=(PiecewiseTransform1DElement)piecewise.findDomainElement(value);
  if (transformElement != null)   iterator.setSample(transformElement.transform(value));
 else {
    if (hasGapsValue)     iterator.setSample(gapsValue);
 else     throw new IllegalArgumentException(Errors.format(ErrorKeys.ILLEGAL_ARGUMENT_$1,Double.toString(value)));
  }
  return last;
}
