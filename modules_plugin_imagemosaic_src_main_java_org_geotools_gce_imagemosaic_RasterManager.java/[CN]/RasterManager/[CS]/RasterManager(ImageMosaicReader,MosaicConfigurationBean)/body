{
  Utilities.ensureNonNull("ImageMosaicReader",parentReader);
  this.parentReader=parentReader;
  this.expandMe=parentReader.expandMe;
  this.heterogeneousGranules=parentReader.heterogeneousGranules;
  this.configuration=configuration;
  hints=parentReader.getHints();
  if (configuration != null && configuration.getAuxiliaryFilePath() != null) {
    hints.add(new RenderingHints(Utils.AUXILIARY_FILES_PATH,configuration.getAuxiliaryFilePath()));
  }
  granuleCatalog=new HintedGranuleCatalog(parentReader.granuleCatalog,hints);
  this.coverageFactory=parentReader.getGridCoverageFactory();
  this.coverageIdentifier=configuration != null ? configuration.getName() : ImageMosaicReader.UNSPECIFIED;
  this.pathType=parentReader.pathType;
  extractOverviewPolicy();
  extractDecimationPolicy();
  loadSampleImage(configuration);
  if (configuration != null) {
    CatalogConfigurationBean catalogBean=configuration.getCatalogConfigurationBean();
    typeName=catalogBean != null ? catalogBean.getTypeName() : null;
    if (typeName != null) {
      final SimpleFeatureType schema=granuleCatalog.getType(typeName);
      if (configuration.getAdditionalDomainAttributes() != null) {
        domainsManager=new DomainManager(configuration.getAdditionalDomainAttributes(),schema);
        dimensionDescriptors.addAll(domainsManager.dimensions);
      }
      if (configuration.getTimeAttribute() != null) {
        final HashMap<String,String> init=new HashMap<String,String>();
        init.put(Utils.TIME_DOMAIN,configuration.getTimeAttribute());
        timeDomainManager=new DomainManager(init,schema);
        dimensionDescriptors.addAll(timeDomainManager.dimensions);
      }
      if (configuration.getElevationAttribute() != null) {
        final HashMap<String,String> init=new HashMap<String,String>();
        init.put(Utils.ELEVATION_DOMAIN,configuration.getElevationAttribute());
        elevationDomainManager=new DomainManager(init,schema);
        dimensionDescriptors.addAll(elevationDomainManager.dimensions);
      }
    }
    if (defaultSM == null) {
      defaultSM=configuration.getSampleModel();
    }
    if (defaultCM == null) {
      defaultCM=configuration.getColorModel();
    }
    if (defaultSM != null && defaultCM != null && defaultImageLayout == null) {
      defaultImageLayout=new ImageLayout().setColorModel(defaultCM).setSampleModel(defaultSM);
    }
    levels=configuration.getLevels();
    final double[] highRes=levels[0];
    final int numOverviews=configuration.getLevelsNum() - 1;
    double[][] overviews=null;
    if (numOverviews > 0) {
      overviews=new double[numOverviews][2];
      for (int i=0; i < numOverviews; i++) {
        overviews[i][0]=levels[i + 1][0];
        overviews[i][1]=levels[i + 1][1];
      }
    }
    overviewsController=new OverviewsController(highRes,numOverviews,overviews);
    imposedEnvelope=configuration.getEnvelope();
  }
}
