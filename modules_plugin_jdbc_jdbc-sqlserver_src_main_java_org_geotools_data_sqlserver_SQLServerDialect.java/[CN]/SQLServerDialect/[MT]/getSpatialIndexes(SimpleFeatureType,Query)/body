{
  if (!forceSpatialIndexes) {
    return Collections.emptySet();
  }
  Filter filter=query.getFilter();
  if (filter == Filter.INCLUDE) {
    return Collections.emptySet();
  }
  SpatialIndexAttributeExtractor attributesExtractor=new SpatialIndexAttributeExtractor();
  filter.accept(attributesExtractor,null);
  Map<String,Integer> attributes=attributesExtractor.getSpatialProperties();
  if (attributes.isEmpty() || attributes.size() > 1) {
    return Collections.emptySet();
  }
  Set<String> indexes=new HashSet<String>();
  for (  Map.Entry<String,Integer> attribute : attributes.entrySet()) {
    if (attribute.getValue() > 1) {
      continue;
    }
    AttributeDescriptor descriptor=featureType.getDescriptor(attribute.getKey());
    if (descriptor instanceof GeometryDescriptor) {
      String indexName=(String)descriptor.getUserData().get(SPATIAL_INDEX_KEY);
      if (indexName != null) {
        indexes.add(indexName);
      }
    }
  }
  return indexes;
}
