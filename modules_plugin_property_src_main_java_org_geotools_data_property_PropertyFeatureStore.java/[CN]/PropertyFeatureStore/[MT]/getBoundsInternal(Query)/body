{
  SimpleFeatureCollection fc=getFeatures(query);
  SimpleFeatureIterator fi=null;
  ReferencedEnvelope result=ReferencedEnvelope.create(getSchema().getCoordinateReferenceSystem());
  try {
    fi=fc.features();
    while (fi.hasNext()) {
      SimpleFeature f=fi.next();
      if (f != null && f.getBounds() != null) {
        result.expandToInclude(ReferencedEnvelope.reference(f.getBounds()));
      }
    }
  }
 catch (  Exception e) {
    if (fi != null) {
      fi.close();
    }
  }
  return result;
}
