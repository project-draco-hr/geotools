{
  SimpleFeatureCollection fc=getFeatures(query);
  SimpleFeatureIterator fi=null;
  ReferencedEnvelope result=ReferencedEnvelope.create(getSchema().getCoordinateReferenceSystem());
  try {
    fi=fc.features();
    while (fi.hasNext()) {
      SimpleFeature f=fi.next();
      BoundingBox featureBoundingBox=f.getBounds();
      if (f != null && featureBoundingBox != null) {
        ReferencedEnvelope featureBounds=ReferencedEnvelope.reference(featureBoundingBox);
        result.expandToInclude(featureBounds);
      }
    }
  }
 catch (  Exception e) {
    if (fi != null) {
      fi.close();
    }
  }
  return result;
}
