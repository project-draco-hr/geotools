{
  if (flags == 0) {
    throw new IllegalArgumentException("no write flags set");
  }
  ShapefileFeatureReader reader=(ShapefileFeatureReader)delegate.getReaderInternal(query);
  ShapefileFeatureWriter writer=new ShapefileFeatureWriter(delegate.shpFiles,reader,getDataStore().getCharset(),getDataStore().getTimeZone());
  if ((flags | WRITER_ADD) == WRITER_ADD) {
    while (writer.hasNext()) {
      writer.next();
    }
  }
  return writer;
}
