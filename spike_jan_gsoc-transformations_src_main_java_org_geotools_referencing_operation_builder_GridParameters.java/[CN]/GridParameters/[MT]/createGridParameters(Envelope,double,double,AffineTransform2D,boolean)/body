{
  if (isInteger) {
    if (trans == null) {
      trans=getIdntityTransform();
    }
    GeneralEnvelope transEnv=CRS.transform(trans,env);
    int iDx=Math.abs((new Double(Math.round(dx * trans.getScaleX()))).intValue());
    int iDy=Math.abs((new Double(Math.round(dy * trans.getScaleY()))).intValue());
    int xNum=(new Double(Math.floor(transEnv.getSpan(0) / iDx))).intValue();
    int yNum=(new Double(Math.floor(transEnv.getSpan(1) / iDy))).intValue();
    int xMin=(new Double(Math.floor(transEnv.getMinimum(0))).intValue());
    int yMin=(new Double(Math.floor(transEnv.getMinimum(1))).intValue());
    return new GridParameters(iDx,iDy,xMin,yMin,xNum,yNum);
  }
 else {
    int xNum=(new Double(Math.floor(env.getSpan(0) / dx))).intValue();
    int yNum=(new Double(Math.floor(env.getSpan(1) / dy))).intValue();
    return new GridParameters(dx,dy,env.getMinimum(0),env.getMinimum(1),xNum,yNum);
  }
}
