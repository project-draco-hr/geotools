{
  String schemaLocation="http://www.earthresourceml.org/earthresourceml/1.1/xsd/earthResource.xsd";
  String typeName=EARTH_RESOURCE.getLocalPart();
  URL schemaDir=(URL)params.get("directory");
  File fileDir;
  try {
    fileDir=new File(schemaDir.toURI());
  }
 catch (  URISyntaxException e) {
    throw new RuntimeException(e);
  }
  PropertyDataStore dataStore=new PropertyDataStore(fileDir);
  SimpleFeatureSource simpleFeatureSource=dataStore.getFeatureSource(typeName);
  SimpleFeatureCollection fCollection=simpleFeatureSource.getFeatures();
  reader=EmfAppSchemaReader.newInstance();
  typeRegistry=new FeatureTypeRegistry();
  SchemaIndex schemaIndex=reader.parse(new URL(schemaLocation));
  typeRegistry.addSchemas(schemaIndex);
  ComplexType complexType=(ComplexType)typeRegistry.getAttributeType(EARTH_RESOURCE_TYPE);
  inputFeatures=getInputFeatures(fCollection,complexType);
  return new InputDataAccess(inputFeatures,simpleFeatureSource.getSchema(),simpleFeatureSource.getName());
}
