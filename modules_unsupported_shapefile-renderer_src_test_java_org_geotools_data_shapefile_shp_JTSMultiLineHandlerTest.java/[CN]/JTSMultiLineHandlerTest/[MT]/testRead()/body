{
  URL url=TestData.getResource(LabelingTest.class,"streams.shp");
  ShapefileDataStore ds=(ShapefileDataStore)new ShapefileDataStoreFactory().createDataStore(url);
  Envelope env=ds.getFeatureSource().getBounds();
  MathTransform mt=null;
  AffineTransform transform=RendererUtilities.worldToScreenTransform(env,new Rectangle(512,512));
  MathTransform at=ReferencingFactoryFinder.getMathTransformFactory(null).createAffineTransform(new GeneralMatrix(transform));
  if (mt == null) {
    mt=at;
  }
 else {
    mt=ReferencingFactoryFinder.getMathTransformFactory(null).createConcatenatedTransform(mt,at);
  }
  ShapefileReader reader=new ShapefileReader(ShapefileRendererUtil.getShpFiles(ds),false,false);
  reader.setHandler(new org.geotools.renderer.shape.shapehandler.jts.MultiLineHandler(reader.getHeader().getShapeType(),env,mt,false,new Rectangle(512,512)));
  Object shape=reader.nextRecord().shape();
  assertNotNull(shape);
  assertTrue(shape instanceof Geometry);
  Coordinate[] coords=((Geometry)shape).getCoordinates();
  for (int i=0; i < coords.length; i++) {
    Coordinate coordinate=coords[i];
    assertNotNull(coordinate);
  }
  int i=0;
  while (reader.hasNext()) {
    i++;
    shape=reader.nextRecord().shape();
    assertNotNull(shape);
    assertTrue(shape instanceof Geometry);
    if (i == 0) {
      Geometry geom=(Geometry)shape;
      assertEquals(13,geom.getCoordinates().length);
    }
  }
  assertEquals(ds.getFeatureSource().getCount(Query.ALL) - 1,i);
}
