{
  int count=0;
  String typeName="null";
  Filter filter=query.getFilter();
  if (getSchema() != null) {
    typeName=getSchema().getTypeName();
    GeometryDescriptor geomType=(GeometryDescriptor)getSchema().getGeometryDescriptor();
    if (filter != Filter.EXCLUDE) {
      DB2SQLBuilder builder=(DB2SQLBuilder)((DB2DataStore)getDataStore()).getSqlBuilder(typeName);
      Connection conn=null;
      Statement statement=null;
      ResultSet results=null;
      try {
        conn=getConnection();
        StringBuffer sql=new StringBuffer();
        sql.append("SELECT COUNT(*) as cnt");
        builder.sqlFrom(sql,typeName);
        builder.sqlWhere(sql,filter);
        statement=conn.createStatement();
        results=statement.executeQuery(sql.toString());
        if (results.next()) {
          count=results.getInt("cnt");
        }
      }
 catch (      SQLException e) {
        closeAll(results,statement,conn,transaction,e);
        System.out.println(e);
        throw new DataSourceException("Could not get count " + query.getHandle(),e);
      }
catch (      SQLEncoderException e) {
        closeAll(results,statement,conn,transaction,null);
        System.out.println(e);
        throw new DataSourceException("Could not get count " + query.getHandle(),e);
      }
      closeAll(results,statement,conn,transaction,null);
    }
  }
  LOGGER.finer(typeName + " count: " + count);
  return count;
}
