{
  URL url=TestData.getResource(LabelingTest.class,"smallMultiPoly.shp");
  ShapefileDataStore ds=(ShapefileDataStore)new ShapefileDataStoreFactory().createDataStore(url);
  Envelope env=new Envelope(-116.61514977458947,-115.06357335975156,31.826799280244018,32.590528603609826);
  CoordinateReferenceSystem crs=DefaultGeographicCRS.WGS84;
  MathTransform mt=CRS.findMathTransform(crs,DefaultGeographicCRS.WGS84);
  AffineTransform at=RendererUtilities.worldToScreenTransform(env,new Rectangle(300,300));
  mt=ReferencingFactoryFinder.getMathTransformFactory(null).createConcatenatedTransform(mt,ReferencingFactoryFinder.getMathTransformFactory(null).createAffineTransform(new GeneralMatrix(at)));
  ShapefileReader reader=new ShapefileReader(ShapefileRendererUtil.getShpFiles(ds),false,false);
  reader.setHandler(new org.geotools.renderer.shape.shapehandler.simple.PolygonHandler(reader.getHeader().getShapeType(),env,mt,false));
  Object shape=reader.nextRecord().shape();
  assertNotNull(shape);
  assertTrue(shape instanceof SimpleGeometry);
  SimpleGeometry geom=(SimpleGeometry)shape;
  assertEquals(1,geom.coords.length);
  assertEquals(10,geom.coords[0].length);
}
