{
  if (crs == null) {
    LOGGER.finer("toMeters: assuming the original size is in meters already, as crs is null");
    return size;
  }
  if (crs instanceof GeographicCRS) {
    return size * OGC_DEGREE_TO_METERS;
  }
  if (!SCALE_UNIT_COMPENSATION) {
    return size;
  }
  CoordinateReferenceSystem horizontal=CRS.getHorizontalCRS(crs);
  if (horizontal != null) {
    crs=horizontal;
  }
  Unit<?> unit=crs.getCoordinateSystem().getAxis(0).getUnit();
  if (unit == null) {
    LOGGER.finer("toMeters: assuming the original size is in meters already, as the first crs axis unit is null. CRS is " + crs);
    return size;
  }
  if (!unit.isCompatible(SI.METER)) {
    LOGGER.warning("toMeters: could not convert unit " + unit + " to meters");
    return size;
  }
  return unit.getConverterTo(SI.METER).convert(size);
}
