{
  int idx=cm.get(r,g,b,a);
  if (idx == -1) {
    idx=delegate.getClosestIndex(r,g,b,a);
    cm.put(r,g,b,a,idx);
    if (cm.size() > maxSize) {
      ColorEntry ce=lru.removeLast();
      int red=ColorUtils.red(ce.color);
      int green=ColorUtils.green(ce.color);
      int blue=ColorUtils.blue(ce.color);
      int alpha=ColorUtils.alpha(ce.color);
      cm.remove(red,green,blue,alpha);
      ce.color=ColorUtils.color(r,g,b,a);
      lru.add(ce);
    }
 else {
      int color=ColorUtils.color(r,g,b,a);
      lru.add(new ColorEntry(color,null,null));
    }
  }
  return idx;
}
