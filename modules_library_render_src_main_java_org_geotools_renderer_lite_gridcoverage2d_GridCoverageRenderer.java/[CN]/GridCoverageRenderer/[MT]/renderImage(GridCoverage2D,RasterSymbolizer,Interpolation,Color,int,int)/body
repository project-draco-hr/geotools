{
  final GCpair couple=prepareFinalImage(gridCoverage,symbolizer);
  if (couple == null)   return null;
  final RenderedImage finalImage=couple.getGridCoverage().getRenderedImage();
  final AffineTransform finalRaster2Model=couple.getTransform();
  Rectangle2D finalLayout=layoutHelper(finalImage,(float)finalRaster2Model.getScaleX(),(float)finalRaster2Model.getScaleY(),(float)finalRaster2Model.getTranslateX(),(float)finalRaster2Model.getTranslateY(),interpolation);
  if (finalLayout.isEmpty()) {
    if (LOGGER.isLoggable(java.util.logging.Level.FINE))     LOGGER.fine("Unable to create a granuleDescriptor " + this.toString() + " due to jai scale bug");
    return null;
  }
  final ImageLayout layout=new ImageLayout(finalImage);
  layout.setTileGridXOffset(0).setTileGridYOffset(0).setTileHeight(tileSizeY).setTileWidth(tileSizeX);
  final RenderingHints localHints=this.hints.clone();
  localHints.add(new RenderingHints(JAI.KEY_IMAGE_LAYOUT,layout));
  if (interpolation instanceof InterpolationNearest)   localHints.add(new RenderingHints(JAI.KEY_REPLACE_INDEX_COLOR_MODEL,Boolean.FALSE));
  localHints.add(new RenderingHints(JAI.KEY_BORDER_EXTENDER,BorderExtender.createInstance(BorderExtender.BORDER_COPY)));
  RenderedImage im=null;
  try {
    ImageWorker iw=new ImageWorker(finalImage);
    iw.setRenderingHints(localHints);
    iw.affine(finalRaster2Model,interpolation,null);
    im=iw.getRenderedImage();
  }
  finally {
    if (DEBUG)     writeRenderedImage(im,"postAffine");
  }
  return im;
}
