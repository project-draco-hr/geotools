{
  double unsigned=Math.abs(ordinate);
  boolean negative=ordinate < 0.0;
  if (negative) {
    roundUp=!roundUp;
  }
  double rounded;
  if (roundUp) {
    double x=unsigned / resolution;
    int up=(x - (long)x) > EPS ? 1 : 0;
    rounded=resolution * (up + (long)x);
  }
 else {
    rounded=resolution * (long)(unsigned / resolution);
  }
  return negative ? -rounded : rounded;
}
