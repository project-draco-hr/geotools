{
  this.state=state;
  String typeName=query.getTypeName();
  File file=((CSVDataStore)state.getEntry().getDataStore()).file;
  File directory=file.getParentFile();
  this.temp=File.createTempFile(typeName + System.currentTimeMillis(),"csv",directory);
  this.csvWriter=new CsvWriter(new FileWriter(this.temp),',');
  if (append) {
    Files.copy(file.toPath(),temp.toPath(),StandardCopyOption.REPLACE_EXISTING);
  }
 else {
    this.delegate=new CSVFeatureReader(state,query);
    this.csvWriter.writeRecord(delegate.reader.getHeaders());
  }
  this.appending=append;
}
