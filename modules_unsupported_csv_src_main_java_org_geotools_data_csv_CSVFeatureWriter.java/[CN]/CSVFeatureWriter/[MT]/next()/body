{
  if (csvWriter == null) {
    throw new IOException("Writer has been closed");
  }
  try {
    if (this.appending) {
      SimpleFeatureType featureType=state.getFeatureType();
      String fid=featureType.getTypeName() + "." + System.currentTimeMillis();
      Object values[]=DataUtilities.defaultValues(featureType);
      this.currentFeature=SimpleFeatureBuilder.build(featureType,values,fid);
      return this.currentFeature;
    }
 else {
      if (this.currentFeature != null) {
        this.write();
      }
      this.currentFeature=delegate.next();
      return this.currentFeature;
    }
  }
 catch (  IllegalArgumentException invalid) {
    throw new IOException("Unable to create feature:" + invalid.getMessage(),invalid);
  }
}
