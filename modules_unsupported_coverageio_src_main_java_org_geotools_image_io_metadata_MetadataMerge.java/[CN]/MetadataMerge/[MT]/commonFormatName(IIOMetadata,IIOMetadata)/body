{
  final String[] sourceFormats=source.getMetadataFormatNames();
  String format=target.getNativeMetadataFormatName();
  if (format != null) {
    if (XArray.contains(sourceFormats,format)) {
      return format;
    }
  }
  final String[] targetFormats=target.getExtraMetadataFormatNames();
  if (targetFormats != null) {
    format=source.getNativeMetadataFormatName();
    if (format != null) {
      if (XArray.contains(targetFormats,format)) {
        return format;
      }
    }
    for (int i=0; i < targetFormats.length; i++) {
      format=targetFormats[i];
      if (XArray.contains(sourceFormats,format)) {
        return format;
      }
    }
  }
  if (source.isStandardMetadataFormatSupported() && target.isStandardMetadataFormatSupported()) {
    return IIOMetadataFormatImpl.standardMetadataFormatName;
  }
  return null;
}
