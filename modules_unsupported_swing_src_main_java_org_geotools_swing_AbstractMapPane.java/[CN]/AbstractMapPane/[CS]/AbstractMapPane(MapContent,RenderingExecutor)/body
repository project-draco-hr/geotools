{
  setBackground(DEFAULT_BACKGROUND_COLOR);
  drawingLock=new ReentrantLock();
  paneTaskExecutor=Executors.newSingleThreadScheduledExecutor();
  paintDelay=DEFAULT_PAINT_DELAY;
  acceptRepaintRequests=new AtomicBoolean(true);
  clearLabelCache=new AtomicBoolean(true);
  baseImageMoved=new AtomicBoolean();
  imageOrigin=new Point(0,0);
  dragBox=new MouseDragBox(this);
  toolManager=new MapToolManager(this);
  addMouseListener(dragBox);
  addMouseMotionListener(dragBox);
  addMouseListener(toolManager);
  addMouseMotionListener(toolManager);
  addMouseWheelListener(toolManager);
  addMouseListener(new MouseInputAdapter(){
    @Override public void mouseEntered(    MouseEvent e){
      super.mouseEntered(e);
      CursorTool tool=toolManager.getCursorTool();
      if (tool != null) {
        setCursor(tool.getCursor());
      }
    }
  }
);
  keyHandler=new MapPaneKeyHandler(this);
  addKeyListener(keyHandler);
  addHierarchyListener(new HierarchyListener(){
    @Override public void hierarchyChanged(    HierarchyEvent he){
      if ((he.getChangeFlags() & HierarchyEvent.SHOWING_CHANGED) != 0) {
        if (isShowing()) {
          onShownOrResized();
        }
      }
    }
  }
);
  addHierarchyBoundsListener(new HierarchyBoundsAdapter(){
    @Override public void ancestorResized(    HierarchyEvent he){
      if (isShowing()) {
        onShownOrResized();
      }
    }
  }
);
  doSetMapContent(content);
  doSetRenderingExecutor(executor);
}
