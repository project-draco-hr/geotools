{
  MapLayer selectedMapLayer=mapLayerTableViewer.getSelectedMapLayer();
  if (selectedMapLayer == null)   return;
  List<MapLayer> layersList=mapLayerTableViewer.getLayersList();
  MapContext mapContext=pane.getMapContext();
  int contextIndex=mapContext.indexOf(selectedMapLayer);
  int viewerIndex=layersList.indexOf(selectedMapLayer);
  int newViewerIndex=viewerIndex + delta;
  if (newViewerIndex < 0 || newViewerIndex > layersList.size() - 1) {
    return;
  }
  int newContextIndex=contextIndex - delta;
  if (newContextIndex < 0 || newContextIndex > mapContext.getLayerCount() - 1) {
    return;
  }
  if (contextIndex != newContextIndex) {
    mapContext.moveLayer(contextIndex,newContextIndex);
    pane.redraw();
    Collections.swap(layersList,viewerIndex,newViewerIndex);
    mapLayerTableViewer.refresh();
  }
}
