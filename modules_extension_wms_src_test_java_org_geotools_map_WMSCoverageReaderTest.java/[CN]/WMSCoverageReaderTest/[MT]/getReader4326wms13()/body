{
  MockHttpClient client=new MockHttpClient(){
    public HTTPResponse get(    URL url) throws IOException {
      if (url.getQuery().contains("GetCapabilities")) {
        URL caps130=WMSCoverageReaderTest.class.getResource("caps130.xml");
        return new MockHttpResponse(caps130,"text/xml");
      }
 else       if (url.getQuery().contains("GetMap") && url.getQuery().contains("world4326")) {
        Map<String,String> params=parseParams(url.getQuery());
        assertEquals("1.3.0",params.get("VERSION"));
        assertEquals("-90.0,-180.0,90.0,180.0",params.get("BBOX"));
        assertEquals("EPSG:4326",params.get("CRS"));
        URL world=WMSCoverageReaderTest.class.getResource("world.png");
        return new MockHttpResponse(world,"image/png");
      }
 else {
        throw new IllegalArgumentException("Don't know how to handle a get request over " + url.toExternalForm());
      }
    }
  }
;
  WebMapServer server=new WebMapServer(new URL("http://geoserver.org/geoserver/wms"),client);
  WMSCoverageReader reader=new WMSCoverageReader(server,getLayer(server,"world4326"));
  return reader;
}
