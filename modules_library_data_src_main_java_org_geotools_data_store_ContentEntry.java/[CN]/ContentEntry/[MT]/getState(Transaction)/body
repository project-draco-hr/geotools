{
  if (transaction != null && state.containsKey(transaction)) {
    return state.get(transaction);
  }
 else {
    ContentState auto=state.get(Transaction.AUTO_COMMIT);
    ContentState copy=(ContentState)auto.copy();
    Transaction t=(transaction != null ? transaction : Transaction.AUTO_COMMIT);
    copy.setTransaction(t);
    state.put(t,copy);
    return copy;
  }
}
