{
  int size=size();
  if (array.length < size) {
    array=(T[])java.lang.reflect.Array.newInstance(array.getClass().getComponentType(),size);
  }
  FeatureIterator<SimpleFeature> it=features();
  try {
    Object[] result=array;
    for (int i=0; it.hasNext() && i < size; i++) {
      result[i]=it.next();
    }
    if (array.length > size) {
      array[size]=null;
    }
    return array;
  }
  finally {
    if (it != null) {
      it.close();
    }
  }
}
