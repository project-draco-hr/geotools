{
  SimpleFeature sf=null;
  while (true) {
    if (currentNodeIterator != null && currentNodeIterator.hasNext()) {
      sf=(SimpleFeature)((GridData)currentNodeIterator.next()).getData();
      if (!collectedFeatureIds.contains(sf.getID())) {
        break;
      }
    }
    if (currentNodeIterator == null || !currentNodeIterator.hasNext()) {
      if (tovisit.size() == 0) {
        return null;
      }
      NodeIdentifier nodeid=tovisit.pop();
      GridNode currentNode=(GridNode)grid.readNode(nodeid);
      currentNodeIterator=currentNode.getData().iterator();
    }
  }
  if (sf != null) {
    collectedFeatureIds.add(sf.getID());
  }
  return sf;
}
