{
  final URL testFile=TestData.getResource(this,TEST_FILE);
  final AbstractGridFormat format=new ImagePyramidFormat();
  final ImagePyramidReader reader=(ImagePyramidReader)format.getReader(testFile);
  assertNotNull(reader);
  final ParameterValue<GridGeometry2D> gg=ImageMosaicFormat.READ_GRIDGEOMETRY2D.createValue();
  final GeneralEnvelope oldEnvelop=reader.getOriginalEnvelope();
  final GeneralEnvelope cropEnvelope=new GeneralEnvelope(new double[]{oldEnvelop.getLowerCorner().getOrdinate(0),oldEnvelop.getLowerCorner().getOrdinate(1)},new double[]{oldEnvelop.getLowerCorner().getOrdinate(0) + oldEnvelop.getSpan(0) / 2,oldEnvelop.getLowerCorner().getOrdinate(1) + oldEnvelop.getSpan(1) / 2});
  cropEnvelope.setCoordinateReferenceSystem(DefaultGeographicCRS.WGS84);
  gg.setValue(new GridGeometry2D(new GridEnvelope2D(new Rectangle(0,0,250,250)),cropEnvelope));
  GridCoverage2D coverage=((GridCoverage2D)reader.read(new GeneralParameterValue[]{gg}));
  assertNotNull("Null value returned instead of a coverage",coverage);
  assertTrue("coverage dimensions different from what we expected",coverage.getGridGeometry().getGridRange().getSpan(0) == 250 && coverage.getGridGeometry().getGridRange().getSpan(1) == 250);
  if (TestData.isInteractiveTest())   coverage.show("testCropHighestLevel");
 else   PlanarImage.wrapRenderedImage(coverage.getRenderedImage()).getTiles();
}
