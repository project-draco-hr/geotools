{
  Class<?> target=null;
  String geometryType=null;
  if (multiWriter) {
    Map<String,Object> map=getGeometryType(f);
    target=(Class<?>)map.get("target");
    geometryType=(String)map.get("geometryType");
  }
 else {
    target=Geometry.class;
    geometryType="Geometry";
  }
  StoreWriter storeWriter=writers.get(target);
  if (storeWriter == null) {
    SimpleFeatureType original=f.getFeatureType();
    SimpleFeatureTypeBuilder builder=new SimpleFeatureTypeBuilder();
    for (    AttributeDescriptor d : original.getAttributeDescriptors()) {
      if (Geometry.class.isAssignableFrom(d.getType().getBinding()) && multiWriter) {
        GeometryDescriptor gd=(GeometryDescriptor)d;
        builder.add(gd.getLocalName(),target,gd.getCoordinateReferenceSystem());
        builder.setDefaultGeometry(gd.getLocalName());
      }
 else {
        builder.add(d);
      }
    }
    builder.setNamespaceURI(original.getName().getURI());
    String fileName;
    if (multiWriter) {
      fileName=getShapeName(f.getFeatureType(),geometryType);
    }
 else {
      fileName=getShapeName(f.getFeatureType(),null);
    }
    builder.setName(fileName);
    SimpleFeatureType retyped=builder.buildFeatureType();
    storeWriter=new StoreWriter(retyped);
    writers.put(target,storeWriter);
  }
  return storeWriter;
}
