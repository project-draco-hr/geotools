{
  PlanarImage raster;
  ImageReader reader;
  if (useJAI) {
    final ParameterBlock pbjImageRead=new ParameterBlock();
    pbjImageRead.add(new FileImageInputStreamExtImpl(input));
    pbjImageRead.add(imageIndex);
    pbjImageRead.add(Boolean.FALSE);
    pbjImageRead.add(Boolean.FALSE);
    pbjImageRead.add(Boolean.FALSE);
    pbjImageRead.add(null);
    pbjImageRead.add(null);
    pbjImageRead.add(imageReadParam);
    reader=readerSpi.createReaderInstance();
    pbjImageRead.add(reader);
    final String jaiOperation=useMultithreading ? "ImageReadMT" : "ImageRead";
    raster=JAI.create(jaiOperation,pbjImageRead,hints);
  }
 else {
    reader=readerSpi.createReaderInstance();
    reader.setInput(new FileImageInputStreamExtImpl(input),true,true);
    raster=PlanarImage.wrapRenderedImage(reader.read(imageIndex,imageReadParam));
    reader.dispose();
  }
  return raster;
}
