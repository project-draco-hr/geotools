{
  try {
    FeatureType featureType;
    Map<String,SimpleFeature> featureMap=new LinkedHashMap<String,SimpleFeature>();
    Name typeName;
    Feature feature;
    feature=reader.next();
    if (feature == null) {
      throw new IllegalArgumentException("Provided  FeatureReader<FeatureType, Feature> is closed");
    }
    featureType=feature.getType();
    typeName=featureType.getName();
    featureMap.put(feature.getIdentifier().getID(),(SimpleFeature)feature);
    while (reader.hasNext()) {
      feature=reader.next();
      featureMap.put(feature.getIdentifier().getID(),(SimpleFeature)feature);
    }
    schema.put(typeName,(SimpleFeatureType)featureType);
    memory.put(typeName,featureMap);
  }
 catch (  IllegalAttributeException e) {
    throw new DataSourceException("Problem using reader",e);
  }
 finally {
    reader.close();
  }
}
