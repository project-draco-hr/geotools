{
  final Element element=currentElement();
  final String asText;
  if (isFormattable(value)) {
    asText=value.toString();
  }
 else   if (value != null && isFormattable(value.getClass().getComponentType())) {
    asText=formatSequence(value);
  }
 else {
    asText=null;
  }
  if (element instanceof IIOMetadataNode) {
    ((IIOMetadataNode)element).setUserObject(value);
  }
 else   if (value != null && asText == null) {
    throw new UnsupportedOperationException("Illegal object. It should be an IIOMetadataNode instance");
  }
  element.setNodeValue(asText);
}
