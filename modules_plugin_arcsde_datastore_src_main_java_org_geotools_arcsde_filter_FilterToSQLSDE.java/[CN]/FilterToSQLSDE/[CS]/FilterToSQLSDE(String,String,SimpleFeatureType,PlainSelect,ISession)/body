{
  this.layerFidFieldName=layerFidColName;
  this.featureType=ft;
  this.definitionQuery=definitionQuery;
  this.conn=session;
  if (definitionQuery != null) {
    attributeNames=new HashMap<String,SelectExpressionItem>();
    @SuppressWarnings("unchecked") List<SelectItem> selectItems=definitionQuery.getSelectItems();
    for (    SelectItem item : selectItems) {
      if (!(item instanceof SelectExpressionItem)) {
        String msg="for item '" + item + "': only SelectExpressionItems should be in query at this stage."+ " AllColumns and AllTableColumns instances should be resolved to their list "+ " of column names at view registration time.";
        LOGGER.severe(msg);
        throw new IllegalStateException(msg);
      }
      SelectExpressionItem colDef=(SelectExpressionItem)item;
      String alias=colDef.getAlias();
      if (alias == null) {
        if (!(colDef.getExpression() instanceof Column)) {
          throw new RuntimeException("if select item is not a plain column an alias should be provided: " + colDef);
        }
        Column column=(Column)colDef.getExpression();
        alias=column.getColumnName();
      }
      attributeNames.put(alias,colDef);
    }
  }
}
