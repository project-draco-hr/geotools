{
  SimpleFeatureIterator feats=null;
  try {
    List<SimpleFeature> decoratedFeatures=new ArrayList<SimpleFeature>();
    SimpleFeatureSource source=versioned.getFeatureSource(testName);
    assertNotNull(source);
    Query query=new Query(testName);
    query.setVersion("ALL");
    SimpleFeatureCollection collection=source.getFeatures(query);
    assertNotNull(collection);
    feats=collection.features();
    assertNotNull(feats);
    while (feats.hasNext()) {
      SimpleFeature feat=feats.next();
      assertNotNull(feat);
      decoratedFeatures.add(feat);
    }
    List<SimpleFeature> versionedFeatures=getAllFeatures(testType);
    compareFeatureLists(decoratedFeatures,versionedFeatures);
  }
  finally {
    if (feats != null)     feats.close();
  }
}
