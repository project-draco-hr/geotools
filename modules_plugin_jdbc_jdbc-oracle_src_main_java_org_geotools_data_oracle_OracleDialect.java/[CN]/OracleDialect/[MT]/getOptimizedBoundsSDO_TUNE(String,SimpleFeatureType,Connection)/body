{
  if (!estimatedExtentsEnabled)   return null;
  String tableName;
  if (schema != null && !"".equals(schema)) {
    tableName=schema + "." + featureType.getTypeName();
  }
 else {
    tableName=featureType.getTypeName();
  }
  Statement st=null;
  ResultSet rs=null;
  List<ReferencedEnvelope> result=new ArrayList<ReferencedEnvelope>();
  Savepoint savePoint=null;
  try {
    st=cx.createStatement();
    if (!cx.getAutoCommit()) {
      savePoint=cx.setSavepoint();
    }
    for (    AttributeDescriptor att : featureType.getAttributeDescriptors()) {
      if (att instanceof GeometryDescriptor) {
        StringBuffer sql=new StringBuffer();
        sql.append("select SDO_TUNE.EXTENT_OF('");
        sql.append(tableName);
        sql.append("', '");
        sql.append(att.getName().getLocalPart());
        sql.append("') FROM DUAL");
        LOGGER.log(Level.FINE,"Getting the full extent of the table using optimized search: {0}",sql);
        rs=st.executeQuery(sql.toString());
        if (rs.next()) {
          GeometryDescriptor descriptor=(GeometryDescriptor)att;
          Geometry geometry=readGeometry(rs,1,new GeometryFactory(),cx);
          ReferencedEnvelope env=JTS.bounds(geometry,descriptor.getCoordinateReferenceSystem());
          if (env != null && !env.isNull()) {
            result.add(env);
          }
        }
        rs.close();
      }
    }
  }
 catch (  SQLException e) {
    if (savePoint != null) {
      cx.rollback(savePoint);
    }
    LOGGER.log(Level.WARNING,"Failed to use SDO_TUNE.EXTENT_OF, falling back on envelope aggregation",e);
    return null;
  }
 finally {
    if (savePoint != null) {
      cx.rollback(savePoint);
    }
    dataStore.closeSafe(rs);
    dataStore.closeSafe(st);
  }
  return result;
}
