{
  CoordinateReferenceSystem crs=renderingEnvelope.getCoordinateReferenceSystem();
  if (renderingEnvelope != null && crs instanceof GeographicCRS) {
    GeographicCRS geogCrs=(GeographicCRS)CRS.getHorizontalCRS(crs);
    CoordinateReferenceSystem horizontalSourceCrs=CRS.getHorizontalCRS(sourceCrs);
    ReferencedEnvelope validArea=null;
    if (horizontalSourceCrs instanceof GeographicCRS && !CRS.equalsIgnoreMetadata(horizontalSourceCrs,geogCrs)) {
      if (!CRS.equalsIgnoreMetadata(horizontalSourceCrs,geogCrs)) {
        if (CRS.getAxisOrder(sourceCrs) == AxisOrder.NORTH_EAST) {
          validArea=new ReferencedEnvelope(MIN_LATITUDE,MAX_LATITUDE,Float.MAX_VALUE,-Float.MAX_VALUE,horizontalSourceCrs);
        }
 else {
          validArea=new ReferencedEnvelope(Float.MAX_VALUE,-Float.MAX_VALUE,MIN_LATITUDE,MAX_LATITUDE,horizontalSourceCrs);
        }
      }
    }
    if (wrap && maxWraps > 0) {
      double centralMeridian=geogCrs.getDatum().getPrimeMeridian().getGreenwichLongitude();
      return new WrappingProjectionHandler(renderingEnvelope,validArea,sourceCrs,centralMeridian,maxWraps);
    }
 else {
      return new ProjectionHandler(sourceCrs,validArea,renderingEnvelope);
    }
  }
  return null;
}
