{
  String inputDirectory="./src/main/resources/org/geotools/referencing/factory/epsg/";
  File directory=new File(inputDirectory);
  File databaseFile=new File(directory,ThreadedH2EpsgFactory.DATABASE_NAME + ".data.db");
  File indexFile=new File(directory,ThreadedH2EpsgFactory.DATABASE_NAME + ".index.db");
  File lobDirectory=new File(directory,ThreadedH2EpsgFactory.DATABASE_NAME + ".lobs.db");
  File zipFile=new File(directory,ThreadedH2EpsgFactory.DATABASE_NAME + ".zip");
  indexFile.delete();
  databaseFile.delete();
  zipFile.delete();
  final JdbcDataSource source=new JdbcDataSource();
  final StringBuilder url=new StringBuilder(ThreadedH2EpsgFactory.PREFIX);
  final String path=directory.getAbsolutePath().replace(File.separatorChar,'/');
  if (path.length() == 0 || path.charAt(0) != '/') {
    url.append('/');
  }
  url.append(path);
  if (url.charAt(url.length() - 1) != '/') {
    url.append('/');
  }
  url.append(ThreadedH2EpsgFactory.DATABASE_NAME);
  url.append(";AUTO_RECONNECT=TRUE;CACHE_SIZE=131072;CACHE_TYPE=TQ");
  source.setURL((url.toString()));
  source.setUser("sa");
  source.setPassword("");
  Connection connection=source.getConnection();
  System.out.println("Creating the EPSG database");
  final Statement statement=connection.createStatement();
  try {
    executeScript(new File(directory,"EPSG_Tables_PostgreSQL.sql"),statement);
    executeScript(new File(directory,"EPSG_Data_PostgreSQL.sql"),statement);
    executeScript(new File(directory,"EPSG_FKeys_PostgreSQL.sql"),statement);
    executeScript(new File(directory,"EPSG_Indexes_H2.sql"),statement);
    statement.execute("SHUTDOWN COMPACT");
  }
 catch (  IOException exception) {
    SQLException e=new SQLException("Error occurred while executing " + "the EPSG database creation scripts");
    e.initCause(exception);
    throw e;
  }
 finally {
    statement.close();
    connection.close();
  }
  System.out.println("EPSG database created");
  System.out.println("Creating the zipped database");
  byte[] buf=new byte[1024];
  ZipOutputStream zos=new ZipOutputStream(new FileOutputStream(zipFile));
  File[] files=new File[]{databaseFile,indexFile};
  for (  File file : files) {
    FileInputStream in=new FileInputStream(file);
    zos.putNextEntry(new ZipEntry(file.getName()));
    int len;
    while ((len=in.read(buf)) > 0) {
      zos.write(buf,0,len);
    }
    zos.closeEntry();
    in.close();
  }
  zos.close();
  System.out.println("Cleaning up the unzipped database files");
  databaseFile.delete();
  indexFile.delete();
  System.out.println("Done. The zipped database file is available at " + zipFile.getAbsolutePath());
}
