{
  ReferencedEnvelope featureBounds=features.getBounds();
  if (bounds == null) {
    extent=featureBounds;
  }
 else {
    extent=new ReferencedEnvelope(bounds);
  }
  extentGeometry=(new GeometryFactory()).toGeometry(extent);
  CoordinateReferenceSystem featuresCRS=featureBounds.getCoordinateReferenceSystem();
  CoordinateReferenceSystem boundsCRS=bounds.getCoordinateReferenceSystem();
  transformFeatures=false;
  if (featuresCRS != null && boundsCRS != null && !CRS.equalsIgnoreMetadata(boundsCRS,featuresCRS)) {
    try {
      featureToRasterTransform=CRS.findMathTransform(featuresCRS,boundsCRS,true);
    }
 catch (    Exception ex) {
      throw new TransformException("Unable to transform features into output coordinate reference system",ex);
    }
    transformFeatures=true;
  }
}
