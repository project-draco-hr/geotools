{
  if (Filter.EXCLUDE.equals(query.getFilter())) {
    return null;
  }
  Query callQuery=new DefaultQuery(query);
  Filter[] filters=wsProtocol.splitFilters(query.getFilter());
  Filter supportedFilter=filters[0];
  Filter postFilter=filters[1];
  LOGGER.fine("Supported filter:  " + supportedFilter);
  LOGGER.fine("Unupported filter: " + postFilter);
  ((DefaultQuery)callQuery).setFilter(supportedFilter);
  int maxFeatures=getMaxFeatures(query);
  if (Filter.INCLUDE.equals(postFilter)) {
    ((DefaultQuery)callQuery).setMaxFeatures(maxFeatures);
  }
 else {
    ((DefaultQuery)callQuery).setMaxFeatures(maxFeaturesHardLimit);
  }
  WSResponse response=wsProtocol.issueGetFeature(callQuery);
  Document doc=getXmlResponse(response);
  List<Integer> validFeatureIndex=determineValidFeatures(postFilter,doc,maxFeatures);
  return new XmlResponse(doc,validFeatureIndex);
}
