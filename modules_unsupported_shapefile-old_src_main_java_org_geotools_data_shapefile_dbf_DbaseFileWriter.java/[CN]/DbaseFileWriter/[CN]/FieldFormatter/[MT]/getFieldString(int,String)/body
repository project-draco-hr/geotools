{
  try {
    buffer.replace(0,size,emptyString);
    buffer.setLength(size);
    int maxSize=size;
    if (s != null) {
      buffer.replace(0,size,s);
      int currentBytes=s.substring(0,Math.min(size,s.length())).getBytes(charset.name()).length;
      if (currentBytes > size) {
        char[] c=new char[1];
        for (int index=size - 1; currentBytes > size; index--) {
          c[0]=buffer.charAt(index);
          String string=new String(c);
          buffer.deleteCharAt(index);
          currentBytes-=string.getBytes().length;
          maxSize--;
        }
      }
 else {
        if (s.length() < size) {
          maxSize=size - (currentBytes - s.length());
          for (int i=s.length(); i < size; i++) {
            buffer.append(' ');
          }
        }
      }
    }
    buffer.setLength(maxSize);
    return buffer.toString();
  }
 catch (  UnsupportedEncodingException e) {
    throw new RuntimeException("This error should never occurr",e);
  }
}
