{
  SimpleFeatureTypeBuilder stb=new SimpleFeatureTypeBuilder();
  stb.setName("test");
  stb.setCRS(DefaultGeographicCRS.WGS84);
  stb.add("geo",Geometry.class);
  stb.add("bar",Integer.class);
  SimpleFeatureType ft=stb.buildFeatureType();
  UniqueVisitor vis=new UniqueVisitor("bar");
  SimpleFeatureCollection delegate=createMock(SimpleFeatureCollection.class);
  expect(delegate.getSchema()).andReturn(ft).anyTimes();
  delegate.accepts(vis,null);
  expectLastCall().once();
  replay(delegate);
  ReprojectingFeatureCollection rfc=new ReprojectingFeatureCollection(delegate,target);
  rfc.accepts(vis,null);
  verify(delegate);
  vis=new UniqueVisitor("geo");
  SimpleFeatureIterator it=createNiceMock(SimpleFeatureIterator.class);
  replay(it);
  delegate=createMock(SimpleFeatureCollection.class);
  expect(delegate.features()).andReturn(it).once();
  expect(delegate.getSchema()).andReturn(ft).anyTimes();
  replay(delegate);
  rfc=new ReprojectingFeatureCollection(delegate,target);
  rfc.accepts(vis,null);
  verify(delegate);
}
