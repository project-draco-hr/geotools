{
  if (format == null || !Utilities.equals(this.locale,locale)) {
    this.locale=locale;
    format=(locale != null) ? NumberFormat.getNumberInstance(locale) : NumberFormat.getNumberInstance();
    format.setMinimumFractionDigits(ndigits);
    format.setMaximumFractionDigits(ndigits);
    dummy=new FieldPosition(0);
  }
  buffer=format.format(value,buffer,dummy);
  if (writeUnits && unit != null) {
    final int position=buffer.length();
    buffer.append('\u00A0');
    buffer.append(unit);
    if (buffer.length() == position + 1) {
      buffer.setLength(position);
    }
  }
  return buffer;
}
