{
  if (Boolean.FALSE.equals(serviceAvailable)) {
    return;
  }
  SimpleFeatureSource featureSource;
  featureSource=wfs.getFeatureSource(testType.FEATURETYPENAME);
  assertNotNull(featureSource);
  Query query=new Query(testType.FEATURETYPENAME);
  GeometryFactory gf=new GeometryFactory();
  Coordinate[] coordinates={new Coordinate(39,-107),new Coordinate(38,-107),new Coordinate(38,-104),new Coordinate(39,-104),new Coordinate(39,-107)};
  LinearRing shell=gf.createLinearRing(coordinates);
  Polygon polygon=gf.createPolygon(shell,null);
  FilterFactory2 ff=CommonFactoryFinder.getFilterFactory2(null);
  Filter filter=ff.intersects(ff.property(defaultGeometryName),ff.literal(polygon));
  query.setFilter(filter);
  SimpleFeatureCollection features;
  features=featureSource.getFeatures(query);
  assertNotNull(features);
  SimpleFeatureType schema=features.getSchema();
  assertNotNull(schema);
  SimpleFeatureIterator iterator=features.features();
  assertNotNull(iterator);
  try {
    assertTrue(iterator.hasNext());
    SimpleFeature next=iterator.next();
    assertNotNull(next);
    assertNotNull(next.getDefaultGeometry());
    assertFalse(iterator.hasNext());
  }
  finally {
    iterator.close();
  }
}
