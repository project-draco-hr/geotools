{
  Connection conn=null;
  try {
    conn=pool.getConnection();
    int major=conn.getMetaData().getDatabaseMajorVersion();
    int minor=conn.getMetaData().getDatabaseMinorVersion();
    if (!((major > 8) || ((major == 8) && minor >= 1))) {
      return;
    }
  }
  finally {
    if (conn != null)     conn.close();
  }
  Transaction t1=new DefaultTransaction();
  FeatureWriter<SimpleFeatureType,SimpleFeature> writer1=data.getFeatureWriter("road",rd1Filter,t1);
  SimpleFeature f1=(SimpleFeature)writer1.next();
  f1.setAttribute("name",new String("r1_"));
  writer1.write();
  Transaction t2=new DefaultTransaction();
  FeatureWriter<SimpleFeatureType,SimpleFeature> writer2=data.getFeatureWriter("road",rd1Filter,t2);
  SimpleFeature f2=(SimpleFeature)writer2.next();
  f2.setAttribute("name",new String("r1__"));
  try {
    writer2.write();
    fail("Feature lock should have failed");
  }
 catch (  FeatureLockException e) {
    assertEquals("road.rd1",e.getFeatureID());
  }
  t1.rollback();
  writer1.close();
  t1.close();
  t2.rollback();
  writer2.close();
  t2.close();
}
