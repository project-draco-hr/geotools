{
  FeatureIterator<SimpleFeature> iterator=collection.features();
  try {
    while (iterator.hasNext()) {
      SimpleFeature feature=(SimpleFeature)iterator.next();
      if (feature == null) {
        continue;
      }
      final String ID=getKey(feature.getIdentifier());
      if (ID == null) {
        continue;
      }
      if (contents.containsKey(ID)) {
        continue;
      }
      if (this.schema == null) {
        this.schema=feature.getFeatureType();
      }
      SimpleFeatureType childType=(SimpleFeatureType)getSchema();
      if (!feature.getFeatureType().equals(childType)) {
        LOGGER.warning("Feature Collection contains a heterogeneous" + " mix of features");
      }
      contents.put(ID,feature);
    }
  }
  finally {
    iterator.close();
  }
}
