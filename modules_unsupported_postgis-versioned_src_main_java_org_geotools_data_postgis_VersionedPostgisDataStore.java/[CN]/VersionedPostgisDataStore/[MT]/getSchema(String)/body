{
  SimpleFeatureType ft=wrapped.getSchema(typeName);
  if (!isVersioned(typeName)) {
    return ft;
  }
  Set names=new HashSet(Arrays.asList(filterPropertyNames(new DefaultQuery(typeName))));
  List filtered=new ArrayList();
  for (int i=0; i < ft.getAttributeCount(); i++) {
    AttributeDescriptor cat=ft.getDescriptor(i);
    String name=cat.getLocalName().toLowerCase();
    if (names.contains(name)) {
      filtered.add(cat);
    }
  }
  AttributeDescriptor[] ats=(AttributeDescriptor[])filtered.toArray(new AttributeDescriptor[filtered.size()]);
  try {
    SimpleFeatureTypeBuilder ftb=new SimpleFeatureTypeBuilder();
    ftb.init(ft);
    ftb.setAttributes(Arrays.asList(ats));
    return ftb.buildFeatureType();
  }
 catch (  IllegalArgumentException e) {
    throw new DataSourceException("Error converting FeatureType from versioned (internal) schema " + "to unversioned (external) schema " + typeName,e);
  }
}
