{
  if (message == null)   message="Version disabling " + typeName;
  Connection conn=null;
  Statement st=null;
  PostgisSQLBuilder sqlb=wrapped.createSQLBuilder();
  Transaction t=new DefaultTransaction();
  t.putProperty(VersioningDataStore.AUTHOR,author);
  t.putProperty(VersioningDataStore.MESSAGE,message);
  try {
    VersionedJdbcTransactionState state=wrapped.getVersionedJdbcTransactionState(t);
    state.setTypeNameDirty(typeName);
    state.getRevision();
    Envelope envelope=wrapped.getFeatureSource(typeName).getBounds();
    if (envelope != null && wrapped.getSchema(typeName).getGeometryDescriptor() != null) {
      CoordinateReferenceSystem crs=wrapped.getSchema(typeName).getGeometryDescriptor().getCoordinateReferenceSystem();
      if (crs != null)       envelope=JTS.toGeographic(envelope,crs);
      state.expandDirtyBounds(envelope);
    }
    conn=state.getConnection();
    st=conn.createStatement();
    try {
      st.execute("DROP VIEW " + typeName + "_vfc_view");
    }
 catch (    SQLException e) {
    }
    st.execute("DELETE FROM geometry_columns WHERE f_table_schema = current_schema() " + "   AND f_table_name = '" + typeName + "_vfc_view'");
    st.execute("DELETE FROM " + sqlb.encodeTableName(typeName) + " WHERE expired <> "+ Long.MAX_VALUE);
    PkDescriptor pk=getPrimaryKeyConstraintName(conn,typeName);
    if (pk == null)     throw new DataSourceException("Cannot version tables without primary keys");
    String colList="";
    for (int i=1; i < pk.columns.length; i++) {
      colList+="," + pk.columns[i];
    }
    colList=colList.substring(1);
    execute(st,"DROP INDEX " + sqlb.encodeTableName(typeName.toLowerCase() + "_revidx"));
    execute(st,"ALTER TABLE " + sqlb.encodeTableName(typeName) + " DROP CONSTRAINT "+ pk.name);
    execute(st,"ALTER TABLE " + sqlb.encodeTableName(typeName) + " DROP COLUMN REVISION");
    execute(st,"ALTER TABLE " + sqlb.encodeTableName(typeName) + " DROP COLUMN EXPIRED");
    execute(st,"ALTER TABLE " + sqlb.encodeTableName(typeName) + " DROP COLUMN CREATED");
    execute(st,"ALTER TABLE " + sqlb.encodeTableName(typeName) + " ADD CONSTRAINT "+ pk.name+ " PRIMARY KEY("+ colList+ ")");
    execute(st,"UPDATE " + sqlb.encodeTableName(TBL_VERSIONEDTABLES) + " SET VERSIONED = FALSE WHERE SCHEMA = '"+ getConfig().getDatabaseSchemaName()+ "' AND NAME = '"+ typeName+ "'");
    t.commit();
    resetTypeInfo();
  }
 catch (  SQLException sql) {
    throw new DataSourceException("Error occurred during version disabling",sql);
  }
catch (  TransformException e) {
    throw new DataSourceException("Error occurred while trying to compute the lat/lon bounding box " + "affected by this operation",e);
  }
 finally {
    JDBCUtils.close(st);
    JDBCUtils.close(conn,t,null);
    t.close();
  }
}
