{
  boolean autoCommit=false;
  if (transaction.equals(Transaction.AUTO_COMMIT)) {
    transaction=new DefaultTransaction();
    autoCommit=true;
  }
  Filter revisionedFilter=buildVersionedFilter(typeName,filter,new RevisionInfo());
  FeatureWriter<SimpleFeatureType,SimpleFeature> updateWriter;
  if (append)   updateWriter=null;
 else   updateWriter=wrapped.getFeatureWriter(typeName,revisionedFilter,transaction);
  FeatureWriter<SimpleFeatureType,SimpleFeature> appendWriter=wrapped.getFeatureWriterAppend(typeName,transaction);
  VersionedJdbcTransactionState state=wrapped.getVersionedJdbcTransactionState(transaction);
  state.setTypeNameDirty(typeName);
  VersionedFIDMapper mapper=(VersionedFIDMapper)getFIDMapper(typeName);
  VersionedFeatureWriter writer=new VersionedFeatureWriter(updateWriter,appendWriter,getSchema(typeName),state,mapper,autoCommit);
  writer.setFeatureListenerManager(listenerManager);
  return writer;
}
