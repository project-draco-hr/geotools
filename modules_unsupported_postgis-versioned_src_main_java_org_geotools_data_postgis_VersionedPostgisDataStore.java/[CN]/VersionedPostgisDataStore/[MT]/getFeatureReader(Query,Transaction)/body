{
  if (!isVersioned(query.getTypeName())) {
    return wrapped.getFeatureReader(query,trans);
  }
  DefaultQuery versionedQuery=buildVersionedQuery(query);
  FeatureReader<SimpleFeatureType,SimpleFeature> reader=wrapped.getFeatureReader(versionedQuery,trans);
  VersionedFIDMapper mapper=(VersionedFIDMapper)getFIDMapper(query.getTypeName());
  return new VersionedFeatureReader(reader,mapper);
}
