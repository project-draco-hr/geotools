{
  BoundingBox boundaries=filter.getBounds();
  CoordinateReferenceSystem crs=boundaries.getCoordinateReferenceSystem();
  if (crs == null)   return super.visit(filter,extraData);
  PropertyName propertyName=null;
  if (filter.getExpression1() instanceof PropertyName) {
    propertyName=(PropertyName)filter.getExpression1();
  }
 else   if (filter.getExpression2() instanceof PropertyName) {
    propertyName=(PropertyName)filter.getExpression2();
  }
  CoordinateReferenceSystem targetCrs=findPropertyCRS(propertyName);
  if (crs != null && targetCrs != null && !CRS.equalsIgnoreMetadata(crs,targetCrs)) {
    ReferencedEnvelope envelope=ReferencedEnvelope.reference(boundaries);
    try {
      envelope=envelope.transform(targetCrs,true);
    }
 catch (    TransformException e) {
      throw new RuntimeException(e);
    }
catch (    FactoryException e) {
      throw new RuntimeException(e);
    }
    boundaries=envelope;
  }
  return getFactory(extraData).bbox(propertyName,boundaries);
}
