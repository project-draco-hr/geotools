{
  MapContext context=null;
  RenderListener listener=null;
  ;
  try {
    context=new DefaultMapContext(new MapLayer[]{layer},envelope.getCoordinateReferenceSystem());
    delegate=new StreamingRenderer();
    delegate.setContext(context);
    delegate.setJava2DHints(getJava2DHints());
    Map rendererHints2=new HashMap(getRendererHints() != null ? getRendererHints() : Collections.EMPTY_MAP);
    rendererHints2.put(LABEL_CACHE_KEY,new IntegratingLabelCache(labelCache));
    delegate.setRendererHints(rendererHints2);
    listener=new RenderListener(){
      public void featureRenderer(      SimpleFeature feature){
        fireFeatureRenderedEvent(feature);
      }
      public void errorOccurred(      Exception e){
        fireErrorEvent(e);
      }
    }
;
    delegate.addRenderListener(listener);
    delegate.paint(graphics,paintArea,envelope,transform);
  }
  finally {
    if (context != null)     context.clearLayerList();
    if (listener != null && delegate != null)     delegate.removeRenderListener(listener);
    delegate=null;
  }
}
