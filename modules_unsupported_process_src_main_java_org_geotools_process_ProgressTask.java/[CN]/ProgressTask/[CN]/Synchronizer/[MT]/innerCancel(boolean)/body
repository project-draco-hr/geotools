{
  for (; ; ) {
    int s=getState();
    if (ranOrCancelled(s)) {
      return false;
    }
    if (compareAndSetState(s,CANCELED)) {
      break;
    }
  }
  if (mayInterruptIfRunning) {
    Thread r=runningThread;
    if (r != null) {
      r.interrupt();
    }
  }
  releaseShared(0);
  done();
  return true;
}
