{
  final double offset=10000;
  final Rectangle paintArea=new Rectangle(0,0,800,600);
  final AffineTransform worldToScreen=AffineTransform.getScaleInstance(0.5,0.5);
  worldToScreen.translate(-offset,-offset);
  AffineTransform at=new AffineTransform(worldToScreen);
  Envelope env=RendererUtilities.createMapEnvelope(paintArea,at);
  assertEnvelopeEquals(new Envelope(offset,offset + 1600,offset,offset + 1200),env,0.001);
  at.translate(2 * offset,2 * offset);
  env=RendererUtilities.createMapEnvelope(paintArea,at);
  assertEnvelopeEquals(new Envelope(-offset,-offset + 1600,-offset,-offset + 1200),env,0.001);
  at.translate(-2 * offset,-2 * offset);
  at.rotate(Math.PI / 2.0,offset,offset);
  env=RendererUtilities.createMapEnvelope(paintArea,at);
  assertEnvelopeEquals(new Envelope(offset,offset + 1200,offset - 1600,offset),env,0.0001);
  at=new AffineTransform(worldToScreen);
  at.rotate(Math.PI / 4.0,offset,offset);
  env=RendererUtilities.createMapEnvelope(paintArea,at);
  assertEnvelopeEquals(new Envelope(offset,offset + Math.cos(Math.PI / 4.0) * 1600 + Math.sin(Math.PI / 4.0) * 1200,offset - Math.sin(Math.PI / 4.0) * 1600,offset + Math.cos(Math.PI / 4.0) * 1200),env,0.0001);
}
