{
  Utilities.ensureNonNull("params",params);
  Utilities.ensureNonNull("spi",spi);
  this.spi=spi;
  try {
    this.pathType=(PathType)params.get("PathType");
    this.locationAttribute=(String)params.get("LocationAttribute");
    final String temp=(String)params.get("SuggestedSPI");
    this.suggestedSPI=temp != null ? (ImageReaderSpi)Class.forName(temp).newInstance() : null;
    this.parentLocation=(String)params.get("ParentLocation");
    Object heterogen=params.get("Heterogeneous");
    if (heterogen != null) {
      this.heterogeneous=((Boolean)heterogen).booleanValue();
    }
    if (!create)     tileIndexStore=spi.createDataStore(params);
 else {
      try {
        tileIndexStore=spi.createNewDataStore(params);
      }
 catch (      UnsupportedOperationException e) {
        tileIndexStore=spi.createDataStore(params);
      }
    }
    if (create)     return;
    if (spi instanceof PostgisNGJNDIDataStoreFactory || spi instanceof PostgisNGDataStoreFactory)     extractBasicProperties(FilenameUtils.getBaseName(FilenameUtils.getPathNoEndSeparator(this.parentLocation)));
 else     extractBasicProperties(null);
  }
 catch (  Throwable e) {
    try {
      if (tileIndexStore != null)       tileIndexStore.dispose();
    }
 catch (    Throwable e1) {
      if (LOGGER.isLoggable(Level.FINE))       LOGGER.log(Level.FINE,e1.getLocalizedMessage(),e1);
    }
 finally {
      tileIndexStore=null;
    }
    throw new IllegalArgumentException(e);
  }
}
