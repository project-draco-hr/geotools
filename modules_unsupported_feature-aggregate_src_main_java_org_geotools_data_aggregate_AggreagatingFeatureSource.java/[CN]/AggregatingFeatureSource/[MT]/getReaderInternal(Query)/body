{
  try {
    Query psQuery=new Query(query);
    Name psName=config.getPrimaryStore();
    psQuery.setTypeName(config.getStoreMap().get(psName));
    DataStore ps=getStore().getStore(psName,false);
    SimpleFeatureType target=DataUtilities.createView(ps,psQuery).getSchema();
    target=retypeNameSchema(target);
    FeatureQueue queue=new FeatureQueue(config.getStoreMap().size());
    AggregatingDataStore store=getStore();
    for (    Map.Entry<Name,String> entry : config.getStoreMap().entrySet()) {
      FeatureCallable fc=new FeatureCallable(store,query,entry.getKey(),entry.getValue(),queue,target);
      queue.addSource(fc);
      store.submit(fc);
    }
    SimpleFeatureReader reader=new QueueReader(queue,target);
    if (query.getSortBy() != null && query.getSortBy().length > 0) {
      reader=new SortedFeatureReader(reader,query.getSortBy(),1000,20);
    }
    return reader;
  }
 catch (  SchemaException e) {
    throw new IOException("Failed to compute target feature type",e);
  }
}
