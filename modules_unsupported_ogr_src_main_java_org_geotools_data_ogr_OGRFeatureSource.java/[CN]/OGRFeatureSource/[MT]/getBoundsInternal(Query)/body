{
  CoordinateReferenceSystem crs=getSchema().getCoordinateReferenceSystem();
  OGRFilterTranslator filterTx=new OGRFilterTranslator(getSchema(),query.getFilter());
  if (Filter.EXCLUDE.equals(filterTx.getFilter())) {
    return new ReferencedEnvelope(crs);
  }
 else   if (!filterTx.isFilterFullySupported()) {
    return null;
  }
 else {
    Pointer dataSource=null;
    Pointer layer=null;
    try {
      String typeName=getEntry().getTypeName();
      dataSource=getDataStore().openOGRDataSource(false);
      layer=openOGRLayer(dataSource,typeName);
      setLayerFilters(layer,filterTx);
      Pointer<OGREnvelope> boundsPtr=allocate(OGREnvelope.class);
      int code=OGR_L_GetExtent(layer,boundsPtr,0);
      if (code == OGRERR_FAILURE) {
        return null;
      }
 else {
        OGREnvelope bounds=boundsPtr.get();
        return new ReferencedEnvelope(bounds.MinX(),bounds.MaxX(),bounds.MinY(),bounds.MaxY(),crs);
      }
    }
  finally {
      OGRUtils.releaseLayer(layer);
      OGRUtils.releaseDataSource(dataSource);
    }
  }
}
