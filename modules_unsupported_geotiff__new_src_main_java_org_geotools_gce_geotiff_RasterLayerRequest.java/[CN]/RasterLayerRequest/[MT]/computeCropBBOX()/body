{
  if (requestCRS == null)   requestCRS=CRS.getHorizontalCRS(requestedBBox.getCoordinateReferenceSystem());
  try {
    if (destinationToSourceTransform != null && !destinationToSourceTransform.isIdentity()) {
      final GeneralEnvelope temp=CRS.transform(destinationToSourceTransform,requestedBBox);
      temp.setCoordinateReferenceSystem(rasterManager.domainManager.coverageCRS2D);
      cropBBox=new ReferencedEnvelope(temp);
    }
 else {
      cropBBox=new ReferencedEnvelope(requestedBBox.getMinX(),requestedBBox.getMaxX(),requestedBBox.getMinY(),requestedBBox.getMaxY(),rasterManager.domainManager.coverageCRS2D);
    }
    if (!cropBBox.intersects((BoundingBox)rasterManager.domainManager.coverageBBox)) {
      cropBBox=null;
      empty=true;
      return;
    }
    cropBBox=new ReferencedEnvelope(((ReferencedEnvelope)cropBBox).intersection(rasterManager.domainManager.coverageBBox),rasterManager.domainManager.coverageCRS2D);
    return;
  }
 catch (  TransformException te) {
    if (LOGGER.isLoggable(Level.FINE))     LOGGER.log(Level.FINE,te.getLocalizedMessage(),te);
  }
  try {
    if (destinationToSourceTransform != null && !destinationToSourceTransform.isIdentity()) {
      requestedBBOXInCoverageGeographicCRS=CRS.transform(requestCRSToCoverageGeographicCRS2D,requestedBBox);
      requestedBBOXInCoverageGeographicCRS.setCoordinateReferenceSystem(rasterManager.domainManager.coverageGeographicCRS2D);
    }
    if (requestedBBOXInCoverageGeographicCRS == null)     requestedBBOXInCoverageGeographicCRS=new GeneralEnvelope(requestCRS);
    if (!requestedBBOXInCoverageGeographicCRS.intersects(rasterManager.domainManager.coverageGeographicBBox,true)) {
      cropBBox=null;
      empty=true;
      return;
    }
    requestedBBOXInCoverageGeographicCRS.intersect(rasterManager.domainManager.coverageGeographicBBox);
    requestedBBOXInCoverageGeographicCRS.setCoordinateReferenceSystem(rasterManager.domainManager.coverageGeographicCRS2D);
    final MathTransform transform=CRS.findMathTransform(requestedBBOXInCoverageGeographicCRS.getCoordinateReferenceSystem(),rasterManager.domainManager.coverageCRS2D,true);
    approximateRequestedBBoInNativeCRS=CRS.transform(transform,requestedBBOXInCoverageGeographicCRS);
    approximateRequestedBBoInNativeCRS.setCoordinateReferenceSystem(rasterManager.domainManager.coverageCRS2D);
    cropBBox=new ReferencedEnvelope(approximateRequestedBBoInNativeCRS);
  }
 catch (  TransformException te) {
    if (LOGGER.isLoggable(Level.FINE))     LOGGER.log(Level.FINE,te.getLocalizedMessage(),te);
  }
catch (  FactoryException fe) {
    if (LOGGER.isLoggable(Level.FINE))     LOGGER.log(Level.FINE,fe.getLocalizedMessage(),fe);
  }
  LOGGER.log(Level.INFO,"We did not manage to crop the requested envelope, we fall back onto loading the whole coverage.");
  cropBBox=null;
}
