{
  TreeSetFeatureCollection copy=new TreeSetFeatureCollection();
  copy.addAll(features);
  copy.clear();
  assertTrue(copy.isEmpty());
  copy.addAll(features);
  assertTrue(!copy.isEmpty());
  List<SimpleFeature> list=DataUtilities.list(features);
  SimpleFeature[] f1=(SimpleFeature[])list.toArray(new SimpleFeature[list.size()]);
  SimpleFeature[] f2=(SimpleFeature[])features.toArray(new SimpleFeature[list.size()]);
  assertEquals(f1.length,f2.length);
  for (int i=0; i < f1.length; i++) {
    assertSame(f1[i],f2[i]);
  }
  SimpleFeatureIterator copyIterator=copy.features();
  SimpleFeatureIterator featuresIterator=features.features();
  while (copyIterator.hasNext() && featuresIterator.hasNext()) {
    assertEquals(copyIterator.next(),featuresIterator.next());
  }
}
