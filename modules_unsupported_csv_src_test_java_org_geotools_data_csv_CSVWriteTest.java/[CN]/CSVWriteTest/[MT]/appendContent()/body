{
  File directory=tmp;
  Map<String,Serializable> params=new HashMap<String,Serializable>();
  params.put("file",file);
  DataStore store=DataStoreFinder.getDataStore(params);
  SimpleFeatureType featureType=store.getSchema("locations");
  File file2=new File(directory,"duplicate.rst");
  Map<String,Serializable> params2=new HashMap<String,Serializable>();
  params2.put("file",file2);
  CSVDataStoreFactory factory=new CSVDataStoreFactory();
  DataStore duplicate=factory.createNewDataStore(params2);
  duplicate.createSchema(featureType);
  FeatureReader<SimpleFeatureType,SimpleFeature> reader;
  FeatureWriter<SimpleFeatureType,SimpleFeature> writer;
  SimpleFeature feature, newFeature;
  Query query=new Query(featureType.getTypeName(),Filter.INCLUDE);
  reader=store.getFeatureReader(query,Transaction.AUTO_COMMIT);
  writer=duplicate.getFeatureWriterAppend("duplicate",Transaction.AUTO_COMMIT);
  try {
    while (reader.hasNext()) {
      feature=reader.next();
      newFeature=writer.next();
      newFeature.setAttributes(feature.getAttributes());
      writer.write();
    }
  }
  finally {
    reader.close();
    writer.close();
  }
  SimpleFeatureStore featureStore=(SimpleFeatureStore)store.getFeatureSource("locations");
  assertEquals(9,featureStore.getFeatures().size());
  ByteArrayOutputStream baos1=new ByteArrayOutputStream();
  ByteArrayOutputStream baos2=new ByteArrayOutputStream();
  Files.copy(file.toPath(),baos1);
  Files.copy(file2.toPath(),baos2);
  String contents1=new String(baos1.toByteArray(),StandardCharsets.UTF_8);
  String contents2=new String(baos2.toByteArray(),StandardCharsets.UTF_8);
  contents1=contents1.replace(" ","").trim();
  contents2=contents2.replace(" ","").trim();
  assertEquals("Contents of both files should be the same",contents1,contents2);
}
