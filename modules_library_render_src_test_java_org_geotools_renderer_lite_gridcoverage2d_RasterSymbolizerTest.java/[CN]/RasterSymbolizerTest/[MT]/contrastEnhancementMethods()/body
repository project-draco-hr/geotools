{
  GeneralEnvelope envelope=new GeneralEnvelope(new double[]{-180,-90},new double[]{180,90});
  envelope.setCoordinateReferenceSystem(DefaultGeographicCRS.WGS84);
  GridCoverage2D gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),envelope,new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  java.net.URL surl=TestData.url(this,"histogram.sld");
  SLDParser stylereader=new SLDParser(sf,surl);
  StyledLayerDescriptor sld=stylereader.parseSLD();
  SubchainStyleVisitorCoverageProcessingAdapter rsh_SLD=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rs_1=extractRasterSymbolizer(sld);
  rsh_SLD.visit(rs_1);
  testRasterSymbolizerHelper(rsh_SLD);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  SubchainStyleVisitorCoverageProcessingAdapter rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  StyleBuilder sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_1=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh=new ContrastEnhancementImpl();
  cntEnh.setMethod(ContrastMethod.HISTOGRAM);
  ;
  chTypeGray.setChannelName("1");
  chTypeGray.setContrastEnhancement(cntEnh);
  chSel.setGrayChannel(chTypeGray);
  rsb_1.setChannelSelection(chSel);
  rsb_1.setOpacity(sldBuilder.literalExpression(1.0));
  rsb_1.setOverlap(sldBuilder.literalExpression("AVERAGE"));
  rsh_StyleBuilder.visit(rsb_1);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  surl=TestData.url(this,"logarithmic.sld");
  stylereader=new SLDParser(sf,surl);
  sld=stylereader.parseSLD();
  rsh_SLD=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rs_2=extractRasterSymbolizer(sld);
  rsh_SLD.visit(rs_2);
  testRasterSymbolizerHelper(rsh_SLD);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}));
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_2=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_2=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_2=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_2=new ContrastEnhancementImpl();
  cntEnh_2.setMethod(ContrastMethod.LOGARITHMIC);
  chTypeGray_2.setChannelName("1");
  chTypeGray_2.setContrastEnhancement(cntEnh_2);
  chSel_2.setGrayChannel(chTypeGray_2);
  rsb_2.setChannelSelection(chSel_2);
  rsb_2.setOpacity(sldBuilder.literalExpression(1.0));
  rsh_StyleBuilder.visit(rsb_2);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  surl=TestData.url(this,"exponential.sld");
  stylereader=new SLDParser(sf,surl);
  sld=stylereader.parseSLD();
  rsh_SLD=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rs_3=extractRasterSymbolizer(sld);
  rsh_SLD.visit(rs_3);
  testRasterSymbolizerHelper(rsh_SLD);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_3=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_3=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_3=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_3=new ContrastEnhancementImpl();
  cntEnh_3.setMethod(ContrastMethod.EXPONENTIAL);
  chTypeGray_3.setChannelName("1");
  chTypeGray_3.setContrastEnhancement(cntEnh_3);
  chSel_3.setGrayChannel(chTypeGray_3);
  rsb_3.setChannelSelection(chSel_3);
  rsb_3.setOpacity(sldBuilder.literalExpression(1.0));
  rsb_3.setOverlap(sldBuilder.literalExpression("AVERAGE"));
  rsh_StyleBuilder.visit(rsb_3);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  surl=TestData.url(this,"normalize-stretch.sld");
  stylereader=new SLDParser(sf,surl);
  sld=stylereader.parseSLD();
  rsh_SLD=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rs_4=extractRasterSymbolizer(sld);
  rsh_SLD.visit(rs_4);
  GridCoverage2D output=(GridCoverage2D)rsh_SLD.getOutput();
  ImageWorker worker=new ImageWorker(output.getRenderedImage());
  double min[]=worker.getMinimums();
  double max[]=worker.getMaximums();
  assertEquals(0d,min[0],DELTA);
  assertEquals(255d,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_SLD);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"test_ushort.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_4=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_4=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_4=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_4=new ContrastEnhancementImpl();
  final ContrastMethodStrategy method_4=new NormalizeContrastMethodStrategy();
  method_4.addOption("algorithm",sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_STRETCH_TO_MINMAX_NAME));
  method_4.addOption("minValue",sldBuilder.literalExpression(10));
  method_4.addOption("maxValue",sldBuilder.literalExpression(50));
  cntEnh_4.setMethod(method_4);
  chTypeGray_4.setChannelName("1");
  chTypeGray_4.setContrastEnhancement(cntEnh_4);
  chSel_4.setGrayChannel(chTypeGray_4);
  rsb_4.setChannelSelection(chSel_4);
  rsh_StyleBuilder.visit(rsb_4);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  assertEquals(DataBuffer.TYPE_BYTE,output.getRenderedImage().getSampleModel().getDataType());
  worker=new ImageWorker(output.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(0d,min[0],DELTA);
  assertEquals(255d,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("Float",JAI.create("ImageRead",new File(TestData.url(this,"smalldem.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("dem")},null,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_4f=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_4f=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_4f=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_4f=new ContrastEnhancementImpl();
  final ContrastMethodStrategy method_4f=new NormalizeContrastMethodStrategy();
  method_4f.addOption("algorithm",sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_STRETCH_TO_MINMAX_NAME));
  method_4f.addOption("minValue",sldBuilder.literalExpression(10));
  method_4f.addOption("maxValue",sldBuilder.literalExpression(1200));
  cntEnh_4f.setMethod(method_4);
  chTypeGray_4f.setChannelName("1");
  chTypeGray_4f.setContrastEnhancement(cntEnh_4f);
  chSel_4f.setGrayChannel(chTypeGray_4f);
  rsb_4f.setChannelSelection(chSel_4f);
  rsh_StyleBuilder.visit(rsb_4f);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  assertEquals(DataBuffer.TYPE_BYTE,output.getRenderedImage().getSampleModel().getDataType());
  worker=new ImageWorker(output.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(0d,min[0],DELTA);
  assertEquals(255d,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  surl=TestData.url(this,"normalize-clip.sld");
  stylereader=new SLDParser(sf,surl);
  sld=stylereader.parseSLD();
  rsh_SLD=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rs_5=extractRasterSymbolizer(sld);
  rsh_SLD.visit(rs_5);
  output=(GridCoverage2D)rsh_SLD.getOutput();
  worker=new ImageWorker(output.getRenderedImage());
  worker.setNoData(RangeFactory.create(0,0));
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(10d,min[0],DELTA);
  assertEquals(100d,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_SLD);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_5=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_5=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_5=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_5=new ContrastEnhancementImpl();
  final ContrastMethodStrategy method_5=new NormalizeContrastMethodStrategy();
  method_5.addOption("algorithm",sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_CLIP_TO_MINMAX_NAME));
  method_5.addOption("minValue",sldBuilder.literalExpression(50));
  method_5.addOption("maxValue",sldBuilder.literalExpression(200));
  cntEnh_5.setMethod(method_5);
  chTypeGray_5.setChannelName("1");
  chTypeGray_5.setContrastEnhancement(cntEnh_5);
  chSel_5.setGrayChannel(chTypeGray_5);
  rsb_5.setChannelSelection(chSel_5);
  rsh_StyleBuilder.visit(rsb_5);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  worker=new ImageWorker(output.getRenderedImage());
  worker.setNoData(RangeFactory.create(0,0));
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(50,min[0],DELTA);
  assertEquals(200,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"smalldem.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("dem")},null,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_5f=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_5f=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_5f=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_5f=new ContrastEnhancementImpl();
  final ContrastMethodStrategy method_5f=new NormalizeContrastMethodStrategy();
  method_5f.addOption("algorithm",sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_CLIP_TO_MINMAX_NAME));
  method_5f.addOption("minValue",sldBuilder.literalExpression(50));
  method_5f.addOption("maxValue",sldBuilder.literalExpression(200));
  cntEnh_5f.setMethod(method_5f);
  chTypeGray_5f.setChannelName("1");
  chTypeGray_5f.setContrastEnhancement(cntEnh_5f);
  chSel_5f.setGrayChannel(chTypeGray_5f);
  rsb_5f.setChannelSelection(chSel_5f);
  rsh_StyleBuilder.visit(rsb_5f);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  assertEquals(DataBuffer.TYPE_BYTE,output.getRenderedImage().getSampleModel().getDataType());
  worker=new ImageWorker(output.getRenderedImage());
  worker.setNoData(RangeFactory.create(0,0));
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(50,min[0],DELTA);
  assertEquals(200,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"smalldem.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("dem")},null,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_5g=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_5g=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_5g=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_5g=new ContrastEnhancementImpl();
  final ContrastMethodStrategy method_5g=new NormalizeContrastMethodStrategy();
  method_5g.addOption("algorithm",sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_CLIP_TO_MINMAX_NAME));
  method_5g.addOption("minValue",sldBuilder.literalExpression(50));
  method_5g.addOption("maxValue",sldBuilder.literalExpression(1200));
  cntEnh_5g.setMethod(method_5g);
  chTypeGray_5g.setChannelName("1");
  chTypeGray_5g.setContrastEnhancement(cntEnh_5g);
  chSel_5g.setGrayChannel(chTypeGray_5g);
  rsb_5g.setChannelSelection(chSel_5g);
  rsh_StyleBuilder.visit(rsb_5g);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  assertEquals(DataBuffer.TYPE_BYTE,output.getRenderedImage().getSampleModel().getDataType());
  worker=new ImageWorker(output.getRenderedImage());
  worker.setNoData(RangeFactory.create(0,0));
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(10,min[0],DELTA);
  assertEquals(255,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  RenderedImage source=new ImageWorker(new File(TestData.url(this,"small_4bands_UInt16.tif").toURI())).retainBands(new int[]{2}).getRenderedImage();
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",source,new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("band")},null,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_5c=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_5c=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_5c=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_5c=new ContrastEnhancementImpl();
  final ContrastMethodStrategy method_5c=new NormalizeContrastMethodStrategy();
  method_5c.addOption("algorithm",sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_CLIP_TO_MINMAX_NAME));
  method_5c.addOption("minValue",sldBuilder.literalExpression(50));
  method_5c.addOption("maxValue",sldBuilder.literalExpression(500));
  cntEnh_5c.setMethod(method_5c);
  chTypeGray_5c.setChannelName("1");
  chTypeGray_5c.setContrastEnhancement(cntEnh_5c);
  chSel_5c.setGrayChannel(chTypeGray_5c);
  rsb_5c.setChannelSelection(chSel_5c);
  rsh_StyleBuilder.visit(rsb_5c);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  assertEquals(DataBuffer.TYPE_USHORT,output.getRenderedImage().getSampleModel().getDataType());
  worker=new ImageWorker(output.getRenderedImage());
  worker.setNoData(RangeFactory.create(0,0));
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(97,min[0],DELTA);
  assertEquals(500,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"hs.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_6=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_6=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_6=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_6=new ContrastEnhancementImpl();
  final AbstractContrastMethodStrategy method_6=new NormalizeContrastMethodStrategy();
  method_6.setAlgorithm(sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_CLIP_TO_ZERO_NAME));
  method_6.addOption("minValue",sldBuilder.literalExpression(50));
  method_6.addOption("maxValue",sldBuilder.literalExpression(100));
  cntEnh_6.setMethod(method_6);
  chTypeGray_6.setChannelName("1");
  chTypeGray_6.setContrastEnhancement(cntEnh_6);
  chSel_6.setGrayChannel(chTypeGray_6);
  rsb_6.setChannelSelection(chSel_6);
  rsb_6.setOpacity(sldBuilder.literalExpression(1.0));
  rsh_StyleBuilder.visit(rsb_6);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  worker=new ImageWorker(output.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(0,min[0],DELTA);
  assertEquals(100,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"test_ushort.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("test1BandByte_SLD")},null,null);
  worker=new ImageWorker(gc.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_7=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_7=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_7=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_7=new ContrastEnhancementImpl();
  final AbstractContrastMethodStrategy method_7=new NormalizeContrastMethodStrategy();
  method_7.setAlgorithm(sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_CLIP_TO_ZERO_NAME));
  method_7.addParameter("minValue",sldBuilder.literalExpression(50));
  method_7.addParameter("maxValue",sldBuilder.literalExpression(18000));
  cntEnh_7.setMethod(method_7);
  chTypeGray_7.setChannelName("1");
  chTypeGray_7.setContrastEnhancement(cntEnh_7);
  chSel_7.setGrayChannel(chTypeGray_7);
  rsb_7.setChannelSelection(chSel_7);
  rsb_7.setOpacity(sldBuilder.literalExpression(1.0));
  rsh_StyleBuilder.visit(rsb_7);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  assertEquals(DataBuffer.TYPE_USHORT,output.getRenderedImage().getSampleModel().getDataType());
  worker=new ImageWorker(output.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(0,min[0],DELTA);
  assertEquals(16114,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"smalldem.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("dem")},null,null);
  worker=new ImageWorker(gc.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_7f=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_7f=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_7f=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_7f=new ContrastEnhancementImpl();
  final AbstractContrastMethodStrategy method_7f=new NormalizeContrastMethodStrategy();
  method_7f.setAlgorithm(sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_CLIP_TO_ZERO_NAME));
  method_7f.addParameter("minValue",sldBuilder.literalExpression(50));
  method_7f.addParameter("maxValue",sldBuilder.literalExpression(200));
  cntEnh_7f.setMethod(method_7f);
  chTypeGray_7f.setChannelName("1");
  chTypeGray_7f.setContrastEnhancement(cntEnh_7f);
  chSel_7f.setGrayChannel(chTypeGray_7f);
  rsb_7f.setChannelSelection(chSel_7f);
  rsb_7f.setOpacity(sldBuilder.literalExpression(1.0));
  rsh_StyleBuilder.visit(rsb_7f);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  assertEquals(DataBuffer.TYPE_BYTE,output.getRenderedImage().getSampleModel().getDataType());
  worker=new ImageWorker(output.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(0,min[0],DELTA);
  assertEquals(200,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
  gc=CoverageFactoryFinder.getGridCoverageFactory(null).create("name",JAI.create("ImageRead",new File(TestData.url(this,"smalldem.tif").toURI())),new GeneralEnvelope(new double[]{-90,-180},new double[]{90,180}),new GridSampleDimension[]{new GridSampleDimension("dem")},null,null);
  worker=new ImageWorker(gc.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  sldBuilder=new StyleBuilder();
  rsh_StyleBuilder=new RasterSymbolizerHelper(gc,null);
  final RasterSymbolizer rsb_7g=sldBuilder.createRasterSymbolizer();
  final ChannelSelection chSel_7g=new ChannelSelectionImpl();
  final SelectedChannelType chTypeGray_7g=new SelectedChannelTypeImpl();
  final ContrastEnhancement cntEnh_7g=new ContrastEnhancementImpl();
  final AbstractContrastMethodStrategy method_7g=new NormalizeContrastMethodStrategy();
  method_7g.setAlgorithm(sldBuilder.literalExpression(ContrastEnhancementType.NORMALIZE_CLIP_TO_ZERO_NAME));
  method_7g.addParameter("minValue",sldBuilder.literalExpression(50));
  method_7g.addParameter("maxValue",sldBuilder.literalExpression(1200));
  cntEnh_7g.setMethod(method_7g);
  chTypeGray_7g.setChannelName("1");
  chTypeGray_7g.setContrastEnhancement(cntEnh_7g);
  chSel_7g.setGrayChannel(chTypeGray_7g);
  rsb_7g.setChannelSelection(chSel_7g);
  rsb_7g.setOpacity(sldBuilder.literalExpression(1.0));
  rsh_StyleBuilder.visit(rsb_7g);
  output=(GridCoverage2D)rsh_StyleBuilder.getOutput();
  assertEquals(DataBuffer.TYPE_BYTE,output.getRenderedImage().getSampleModel().getDataType());
  worker=new ImageWorker(output.getRenderedImage());
  min=worker.getMinimums();
  max=worker.getMaximums();
  assertEquals(0,min[0],DELTA);
  assertEquals(255,max[0],DELTA);
  testRasterSymbolizerHelper(rsh_StyleBuilder);
}
