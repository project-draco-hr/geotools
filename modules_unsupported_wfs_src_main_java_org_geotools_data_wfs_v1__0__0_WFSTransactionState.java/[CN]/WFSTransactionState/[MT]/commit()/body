{
  TransactionResult transactionResult=null;
  Map<String,List<Action>> copiedActions;
synchronized (actionMap) {
    combineActions();
    copiedActions=copy(actionMap);
  }
  Iterator<Entry<String,List<Action>>> iter=copiedActions.entrySet().iterator();
  while (iter.hasNext()) {
    Entry<String,List<Action>> entry=iter.next();
    List<Action> actions=entry.getValue();
    String typeName=(String)entry.getKey();
    if (actions.isEmpty()) {
      continue;
    }
    if (transactionResult == null) {
      try {
        transactionResult=commitPost(actions);
      }
 catch (      OperationNotSupportedException e) {
        WFS_1_0_0_DataStore.LOGGER.warning(e.toString());
        transactionResult=null;
      }
catch (      SAXException e) {
        WFS_1_0_0_DataStore.LOGGER.warning(e.toString());
        transactionResult=null;
      }
    }
    if (transactionResult == null) {
      throw new IOException("An error occured while committing.");
    }
    if (transactionResult.getStatus() == TransactionResult.FAILED) {
      throw new IOException(transactionResult.getError().toString());
    }
    List<String> newFids=transactionResult.getInsertResult();
    int currentInsertIndex=0;
    for (Iterator<Action> iter2=actions.iterator(); iter2.hasNext(); ) {
      Action action=iter2.next();
      if (action instanceof InsertAction) {
        InsertAction insertAction=(InsertAction)action;
        if (currentInsertIndex >= newFids.size()) {
          Logging.getLogger("org.geotools.data.wfs").severe("Expected more fids to be returned by " + "TransactionResponse!");
          break;
        }
        String tempFid=insertAction.getFeature().getID();
        String finalFid=newFids.get(currentInsertIndex);
        ds.addFidMapping(tempFid,finalFid);
        currentInsertIndex++;
      }
    }
synchronized (this.fids) {
      this.fids.put(typeName,(String[])newFids.toArray(new String[0]));
    }
    if (currentInsertIndex != newFids.size()) {
      Logging.getLogger("org.geotools.data.wfs").severe("number of fids inserted do not match number of fids returned " + "by Transaction Response.  Got:" + newFids.size() + " expected: "+ currentInsertIndex);
    }
synchronized (actionMap) {
      ((List<Action>)actionMap.get(typeName)).removeAll(actions);
    }
  }
}
