{
  super(collection.getSchema());
  if (subfilter == null)   subfilter=Filter.INCLUDE;
  if (subfilter.equals(Filter.EXCLUDE)) {
    throw new IllegalArgumentException("A subcollection with Filter.EXCLUDE would be empty");
  }
  if (collection instanceof SubFeatureCollection) {
    SubFeatureCollection filtered=(SubFeatureCollection)collection;
    if (subfilter.equals(Filter.INCLUDE)) {
      this.collection=filtered.collection;
      this.filter=filtered.filter();
    }
 else {
      this.collection=filtered.collection;
      this.filter=ff.and(filtered.filter(),subfilter);
    }
  }
 else   if (collection instanceof Collection || collection instanceof AbstractFeatureCollection || collection instanceof AdaptorFeatureCollection) {
    this.collection=collection;
    this.filter=subfilter;
  }
 else {
    throw new IllegalArgumentException("collection supports java.util.Collection or AbstractFeatureCollection");
  }
}
