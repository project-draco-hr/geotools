{
  Query query=new DefaultQuery(featureType.getTypeName(),filter,Query.NO_NAMES);
  Statement st=null;
  try {
    ResultSet rs=null;
    if (getSQLDialect() instanceof PreparedStatementSQLDialect) {
      st=selectSQLPS(featureType,query,cx);
      PreparedStatement ps=(PreparedStatement)st;
      ((PreparedStatementSQLDialect)getSQLDialect()).onSelect(ps,cx,featureType);
      rs=ps.executeQuery();
    }
 else {
      String sql=selectSQL(featureType,query);
      st=cx.createStatement();
      ((BasicSQLDialect)getSQLDialect()).onSelect(st,cx,featureType);
      LOGGER.fine(sql);
      rs=st.executeQuery(sql);
    }
    try {
      PrimaryKey key=getPrimaryKey(featureType);
      InProcessLockingManager lm=(InProcessLockingManager)getLockingManager();
      while (rs.next()) {
        String fid=featureType.getTypeName() + "." + encodeFID(key,rs);
        lm.assertAccess(featureType.getTypeName(),fid,tx);
      }
    }
  finally {
      closeSafe(rs);
    }
  }
  finally {
    closeSafe(st);
  }
}
