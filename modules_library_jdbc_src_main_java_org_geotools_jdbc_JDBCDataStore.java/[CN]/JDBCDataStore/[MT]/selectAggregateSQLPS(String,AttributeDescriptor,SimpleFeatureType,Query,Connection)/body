{
  StringBuffer sql=new StringBuffer();
  boolean limitOffset=checkLimitOffset(query);
  if (limitOffset) {
    sql.append("SELECT * FROM ");
  }
 else {
    sql.append("SELECT ");
    encodeFunction(function,att,query,sql);
    sql.append(" FROM ");
  }
  encodeTableName(featureType.getTypeName(),sql,query.getHints());
  Filter filter=query.getFilter();
  PreparedFilterToSQL toSQL=null;
  if (filter != null && !Filter.INCLUDE.equals(filter)) {
    try {
      toSQL=createPreparedFilterToSQL(featureType);
      sql.append(" ").append(toSQL.encodeToString(filter));
    }
 catch (    FilterToSQLException e) {
      throw new RuntimeException(e);
    }
  }
  if (limitOffset) {
    applyLimitOffset(sql,query);
    StringBuffer sql2=new StringBuffer("SELECT ");
    encodeFunction(function,att,query,sql2);
    sql2.append(" AS gt_result_");
    sql2.append(" FROM (");
    sql.insert(0,sql2.toString());
    sql.append(") gt_limited_");
  }
  LOGGER.fine(sql.toString());
  PreparedStatement ps=cx.prepareStatement(sql.toString(),ResultSet.TYPE_FORWARD_ONLY,ResultSet.CONCUR_READ_ONLY);
  ps.setFetchSize(fetchSize);
  if (toSQL != null) {
    setPreparedFilterValues(ps,toSQL,0,cx);
  }
  return ps;
}
