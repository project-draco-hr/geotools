{
  ShapefileReader reader=ds.openShapeReader(new GeometryFactory());
  ShapeType type=reader.getHeader().getShapeType();
  if ((type == ShapeType.ARC) || (type == ShapeType.ARCM) || (type == ShapeType.ARCZ)) {
    if (returnJTS)     reader.setHandler(new org.geotools.renderer.shape.shapehandler.jts.MultiLineHandler(type,bbox,mt,hasOpacity,screenSize));
 else     reader.setHandler(new MultiLineHandler(type,bbox,mt,hasOpacity,screenSize));
  }
  if ((type == ShapeType.POLYGON) || (type == ShapeType.POLYGONM) || (type == ShapeType.POLYGONZ)) {
    if (returnJTS)     reader.setHandler(new org.geotools.renderer.shape.shapehandler.jts.PolygonHandler(type,bbox,mt,hasOpacity));
 else     reader.setHandler(new PolygonHandler(type,bbox,mt,hasOpacity));
  }
  if ((type == ShapeType.POINT) || (type == ShapeType.POINTM) || (type == ShapeType.POINTZ)) {
    if (returnJTS)     reader.setHandler(new org.geotools.renderer.shape.shapehandler.jts.PointHandler(type,bbox,screenSize,mt,hasOpacity));
 else     reader.setHandler(new PointHandler(type,bbox,screenSize,mt,hasOpacity));
  }
  if ((type == ShapeType.MULTIPOINT) || (type == ShapeType.MULTIPOINTM) || (type == ShapeType.MULTIPOINTZ)) {
    if (returnJTS)     reader.setHandler(new org.geotools.renderer.shape.shapehandler.jts.MultiPointHandler(type,bbox,screenSize,mt,hasOpacity));
 else     reader.setHandler(new MultiPointHandler(type,bbox,screenSize,mt,hasOpacity));
  }
  return reader;
}
