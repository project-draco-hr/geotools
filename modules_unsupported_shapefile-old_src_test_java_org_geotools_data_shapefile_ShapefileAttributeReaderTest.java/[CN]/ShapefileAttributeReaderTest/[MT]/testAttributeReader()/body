{
  File shpFile=copyShapefiles(STATEPOP);
  URL url=shpFile.toURI().toURL();
  ShapefileDataStoreFactory factory=new ShapefileDataStoreFactory();
  IndexedShapefileDataStore indexedstore=new IndexedShapefileDataStore(url);
  ShapefileDataStore store=new ShapefileDataStore(url);
  SimpleFeatureIterator it=indexedstore.getFeatureSource().getFeatures().features();
  FeatureId fid=it.next().getIdentifier();
  it.close();
  FilterFactory ff=CommonFactoryFinder.getFilterFactory(null);
  Filter idFilter=ff.id(Collections.singleton(fid));
  final Query query=new DefaultQuery(indexedstore.getSchema().getName().getLocalPart(),idFilter,new String[]{"STATE_NAME"});
  final SimpleFeatureCollection indexedfeatures=indexedstore.getFeatureSource().getFeatures(query);
  final SimpleFeatureCollection features=store.getFeatureSource().getFeatures(query);
  SimpleFeatureIterator indexIterator=indexedfeatures.features();
  SimpleFeature indexedFeature=indexIterator.next();
  indexIterator.close();
  SimpleFeatureIterator iterator=features.features();
  SimpleFeature feature=iterator.next();
  iterator.close();
  String indexedStateName=(String)indexedFeature.getAttribute("STATE_NAME");
  String stateName=(String)feature.getAttribute("STATE_NAME");
  assertEquals(indexedStateName,stateName);
  store.dispose();
  indexedstore.dispose();
}
