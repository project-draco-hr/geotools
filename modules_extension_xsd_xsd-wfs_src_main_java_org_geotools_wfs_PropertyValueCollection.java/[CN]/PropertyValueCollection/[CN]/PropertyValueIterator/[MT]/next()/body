{
  Object value=values.remove();
  AttributeType xmlType=findType(descriptor.getType().getBinding());
  if (xmlType == null) {
    throw new RuntimeException("Unable to map attribute " + descriptor.getName() + " to xml type");
  }
  Name name=new NameImpl(next.getType().getName().getNamespaceURI(),descriptor.getLocalName());
  AttributeDescriptor newDescriptor=typeFactory.createAttributeDescriptor(xmlType,name,descriptor.getMinOccurs(),descriptor.getMaxOccurs(),descriptor.isNillable(),descriptor.getDefaultValue());
  if (next instanceof SimpleFeature) {
    return factory.createAttribute(value,newDescriptor,null);
  }
 else {
    return factory.createComplexAttribute(Collections.<Property>singletonList((Property)value),newDescriptor,null);
  }
}
