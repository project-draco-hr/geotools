{
  Transaction t1=new DefaultTransaction();
  GeometryFactory fac=new GeometryFactory();
  FeatureWriter<SimpleFeatureType,SimpleFeature> writer1=data.getFeatureWriter("road",rd1Filter,t1);
  writer1.next().setDefaultGeometry(fac.createLineString(new Coordinate[]{new Coordinate(0,0),new Coordinate(0,1)}));
  writer1.write();
  writer1.close();
  FeatureReader<SimpleFeatureType,SimpleFeature> reader=data.getFeatureReader(new DefaultQuery("road",rd1Filter),t1);
  Geometry geom1=(Geometry)reader.next().getDefaultGeometry();
  reader.close();
  assertEquals(new Coordinate(0,0),geom1.getCoordinates()[0]);
  assertEquals(new Coordinate(0,1),geom1.getCoordinates()[1]);
  writer1=data.getFeatureWriter("road",rd1Filter,t1);
  writer1.next().setDefaultGeometry(fac.createLineString(new Coordinate[]{new Coordinate(10,0),new Coordinate(10,1)}));
  writer1.write();
  writer1.close();
  reader=data.getFeatureReader(new DefaultQuery("road",rd1Filter),t1);
  geom1=(Geometry)reader.next().getDefaultGeometry();
  reader.close();
  assertEquals(new Coordinate(10,0),geom1.getCoordinates()[0]);
  assertEquals(new Coordinate(10,1),geom1.getCoordinates()[1]);
  FeatureWriter<SimpleFeatureType,SimpleFeature> writer=data.getFeatureWriterAppend("road",t1);
  SimpleFeature feature=writer.next();
  feature.setDefaultGeometry(fac.createLineString(new Coordinate[]{new Coordinate(20,0),new Coordinate(20,1)}));
  writer.write();
  writer.close();
  FilterFactory filterFactory=CommonFactoryFinder.getFilterFactory(null);
  Id filter=filterFactory.id(Collections.singleton(filterFactory.featureId(feature.getID())));
  reader=data.getFeatureReader(new DefaultQuery("road",filter),t1);
  geom1=(Geometry)reader.next().getDefaultGeometry();
  reader.close();
  assertEquals(new Coordinate(20,0),geom1.getCoordinates()[0]);
  assertEquals(new Coordinate(20,1),geom1.getCoordinates()[1]);
  writer1=data.getFeatureWriter("road",filter,t1);
  writer1.next().setDefaultGeometry(fac.createLineString(new Coordinate[]{new Coordinate(30,0),new Coordinate(30,1)}));
  writer1.write();
  writer1.close();
  reader=data.getFeatureReader(new DefaultQuery("road",filter),t1);
  geom1=(Geometry)reader.next().getDefaultGeometry();
  reader.close();
  assertEquals(new Coordinate(30,0),geom1.getCoordinates()[0]);
  assertEquals(new Coordinate(30,1),geom1.getCoordinates()[1]);
}
