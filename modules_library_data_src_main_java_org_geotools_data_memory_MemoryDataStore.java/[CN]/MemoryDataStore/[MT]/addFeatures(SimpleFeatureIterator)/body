{
  try {
    SimpleFeatureType featureType;
    ConcurrentSkipListMap<String,SimpleFeature> featureMap=new ConcurrentSkipListMap<String,SimpleFeature>();
    String typeName;
    SimpleFeature feature;
    feature=reader.next();
    if (feature == null) {
      throw new IllegalArgumentException("Provided  FeatureReader<SimpleFeatureType, SimpleFeature> is closed");
    }
    featureType=feature.getFeatureType();
    typeName=featureType.getTypeName();
    featureMap.put(feature.getID(),feature);
    while (reader.hasNext()) {
      feature=reader.next();
      featureMap.put(feature.getID(),feature);
    }
    putSchemaAndFeaturesSync(typeName,featureType,featureMap);
  }
  finally {
    reader.close();
  }
}
