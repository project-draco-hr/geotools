{
  DeleteDbFiles.execute(System.getProperty("user.dir"),"acme",true);
  HashMap params=new HashMap();
  params.put("dbtype","h2");
  params.put("database","acme");
  DataStore ds=(DataStore)DataStoreFinder.getDataStore(params);
  SimpleFeatureTypeBuilder tb=new SimpleFeatureTypeBuilder();
  tb.setNamespaceURI("http://acme.com");
  tb.setName("widgets");
  tb.srs("EPSG:4326");
  tb.add("geom",Point.class);
  tb.add("name",String.class);
  tb.add("type",Integer.class);
  tb.add("price",Double.class);
  SimpleFeatureType type=tb.buildFeatureType();
  ds.createSchema(type);
  GeometryFactory gf=new GeometryFactory();
  FeatureWriter fw=ds.getFeatureWriter("widgets",Transaction.AUTO_COMMIT);
  fw.hasNext();
  SimpleFeature f=(SimpleFeature)fw.next();
  f.setAttribute("geom",gf.createPoint(new Coordinate(1,1)));
  f.setAttribute("name","foo");
  f.setAttribute("type",1);
  f.setAttribute("price",1.10);
  fw.write();
  fw.hasNext();
  f=(SimpleFeature)fw.next();
  f.setAttribute("geom",gf.createPoint(new Coordinate(10,10)));
  f.setAttribute("name","bar");
  f.setAttribute("type",10);
  f.setAttribute("price",10.10);
  fw.write();
  fw.hasNext();
  f=(SimpleFeature)fw.next();
  f.setAttribute("geom",gf.createPoint(new Coordinate(20,20)));
  f.setAttribute("name","foobar");
  f.setAttribute("type",20);
  f.setAttribute("price",20.20);
  fw.write();
  fw.close();
  FeatureSource fs=ds.getFeatureSource("widgets");
  System.out.println("Number of features = " + fs.getCount(Query.ALL));
  FeatureCollection features=fs.getFeatures();
  FeatureIterator fi=features.features();
  try {
    while (fi.hasNext()) {
      f=(SimpleFeature)fi.next();
      System.out.println(f.getID());
    }
  }
  finally {
    features.close(fi);
  }
  FilterFactory ff=CommonFactoryFinder.getFilterFactory(null);
  BBOX bbox=ff.bbox("geom",5,5,15,15,"EPSG:4326");
  DefaultQuery q=new DefaultQuery("widgets",bbox);
  features=ds.getFeatureSource("widgets").getFeatures(q);
  System.out.println("Number of features = " + features.size());
  fi=features.features();
  try {
    while (fi.hasNext()) {
      f=(SimpleFeature)fi.next();
      System.out.println(f.getID());
    }
  }
  finally {
    features.close(fi);
  }
}
