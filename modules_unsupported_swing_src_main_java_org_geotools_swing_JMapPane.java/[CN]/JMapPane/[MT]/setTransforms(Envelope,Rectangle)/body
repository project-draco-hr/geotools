{
  ReferencedEnvelope refEnv=new ReferencedEnvelope(envelope);
  double xscale=paintArea.getWidth() / refEnv.getWidth();
  double yscale=paintArea.getHeight() / refEnv.getHeight();
  double scale=Math.min(xscale,yscale);
  double xoff=refEnv.getMedian(0) * scale - paintArea.getCenterX();
  double yoff=refEnv.getMedian(1) * scale + paintArea.getCenterY();
  worldToScreen=new AffineTransform(scale,0,0,-scale,-xoff,yoff);
  try {
    screenToWorld=worldToScreen.createInverse();
  }
 catch (  NoninvertibleTransformException ex) {
    ex.printStackTrace();
  }
}
