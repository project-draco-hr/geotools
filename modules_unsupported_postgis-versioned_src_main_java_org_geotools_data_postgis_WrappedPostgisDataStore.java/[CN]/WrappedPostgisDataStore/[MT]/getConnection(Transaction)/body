{
  if (transaction != Transaction.AUTO_COMMIT) {
    VersionedJdbcTransactionState state;
    state=getVersionedJdbcTransactionState(transaction);
    return state.getConnection();
  }
  try {
    return createConnection();
  }
 catch (  SQLException sqle) {
    throw new DataSourceException("Connection failed:" + sqle,sqle);
  }
}
