{
  if (featureReader == null) {
    throw new IOException("Writer closed");
  }
  if (currentFeature != null) {
    write();
  }
  if (attReader != null && attReader.internalReadersHaveNext()) {
    shapeType=attReader.shp.getHeader().getShapeType();
    handler=shapeType.getShapeHandler(gf);
    if (records == 0) {
      shpWriter.writeHeaders(bounds,shapeType,0,0);
    }
    double[] env=new double[4];
    while (attReader.internalReadersHaveNext()) {
      shapefileLength+=attReader.shp.transferTo(shpWriter,++records,env);
      bounds.expandToInclude(env[0],env[1]);
      bounds.expandToInclude(env[2],env[3]);
      attReader.dbf.transferTo(dbfWriter);
    }
  }
  doClose();
  clean();
}
