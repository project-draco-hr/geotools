{
  final Iterator<ImageWriter> writers=ImageIO.getImageWritersByFormatName("png");
  while (writers.hasNext()) {
    final ImageWriter writer=writers.next();
    if (!filter(writer)) {
      continue;
    }
    final File file=File.createTempFile("MIW",".png");
    try {
      final ImageOutputStream output=ImageIO.createImageOutputStream(file);
      writer.setOutput(output);
      writer.write(metadata,image,param);
      output.close();
      if (param instanceof MosaicImageWriteParam) {
        param=new MosaicImageWriteParam((MosaicImageWriteParam)param);
      }
 else {
        param=null;
      }
      writeFromInput(file,0,param);
    }
  finally {
      file.delete();
    }
    return;
  }
  throw new IIOException(Errors.format(ErrorKeys.NO_IMAGE_WRITER));
}
