{
  NumberRange range=null;
  Category category=categories[0];
  final NumberRange samples=category.geophysics(false).getRange();
  final boolean isGeophysics=(category == category.geophysics(true));
  final ParameterList block=parameters.parameters;
  final KernelJAI mask1=(KernelJAI)block.getObjectParameter("Mask1");
  final KernelJAI mask2=(KernelJAI)block.getObjectParameter("Mask2");
  final double size=(mask1.getWidth() + mask1.getHeight() + mask2.getWidth()+ mask2.getHeight()) / 4.0;
  double factor=getNormalizationFactor(mask1,mask2) / (size - 1);
  if (factor > 0 && !Double.isInfinite(factor)) {
    range=category.geophysics(true).getRange();
    final double minimum=range.getMinimum();
    final double maximum=range.getMaximum();
    factor*=(maximum - minimum) * DEFAULT_RANGE_SCALE;
    range=new NumberRange(0,factor);
  }
  if (range != null) {
    category=new Category(category.getName(),DEFAULT_COLOR_PALETTE,samples,range);
    return category.geophysics(isGeophysics);
  }
  return super.deriveCategory(categories,parameters);
}
