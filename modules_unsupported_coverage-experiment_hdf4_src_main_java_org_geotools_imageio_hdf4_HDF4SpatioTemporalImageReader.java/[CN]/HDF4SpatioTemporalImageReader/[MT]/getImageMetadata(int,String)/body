{
  IIOMetadata metadata;
synchronized (metadataMap) {
    if (!metadataMap.containsKey(imageIndex)) {
      metadata=directReader.getImageMetadata(imageIndex,metadataFormat);
      metadataMap.put(imageIndex,metadata);
    }
 else {
      metadata=(BaseImageMetadata)metadataMap.get(imageIndex);
      if (metadata == null) {
        metadata=directReader.getImageMetadata(imageIndex,metadataFormat);
        metadataMap.put(imageIndex,metadata);
      }
    }
  }
  return metadata;
}
