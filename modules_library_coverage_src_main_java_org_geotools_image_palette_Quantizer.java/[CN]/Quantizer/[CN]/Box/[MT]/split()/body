{
  long fullsum=sum;
  long ps=histogram.getCount(idx);
  int i=idx + 1;
  if (MEDIAN_SPLIT) {
    final int mid=idx + colors / 2;
    for (; i < mid; i++) {
      ps+=histogram.getCount(i);
    }
  }
 else {
    final int end=idx + colors;
    long halfsum=fullsum / 2;
    for (; i < end - 1 && ps < halfsum; i++) {
      ps+=histogram.getCount(i);
    }
  }
  final int fullColors=colors;
  this.colors=i - idx;
  this.sum=ps;
  this.spana=-1;
  this.spanb=-1;
  this.spanr=-1;
  this.spang=-1;
  long rest=fullsum - ps;
  return new Box(i,fullColors - colors,rest,histogram,sort);
}
