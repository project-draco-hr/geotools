{
  if (dragged) {
    Envelope2D env=new Envelope2D();
    env.setFrameFromDiagonal(startDragPos,ev.getMapPosition());
    dragged=false;
    getMapPane().setDisplayArea(env);
  }
 else {
    Rectangle paneArea=getMapPane().getVisibleRect();
    double scale=getMapPane().getWorldToScreenTransform().getScaleX();
    double newScale=scale * zoom;
    DirectPosition2D corner=new DirectPosition2D(startDragPos.getX() - 0.5d * paneArea.width / newScale,startDragPos.getY() + 0.5d * paneArea.height / newScale);
    Envelope2D newMapArea=new Envelope2D();
    newMapArea.setFrameFromCenter(startDragPos,corner);
    getMapPane().setDisplayArea(newMapArea);
  }
}
