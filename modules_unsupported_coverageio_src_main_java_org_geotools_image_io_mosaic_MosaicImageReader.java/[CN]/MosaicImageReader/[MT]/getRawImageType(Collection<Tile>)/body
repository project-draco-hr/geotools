{
  final Set<ImageTypeSpecifier> rawTypes=new FrequencySortedSet<ImageTypeSpecifier>(true);
  final Set<ImageTypeSpecifier> allowed=getImageTypes(tiles,rawTypes);
  rawTypes.retainAll(allowed);
  boolean transparent=true;
  do {
    Iterator<ImageTypeSpecifier> it=rawTypes.iterator();
    while (it.hasNext()) {
      final ImageTypeSpecifier type=it.next();
      if (!transparent || isTransparent(type)) {
        return type;
      }
    }
    it=allowed.iterator();
    while (it.hasNext()) {
      final ImageTypeSpecifier type=it.next();
      if (!transparent || isTransparent(type)) {
        return type;
      }
    }
  }
 while ((transparent=!transparent) == false);
  return null;
}
