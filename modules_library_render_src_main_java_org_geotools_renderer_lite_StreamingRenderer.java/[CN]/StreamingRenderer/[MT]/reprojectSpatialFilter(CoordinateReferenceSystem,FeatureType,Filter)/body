{
  if (filter == null) {
    return null;
  }
  SpatialFilterVisitor sfv=new SpatialFilterVisitor();
  filter.accept(sfv,null);
  if (!sfv.hasSpatialFilter()) {
    return filter;
  }
  DefaultCRSFilterVisitor defaulter=new DefaultCRSFilterVisitor(filterFactory,declaredCRS);
  Filter defaulted=(Filter)filter.accept(defaulter,null);
  ReprojectingFilterVisitor reprojector=new ReprojectingFilterVisitor(filterFactory,schema);
  Filter reprojected=(Filter)defaulted.accept(reprojector,null);
  return reprojected;
}
