{
  Filter filter=rule.getFilter();
  if (filter == null) {
    return rule;
  }
  SpatialFilterVisitor sfv=new SpatialFilterVisitor();
  filter.accept(sfv,null);
  if (!sfv.hasSpatialFilter()) {
    return rule;
  }
  DefaultCRSFilterVisitor defaulter=new DefaultCRSFilterVisitor(filterFactory,declaredCRS);
  Filter defaulted=(Filter)filter.accept(defaulter,null);
  ReprojectingFilterVisitor reprojector=new ReprojectingFilterVisitor(filterFactory,schema);
  Filter reprojected=(Filter)defaulted.accept(reprojector,null);
  Rule rr=new RuleImpl(rule);
  rr.setFilter(reprojected);
  return rr;
}
