{
  SimpleFeatureType featureType=getFeatureType();
  SimpleFeatureBuilder builder=new SimpleFeatureBuilder(featureType);
  GeometryDescriptor geometryDescriptor=featureType.getGeometryDescriptor();
  GeometryFactory geometryFactory=new GeometryFactory();
  Double lat=null, lng=null;
  String[] headers=csvFileState.getCSVHeaders();
  for (int i=0; i < headers.length; i++) {
    String header=headers[i];
    if (i < csvRecord.length) {
      String value=csvRecord[i].trim();
      if (geometryDescriptor != null && header.equals(latField)) {
        lat=Double.valueOf(value);
      }
 else       if (geometryDescriptor != null && header.equals(lngField)) {
        lng=Double.valueOf(value);
      }
 else {
        builder.set(header,value);
      }
    }
 else {
      builder.set(header,null);
    }
  }
  if (geometryDescriptor != null && lat != null && lng != null) {
    Coordinate coordinate=new Coordinate(lat,lng);
    Point point=geometryFactory.createPoint(coordinate);
    builder.set(geometryDescriptor.getLocalName(),point);
  }
  return builder.buildFeature(csvFileState.getTypeName() + "-" + recordId);
}
