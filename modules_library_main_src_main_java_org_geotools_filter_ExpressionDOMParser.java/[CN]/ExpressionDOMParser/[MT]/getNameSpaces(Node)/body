{
  NamespaceSupport namespaces=new NamespaceSupport();
  while (node != null) {
    NamedNodeMap atts=node.getAttributes();
    if (atts != null) {
      for (int i=0; i < atts.getLength(); i++) {
        Node att=atts.item(i);
        if (att.getNamespaceURI() != null && att.getNamespaceURI().equals("http://www.w3.org/2000/xmlns/") && namespaces.getURI(att.getLocalName()) == null) {
          namespaces.declarePrefix(att.getLocalName(),att.getNodeValue());
        }
      }
    }
    node=node.getParentNode();
  }
  return namespaces;
}
