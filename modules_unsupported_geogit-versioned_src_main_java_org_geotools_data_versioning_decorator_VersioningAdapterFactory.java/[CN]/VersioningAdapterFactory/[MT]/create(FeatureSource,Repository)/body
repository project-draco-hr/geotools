{
  final Name typeName=subject.getSchema().getName();
  if (subject.getDataStore() instanceof VersioningDataStore) {
    return subject;
  }
  if (!FeatureSourceDecorator.isVersioned(typeName,versioningRepo)) {
    return subject;
  }
  if (subject instanceof SimpleFeatureLocking) {
    return new SimpleFeatureLockingDecorator((SimpleFeatureLocking)subject,versioningRepo);
  }
  if (subject instanceof SimpleFeatureStore) {
    return new SimpleFeatureStoreDecorator((SimpleFeatureStore)subject,versioningRepo);
  }
  if (subject instanceof SimpleFeatureSource) {
    return new SimpleFeatureSourceDecorator((SimpleFeatureSource)subject,versioningRepo);
  }
  if (subject instanceof FeatureLocking) {
    return new FeatureLockingDecorator((FeatureLocking)subject,versioningRepo);
  }
  if (subject instanceof FeatureStore) {
    return new FeatureStoreDecorator((FeatureStore)subject,versioningRepo);
  }
  return new FeatureSourceDecorator(subject,versioningRepo);
}
