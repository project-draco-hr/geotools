{
  if (aNode == null) {
    aNode=new ColorNode();
    numNodes++;
    if (numNodes > maxNodes) {
      maxNodes=numNodes;
    }
    aNode.level=aLevel;
    aNode.isLeaf=(aLevel > maxLevel);
    if (aNode.isLeaf) {
      currSize++;
    }
  }
  aNode.colorCount++;
  aNode.red+=rgba[0];
  aNode.green+=rgba[1];
  aNode.blue+=rgba[2];
  if (!aNode.isLeaf) {
    int branchIndex=getBranchIndex(rgba,aLevel);
    if (aNode.children[branchIndex] == null) {
      aNode.childCount++;
      if (aNode.childCount == 2) {
        aNode.nextReducible=reduceList[aLevel];
        reduceList[aLevel]=aNode;
      }
    }
    aNode.children[branchIndex]=insertNode(aNode.children[branchIndex],rgba,aLevel + 1);
  }
  return aNode;
}
