{
  int size=currSize;
  if (transparency == Transparency.BITMASK) {
    size++;
  }
  if (size < 2)   size=2;
  final byte[] red=new byte[size];
  final byte[] green=new byte[size];
  final byte[] blue=new byte[size];
  int index=0;
  palette=new ColorNode[size];
  if (transparency == Transparency.BITMASK) {
    index++;
  }
  findPaletteEntry(root,index,red,green,blue);
  if (transparency == Transparency.BITMASK) {
    return new IndexColorModel(8,size,red,green,blue,0);
  }
  return new IndexColorModel(8,currSize,red,green,blue);
}
