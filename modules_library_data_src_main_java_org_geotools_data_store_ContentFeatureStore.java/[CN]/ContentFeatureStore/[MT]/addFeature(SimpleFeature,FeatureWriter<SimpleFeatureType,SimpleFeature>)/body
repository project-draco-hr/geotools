{
  SimpleFeature toWrite=writer.next();
  for (int i=0; i < toWrite.getType().getAttributeCount(); i++) {
    String name=toWrite.getType().getDescriptor(i).getLocalName();
    toWrite.setAttribute(name,feature.getAttribute(name));
  }
  if (feature.getUserData().size() > 0) {
    toWrite.getUserData().putAll(feature.getUserData());
  }
  boolean useExisting=Boolean.TRUE.equals(feature.getUserData().get(Hints.USE_PROVIDED_FID));
  if (getQueryCapabilities().isUseProvidedFIDSupported() && useExisting) {
    ((FeatureIdImpl)toWrite.getIdentifier()).setID(feature.getID());
  }
  writer.write();
  feature.getUserData().putAll(toWrite.getUserData());
  FeatureId id=toWrite.getIdentifier();
  return id;
}
