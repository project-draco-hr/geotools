{
  node.pack();
  int[] shapeIds=node.getShapesId();
  int start=-1;
  int end=-1;
  if (shapeIds != null && shapeIds.length > 0) {
    start=offsets.size();
    for (int i=0; i < shapeIds.length; i++) {
      offsets.add(indexfile.getOffsetInBytes(shapeIds[i]));
    }
    end=offsets.size();
  }
  node.clean();
  MemoryNode mem=new MemoryNode(node.getBounds(),start,end,node.getNumSubNodes());
  for (int i=0; i < node.getNumSubNodes(); i++) {
    mem.subnodes[i]=cloneAndTranslate(node.getSubNode(i),indexfile);
  }
  node.clearSubNodes();
  return mem;
}
