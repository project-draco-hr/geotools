{
  rank=variableDS.getRank();
  width=variableDS.getDimension(rank - NetCDFUtilities.X_DIMENSION).getLength();
  height=variableDS.getDimension(rank - NetCDFUtilities.Y_DIMENSION).getLength();
  String candidateDimension=variableDS.getDimensions().get(0).getFullName();
  MultipleBandsDimensionInfo multipleBands=reader.ancillaryFileManager.getMultipleBandsDimensionInfo(candidateDimension);
  if (multipleBands != null) {
    numBands=multipleBands.getNumberOfBands();
  }
 else {
    numBands=rank > 2 ? variableDS.getDimension(2).getLength() : 1;
  }
  if (reader.getImageMosaicRequest() != null) {
    int[] selectedBands=reader.getImageMosaicRequest().getBands();
    numBands=selectedBands == null ? numBands : selectedBands.length;
  }
  rank-=ignoredDimensions.size();
  final int bufferType=NetCDFUtilities.getRawDataType(variableDS);
  sampleModel=new BandedSampleModel(bufferType,width,height,multipleBands == null ? 1 : numBands);
  final Number noData=NetCDFUtilities.getNodata(variableDS);
  Category[] categories=null;
  if (noData != null) {
    NumberRange noDataRange=NumberRange.create(noData.doubleValue(),true,noData.doubleValue(),true);
    categories=new Category[]{new Category(Vocabulary.formatInternational(VocabularyKeys.NODATA),new Color[]{new Color(0,0,0,0)},noDataRange)};
  }
  String description=variableDS.getDescription();
  if (description == null) {
    description=variableDS.getShortName();
  }
  final Set<SampleDimension> sampleDims=new HashSet<SampleDimension>();
  Unit unit=null;
  String unitString=variableDS.getUnitsString();
  if (unitString != null) {
    try {
      for (      UnitCharReplacement replacement : UNIT_CHARS_REPLACEMENTS) {
        unitString=replacement.replace(unitString);
      }
      unit=Unit.valueOf(unitString);
    }
 catch (    IllegalArgumentException iae) {
      if (LOGGER.isLoggable(Level.FINE)) {
        LOGGER.fine("Unable to parse the unit:" + unitString + "\nNo unit will be assigned");
      }
    }
  }
  if (multipleBands == null) {
    sampleDims.add(new GridSampleDimension(description,categories,unit));
  }
 else {
    for (    String bandName : multipleBands.getBandsNamesInOrder()) {
      sampleDims.add(new GridSampleDimension(bandName,categories,unit));
    }
  }
  InternationalString desc=null;
  if (description != null && !description.isEmpty()) {
    desc=new SimpleInternationalString(description);
  }
  final FieldType fieldType=new DefaultFieldType(new NameImpl(getName()),desc,sampleDims);
  final RangeType range=new DefaultRangeType(getName(),description,fieldType);
  this.setRangeType(range);
}
