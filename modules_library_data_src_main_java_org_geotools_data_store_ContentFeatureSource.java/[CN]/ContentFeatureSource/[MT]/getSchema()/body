{
  if (schema != null) {
    return schema;
  }
  SimpleFeatureType featureType=getAbsoluteSchema();
  if (query != null && query.getPropertyNames() != Query.ALL_NAMES) {
synchronized (this) {
      if (schema == null) {
        schema=SimpleFeatureTypeBuilder.retype(featureType,query.getPropertyNames());
      }
    }
    return schema;
  }
  return featureType;
}
