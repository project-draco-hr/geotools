{
  String typeName=featureType.getTypeName();
  SimpleFeatureType original=getSchema(typeName);
  SQLBuilder sqlBuilder=getSqlBuilder(typeName);
  if (featureType.getAttributeCount() == original.getAttributeCount()) {
    return DataUtilities.attributeNames(featureType);
  }
  String[] typeAttributes=DataUtilities.attributeNames(featureType);
  String[] filterAttributes=DataUtilities.attributeNames(sqlBuilder.getPostQueryFilter(filter));
  if ((filterAttributes == null) || (filterAttributes.length == 0)) {
    return typeAttributes;
  }
  Set set=new HashSet();
  set.addAll(Arrays.asList(typeAttributes));
  set.addAll(Arrays.asList(filterAttributes));
  if (set.size() == typeAttributes.length) {
    return typeAttributes;
  }
 else {
    return (String[])set.toArray(new String[set.size()]);
  }
}
