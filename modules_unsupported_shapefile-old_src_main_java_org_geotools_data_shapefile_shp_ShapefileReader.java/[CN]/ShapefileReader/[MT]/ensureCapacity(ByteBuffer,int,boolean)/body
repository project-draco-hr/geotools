{
  if (buffer.isReadOnly() || useMemoryMappedBuffer) {
    return buffer;
  }
  int limit=buffer.limit();
  while (limit < size) {
    limit*=2;
  }
  if (limit != buffer.limit()) {
    buffer=NIOUtilities.allocate(limit);
  }
  return buffer;
}
