{
  dataStore.setExposePrimaryKeyColumns(exposePrimaryKeys);
  FilterFactory ff=dataStore.getFilterFactory();
  Filter j=ff.equal(ff.property(aname("stringProperty")),ff.property(aname("name")),true);
  Query q=new Query(tname("ft1"));
  q.getJoins().add(new Join(tname("ftjoin"),j));
  q.setFilter(ff.greater(ff.property(aname("intProperty")),ff.literal(0)));
  q.setStartIndex(1);
  q.setSortBy(new SortBy[]{ff.sort(aname("intProperty"),SortOrder.ASCENDING)});
  SimpleFeatureCollection features=dataStore.getFeatureSource(tname("ft1")).getFeatures(q);
  assertEquals(1,features.size());
  SimpleFeatureIterator it=features.features();
  try {
    assertTrue(it.hasNext());
    SimpleFeature f=it.next();
    assertEquals("two",f.getAttribute(aname("stringProperty")));
    SimpleFeature g=(SimpleFeature)f.getAttribute(aname("ftjoin"));
    assertEquals("two",g.getAttribute(aname("name")));
  }
  finally {
    it.close();
  }
}
