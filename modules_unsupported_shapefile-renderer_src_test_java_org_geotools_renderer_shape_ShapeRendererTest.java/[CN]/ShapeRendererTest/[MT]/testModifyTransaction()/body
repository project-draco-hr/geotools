{
  ShapefileDataStore ds=TestUtilites.getDataStore(shp2.getName());
  Style st=TestUtilites.createTestStyle(null,typename);
  SimpleFeatureStore store=(SimpleFeatureStore)ds.getFeatureSource();
  Transaction t=new DefaultTransaction();
  store.setTransaction(t);
  store.modifyFeatures(ds.getSchema().getDescriptor("NAME"),"bleep",Filter.NONE);
  MapContext context=new DefaultMapContext();
  context.addLayer(store,st);
  ShapefileRenderer renderer=new ShapefileRenderer(context);
  TestUtilites.CountingRenderListener listener=new TestUtilites.CountingRenderListener(getName());
  renderer.addRenderListener(listener);
  renderer.addRenderListener(new RenderListener(){
    public void featureRenderer(    SimpleFeature feature){
      assertEquals("bleep",feature.getAttribute("NAME"));
    }
    public void errorOccurred(    Exception e){
      e.printStackTrace();
      assertFalse(true);
    }
  }
);
  Envelope env=context.getLayerBounds();
  int boundary=7;
  TestUtilites.INTERACTIVE=INTERACTIVE;
  env=new Envelope(env.getMinX() - boundary,env.getMaxX() + boundary,env.getMinY() - boundary,env.getMaxY() + boundary);
  TestUtilites.showRender("testTransaction",renderer,2000,env);
  assertEquals(3,listener.count);
}
