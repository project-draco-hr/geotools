{
  FilterToSQL toSQL1=createFilterToSQL(getDataStore().getSchema(tableName));
  toSQL1.setFieldEncoder(new JoiningFieldEncoder(tableName));
  FilterToSQL toSQL2=createFilterToSQL(getDataStore().getSchema(join.getJoiningTypeName()));
  toSQL2.setFieldEncoder(new JoiningFieldEncoder(join.getJoiningTypeName()));
  String field2=toSQL2.encodeToString(join.getForeignKeyName());
  String field1=toSQL1.encodeToString(join.getJoiningKeyName());
  boolean isFirst=orderByFields.isEmpty();
  if (orderByFields.add(field1) && orderByFields.add(field2)) {
    if (!isFirst) {
      sql.append(", ");
    }
    sql.append(" CASE WHEN ");
    sql.append(field2);
    sql.append(" = ");
    sql.append(field1);
    sql.append(" THEN 0 ELSE 1 END ASC");
  }
}
