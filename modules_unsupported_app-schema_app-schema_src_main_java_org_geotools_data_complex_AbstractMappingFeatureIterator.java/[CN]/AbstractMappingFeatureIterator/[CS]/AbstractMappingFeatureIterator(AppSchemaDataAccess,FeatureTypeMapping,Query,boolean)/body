{
  this.store=store;
  this.attf=new AppSchemaFeatureFactoryImpl();
  Name name=mapping.getTargetFeature().getName();
  propertyNames=query.getPropertyNames() == null ? null : new HashSet<String>(Arrays.asList(query.getPropertyNames()));
  this.mapping=mapping;
  this.maxFeatures=query.getMaxFeatures();
  if (!isQueryUnrolled) {
    query=getUnrolledQuery(query);
  }
  xpathAttributeBuilder=new XPath();
  xpathAttributeBuilder.setFeatureFactory(attf);
  initialiseSourceFeatures(mapping,query);
  namespaces=mapping.getNamespaces();
  namespaceAwareFilterFactory=new FilterFactoryImplNamespaceAware(namespaces);
  xpathAttributeBuilder.setFilterFactory(namespaceAwareFilterFactory);
}
