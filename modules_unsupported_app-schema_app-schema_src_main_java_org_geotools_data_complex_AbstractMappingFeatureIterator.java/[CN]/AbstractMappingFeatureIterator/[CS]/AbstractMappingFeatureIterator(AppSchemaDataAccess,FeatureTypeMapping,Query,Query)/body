{
  this.store=store;
  this.attf=new AppSchemaFeatureFactoryImpl();
  this.mapping=mapping;
  if (query != null && query.getProperties() != null) {
    setPropertyNames(query.getProperties());
  }
 else {
    setPropertyNames(null);
  }
  this.maxFeatures=query.getMaxFeatures();
  if (unrolledQuery == null) {
    unrolledQuery=getUnrolledQuery(query);
  }
  xpathAttributeBuilder=new XPath();
  xpathAttributeBuilder.setFeatureFactory(attf);
  initialiseSourceFeatures(mapping,unrolledQuery);
  namespaces=mapping.getNamespaces();
  namespaceAwareFilterFactory=new FilterFactoryImplNamespaceAware(namespaces);
  xpathAttributeBuilder.setFilterFactory(namespaceAwareFilterFactory);
}
