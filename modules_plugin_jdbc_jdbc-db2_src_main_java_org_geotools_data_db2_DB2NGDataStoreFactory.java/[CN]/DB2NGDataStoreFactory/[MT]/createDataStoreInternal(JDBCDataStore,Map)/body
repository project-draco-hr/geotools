{
  Connection con=null;
  try {
    con=dataStore.getDataSource().getConnection();
    DB2DialectInfo di=((DB2SQLDialectPrepared)dataStore.getSQLDialect()).getDb2DialectInfo();
    DB2SQLDialectPrepared dialect=(DB2SQLDialectPrepared)dataStore.getSQLDialect();
    Boolean loose=(Boolean)LOOSEBBOX.lookUp(params);
    dialect.setLooseBBOXEnabled(loose == null || Boolean.TRUE.equals(loose));
    DatabaseMetaData md=con.getMetaData();
    di.setMajorVersion(md.getDatabaseMajorVersion());
    di.setMinorVersion(md.getDatabaseMinorVersion());
    di.setProductName(md.getDatabaseProductName());
    di.setProductVersion(md.getDatabaseProductVersion());
    PreparedStatement ps=con.prepareStatement(SelectGeometryColumns);
    ResultSet rs=ps.executeQuery();
    ResultSetMetaData rsmd=ps.getMetaData();
    for (int i=0; i < rsmd.getColumnCount(); i++) {
      if ("MIN_X".equals(rsmd.getColumnName(i + 1))) {
        di.setSupportingPrecalculatedExtents(true);
        break;
      }
    }
    rs.close();
    ps.close();
    if (dataStore.getDatabaseSchema() == null) {
      ps=con.prepareStatement(GetCurrentSchema);
      rs=ps.executeQuery();
      rs.next();
      dataStore.setDatabaseSchema(rs.getString(1));
      rs.close();
      ps.close();
    }
    ps=con.prepareStatement(GetWKBZTypes);
    rs=ps.executeQuery();
    rs.next();
    byte[] bytes=rs.getBytes(1);
    ByteOrderDataInStream dis=new ByteOrderDataInStream();
    dis.setInStream(new ByteArrayInStream(bytes));
    byte byteOrder=dis.readByte();
    if (byteOrder == WKBConstants.wkbNDR)     dis.setOrder(ByteOrderValues.LITTLE_ENDIAN);
    int geometryType=dis.readInt();
    if (geometryType == 1001)     di.setHasOGCWkbZTyps(true);
    rs.close();
    ps.close();
  }
 catch (  SQLException e) {
    throw new IOException(e.getMessage());
  }
  dataStore.closeSafe(con);
  return dataStore;
}
